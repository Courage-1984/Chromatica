<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chromatica Color Search Engine</title>

    <!-- Three.js for 3D visualizations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23cba6f7'/><circle cx='30' cy='30' r='15' fill='%23f5c2e7'/><circle cx='70' cy='30' r='15' fill='%23f2cdcd'/><circle cx='30' cy='70' r='15' fill='%23a6e3a1'/><circle cx='70' cy='70' r='15' fill='%23f9e2af'/></svg>">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23cba6f7'/><circle cx='30' cy='30' r='15' fill='%23f5c2e7'/><circle cx='70' cy='30' r='15' fill='%23f2cdcd'/><circle cx='30' cy='70' r='15' fill='%23a6e3a1'/><circle cx='70' cy='70' r='15' fill='%23f9e2af'/></svg>">
    <link rel="shortcut icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23cba6f7'/><circle cx='30' cy='30' r='15' fill='%23f5c2e7'/><circle cx='70' cy='30' r='15' fill='%23f2cdcd'/><circle cx='30' cy='70' r='15' fill='%23a6e3a1'/><circle cx='70' cy='70' r='15' fill='%23f9e2af'/></svg>">
    <link rel="apple-touch-icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23cba6f7'/><circle cx='30' cy='30' r='15' fill='%23f5c2e7'/><circle cx='70' cy='30' r='15' fill='%23f2cdcd'/><circle cx='30' cy='70' r='15' fill='%23a6e3a1'/><circle cx='70' cy='70' r='15' fill='%23f9e2af'/></svg>">

    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
    <link rel="manifest" href="/static/site.webmanifest">

    <link rel="stylesheet" type="text/css" href="/static/css/styles.css">
    <link rel="stylesheet" type="text/css" href="/static/css/custom.css">

</head>

<body>
    <!-- Welcome Modal for New Users -->
    <div id="welcomeModal" class="welcome-modal" style="display: none;">
        <div class="welcome-modal-content">
            <button class="welcome-close" type="button" data-action="close">&times;</button>
            <div class="welcome-header">
                <h1 style="color: var(--text); margin: 0 0 10px 0; font-size: 2.5em; font-family: 'JetBrainsMono Nerd Font Mono', monospace; text-align: center;">
                    ğŸ¨ Chromatica
                </h1>
                <p style="color: var(--subtext1); font-size: 1.2em; margin: 0 0 30px 0; text-align: center; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                    Color Search Engine
                </p>
            </div>
            
            <div class="welcome-body">
                <div class="welcome-section">
                    <h2 style="color: var(--blue); margin: 0 0 15px 0; font-size: 1.3em; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                        âœ¨ What is Chromatica?
                    </h2>
                    <p style="color: var(--subtext1); line-height: 1.8; margin-bottom: 20px; font-size: 15px;">
                        Chromatica is a high-performance, two-stage color-based image search engine. 
                        It finds images whose dominant palettes best match your weighted, multi-color queries using 
                        advanced color science and machine learning.
                    </p>
                </div>

                <div class="welcome-section">
                    <h2 style="color: var(--green); margin: 0 0 15px 0; font-size: 1.3em; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                        ğŸš€ Key Features
                    </h2>
                    <ul style="color: var(--subtext1); line-height: 2; margin: 0; padding-left: 25px; font-size: 14px;">
                        <li><strong style="color: var(--text);">Multi-Color Queries</strong> â€” Search with multiple colors and weights</li>
                        <li><strong style="color: var(--text);">Color Harmony Presets</strong> â€” Quick presets for complementary, triadic, and more</li>
                        <li><strong style="color: var(--text);">CIE Lab Color Space</strong> â€” Perceptually uniform color matching</li>
                        <li><strong style="color: var(--text);">Fast & Accurate</strong> â€” Two-stage search with FAISS + Sinkhorn-EMD reranking</li>
                        <li><strong style="color: var(--text);">Image Input</strong> â€” Upload images to extract colors automatically</li>
                        <li><strong style="color: var(--text);">Performance Tuning</strong> â€” Adjustable speed and accuracy settings</li>
                    </ul>
                </div>

                <div class="welcome-section">
                    <h2 style="color: var(--mauve); margin: 0 0 15px 0; font-size: 1.3em; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                        ğŸ¯ How to Use
                    </h2>
                    <ol style="color: var(--subtext1); line-height: 2; margin: 0; padding-left: 25px; font-size: 14px;">
                        <li>Select colors using the color pickers or use one of the <strong style="color: var(--text);">Quick Color Presets</strong></li>
                        <li>Adjust color weights to emphasize certain colors in your search</li>
                        <li>Click <strong style="color: var(--text);">Search</strong> to find matching images</li>
                        <li>Explore results with detailed color analysis and visualizations</li>
                    </ol>
                </div>
            </div>

            <div class="welcome-actions">
                <button type="button" class="welcome-btn welcome-btn-primary" data-action="close">
                    <span>Get Started</span>
                </button>
                <label style="display: flex; align-items: center; gap: 8px; color: var(--subtext0); font-size: 13px; cursor: pointer;">
                    <input type="checkbox" id="dontShowAgain" style="cursor: pointer;">
                    <span>Don't show this again</span>
                </label>
            </div>
        </div>
    </div>

    <div class="container">
        <h1>ğŸ¨ Chromatica Color Search Engine</h1>

        <!-- Color Input Section -->
        <div class="color-input-section">
            <h2>Color Query</h2>
            <div id="colorInputs">
                <!-- Initial row will be created by addColorRow() on page load -->
            </div>
            <!-- Color Suggestions -->
            <div id="colorSuggestions"></div>
            <div style="display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap;">
                <button onclick="addColor()"
                    style="background: var(--blue); color: #000000; padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; min-width: 160px; justify-content: center; transition: all 0.2s; font-family: inherit;">
                    <span style="font-size: 16px;">â•</span>
                    <span>Add Another Color</span>
                </button>
                <button onclick="showSuggestPaletteModal()"
                    style="background: var(--mauve); color: #000000; padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; min-width: 160px; justify-content: center; transition: all 0.2s; font-family: inherit;">
                    <span style="font-size: 16px;">ğŸ¨</span>
                    <span>Suggest Palette</span>
                </button>
                <button onclick="rollDice()"
                    style="background: var(--yellow); color: #000000; padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; min-width: 160px; justify-content: center; transition: all 0.2s; font-family: inherit;">
                    <span style="font-size: 16px;">ğŸ²</span>
                    <span>Roll Dice</span>
                </button>
                <button onclick="showImageUploadModal()"
                    style="background: var(--teal); color: #000000; padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; min-width: 160px; justify-content: center; transition: all 0.2s; font-family: inherit;">
                    <span style="font-size: 16px;">ğŸ–¼ï¸</span>
                    <span>Input Image</span>
                </button>
            </div>

            <!-- Performance Tuning Options -->
            <div class="performance-options"
                style="margin: 20px 0; padding: 20px; background: var(--surface0); border-radius: 12px; border: 1px solid var(--surface1);">
                <h4
                    style="margin: 0 0 15px 0; color: var(--text); font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                    âš¡ Performance Tuning</h4>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                    <div>
                        <label
                            style="display: block; margin-bottom: 8px; color: var(--subtext1); font-size: 14px; font-weight: 500;">
                            <input type="checkbox" id="fastMode" style="margin-right: 8px;">
                            ğŸš€ Fast Mode (100x faster)
                        </label>
                        <p style="margin: 0; font-size: 12px; color: var(--subtext0); line-height: 1.4;">
                            Use approximate L2 distance instead of Sinkhorn-EMD for much faster results
                        </p>
                    </div>

                    <div>
                        <label
                            style="display: block; margin-bottom: 8px; color: var(--subtext1); font-size: 14px; font-weight: 500;">
                            Batch Size: <span id="batchSizeValue">10</span>
                        </label>
                        <input type="range" id="batchSize" min="5" max="50" value="10" step="5"
                            style="width: 100%; margin-bottom: 5px;"
                            oninput="document.getElementById('batchSizeValue').textContent = this.value;">
                        <p style="margin: 0; font-size: 12px; color: var(--subtext0); line-height: 1.4;">
                            Higher values improve memory efficiency for large datasets
                        </p>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <label style="display: flex; align-items: center; color: var(--subtext1); font-size: 14px;">
                        <input type="range" id="resultCount" min="5" max="100" value="10" step="5"
                            style="margin-right: 8px;"
                            oninput="document.getElementById('resultCountValue').textContent = this.value;">
                        Results: <span id="resultCountValue">10</span>
                    </label>

                    <button onclick="showPerformanceInfo()"
                        style="background: var(--blue); color: #000000; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        â„¹ï¸ Info
                    </button>
                </div>
            </div>

            <!-- Advanced Filters Panel -->
            <div class="advanced-filters" id="advancedFilters"
                style="margin: 20px 0; padding: 20px; background: var(--surface0); border-radius: 12px; border: 1px solid var(--surface1); display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="margin: 0; color: var(--text); font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                        ğŸ›ï¸ Advanced Filters</h4>
                    <button onclick="toggleAdvancedFilters()"
                        style="background: var(--surface2); color: var(--text); border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Hide</button>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <!-- Negative Color Search -->
                    <div>
                        <label
                            style="display: block; margin-bottom: 8px; color: var(--subtext1); font-size: 14px; font-weight: 500;">
                            Exclude Colors (Negative Search)</label>
                        <input type="text" id="excludeColors" placeholder="e.g., FF0000,00FF00"
                            style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--surface2); background: var(--base); color: var(--text); font-size: 13px;">
                        <small style="color: var(--subtext0); font-size: 11px;">Comma-separated hex codes</small>
                    </div>

                    <!-- Similarity Range -->
                    <div>
                        <label
                            style="display: block; margin-bottom: 8px; color: var(--subtext1); font-size: 14px; font-weight: 500;">
                            Similarity Range: <span id="similarityRangeValue">0.5</span></label>
                        <input type="range" id="similarityRange" min="0" max="1" step="0.01" value="0.5"
                            style="width: 100%;"
                            oninput="document.getElementById('similarityRangeValue').textContent = this.value;">
                    </div>

                    <!-- Temperature Filter -->
                    <div>
                        <label
                            style="display: block; margin-bottom: 8px; color: var(--subtext1); font-size: 14px; font-weight: 500;">
                            Color Temperature</label>
                        <select id="temperatureFilter"
                            style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--surface2); background: var(--base); color: var(--text); font-size: 13px;">
                            <option value="all">All</option>
                            <option value="warm">Warm</option>
                            <option value="cool">Cool</option>
                            <option value="neutral">Neutral</option>
                        </select>
                    </div>

                    <!-- Brightness Range -->
                    <div>
                        <label
                            style="display: block; margin-bottom: 8px; color: var(--subtext1); font-size: 14px; font-weight: 500;">
                            Brightness Range</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="range" id="brightnessMin" min="0" max="1" step="0.01" value="0"
                                style="flex: 1;" title="Min Brightness">
                            <span style="color: var(--text); font-size: 12px;">0</span>
                            <input type="range" id="brightnessMax" min="0" max="1" step="0.01" value="1"
                                style="flex: 1;" title="Max Brightness">
                            <span style="color: var(--text); font-size: 12px;">1</span>
                        </div>
                    </div>

                    <!-- Saturation Range -->
                    <div>
                        <label
                            style="display: block; margin-bottom: 8px; color: var(--subtext1); font-size: 14px; font-weight: 500;">
                            Saturation Range</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="range" id="saturationMin" min="0" max="1" step="0.01" value="0"
                                style="flex: 1;" title="Min Saturation">
                            <span style="color: var(--text); font-size: 12px;">0</span>
                            <input type="range" id="saturationMax" min="0" max="1" step="0.01" value="1"
                                style="flex: 1;" title="Max Saturation">
                            <span style="color: var(--text); font-size: 12px;">1</span>
                        </div>
                    </div>

                    <!-- Dominant Color Count -->
                    <div>
                        <label
                            style="display: block; margin-bottom: 8px; color: var(--subtext1); font-size: 14px; font-weight: 500;">
                            Dominant Color Count</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="number" id="dominantColorCountMin" min="1" max="20" value="1" placeholder="Min"
                                style="flex: 1; padding: 8px; border-radius: 6px; border: 1px solid var(--surface2); background: var(--base); color: var(--text); font-size: 13px;">
                            <input type="number" id="dominantColorCountMax" min="1" max="20" value="20"
                                placeholder="Max"
                                style="flex: 1; padding: 8px; border-radius: 6px; border: 1px solid var(--surface2); background: var(--base); color: var(--text); font-size: 13px;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Presets -->
            <div class="quick-presets"
                style="margin: 20px 0; padding: 20px; background: var(--surface0); border-radius: 12px; border: 1px solid var(--surface1);">
                <h4
                    style="margin: 0 0 15px 0; color: var(--text); font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                    âš¡ Quick Color Presets</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="loadPreset('complementary')" class="preset-btn"
                        style="background: var(--blue); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ¨</span> Complementary
                    </button>
                    <button onclick="loadPreset('analogous')" class="preset-btn"
                        style="background: var(--green); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸŒˆ</span> Analogous
                    </button>
                    <button onclick="loadPreset('triadic')" class="preset-btn"
                        style="background: var(--mauve); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ­</span> Triadic
                    </button>
                    <button onclick="loadPreset('split-complementary')"
                        class="preset-btn"
                        style="background: var(--yellow); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px;">
                        <span>âœ¨</span> Split-Complementary
                    </button>
                    <button onclick="loadPreset('tetradic')"
                        class="preset-btn"
                        style="background: var(--teal); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸª</span> Tetradic
                    </button>
                    <button onclick="loadPreset('monochrome')"
                        class="preset-btn"
                        style="background: var(--red); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px;">
                        <span>â¬›</span> Monochrome
                    </button>
                    <button onclick="loadPreset('warm')" class="preset-btn"
                        style="background: linear-gradient(90deg, #FF0000, #FFCC00); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ”¥</span> Warm
                    </button>
                    <button onclick="loadPreset('cool')" class="preset-btn"
                        style="background: linear-gradient(90deg, #0066FF, #99CCFF); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px;">
                        <span>â„ï¸</span> Cool
                    </button>
                </div>
            </div>

            <!-- Advanced Features Toolbar -->
            <div class="advanced-features-toolbar"
                style="margin: 20px 0; padding: 20px; background: var(--surface0); border-radius: 12px; border: 1px solid var(--surface1);">
                <h4
                    style="margin: 0 0 15px 0; color: var(--text); font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                    ğŸš€ Advanced Features</h4>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="showAdvancedFilters()"
                        style="background: var(--mauve); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px;">
                        ğŸ›ï¸ Filters
                    </button>
                    <button onclick="showColorWheel()"
                        style="background: var(--teal); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px;">
                        ğŸ¨ Color Wheel
                    </button>
                    <button onclick="showExportOptions()"
                        style="background: var(--green); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px;">
                        ğŸ“¤ Export
                    </button>
                    <button onclick="analyzeHarmony(true)"
                        style="background: var(--blue); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px;">
                        ğŸ­ Harmony
                    </button>
                    <button onclick="showGradientOptions()"
                        style="background: var(--yellow); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px;">
                        ğŸŒˆ Gradient
                    </button>
                    <button onclick="analyzeStatistics()"
                        style="background: var(--pink); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px;">
                        ğŸ“Š Statistics
                    </button>
                    <button onclick="saveFavorite()"
                        style="background: var(--lavender); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px;">
                        â­ Save Favorite
                    </button>
                    <button
                        onclick="loadFavorites(); document.getElementById('favoritesList').style.display = document.getElementById('favoritesList').style.display === 'none' ? 'block' : 'none';"
                        style="background: var(--sapphire); color: #000000; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 13px;">
                        ğŸ“‹ Favorites
                    </button>
                </div>
            </div>

            <button class="search-btn" onclick="performSearch()" id="searchBtn">ğŸ” Search Images</button>
        </div>

        <!-- Loading Indicator -->
        <div class="loading" id="loading" style="display: none;">
            <h3>ğŸ” Searching...</h3>
            <p>Analyzing color similarities and finding the best matches...</p>
        </div>

        <!-- Success Display -->
        <div class="success" id="success" style="display: none;"></div>

        <!-- Error Display -->
        <div class="error" id="error" style="display: none;"></div>

        <!-- Search Statistics -->
        <div class="search-stats" id="searchStats" style="display: none;">
            <h3>ğŸ“Š Search Performance</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="totalResults">0</div>
                    <div class="stat-label">Total Results</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="searchTime">0ms</div>
                    <div class="stat-label">Search Time</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgDistance">0.0</div>
                    <div class="stat-label">Avg Distance</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="searchMode">Standard</div>
                    <div class="stat-label">Search Mode</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="indexSize">0</div>
                    <div class="stat-label">Index Size</div>
                </div>
            </div>
        </div>

        <!-- Visualization Section -->
        <div class="visualization-section" id="visualizationSection" style="display: none;">
            <h2>ğŸ¨ Query Visualization</h2>
            <div class="viz-grid">
                <div class="viz-card"
                    style="background: linear-gradient(135deg, var(--surface1) 0%, var(--surface2) 100%); border: 2px solid var(--mauve); box-shadow: 0 8px 32px rgba(203, 166, 247, 0.1);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <div
                            style="width: 40px; height: 40px; background: linear-gradient(45deg, var(--mauve), var(--pink)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            ğŸ­
                        </div>
                        <h3
                            style="margin: 0; color: var(--text); font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                            Query Visualization</h3>
                    </div>
                    <div id="query-viz"
                        style="min-height: 300px; background: var(--base); border-radius: 12px; border: 1px solid var(--surface2); padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden;">
                        <div id="query-viz-content" style="text-align: center;">
                            <div
                                style="width: 80px; height: 80px; background: linear-gradient(45deg, var(--mauve), var(--pink)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; animation: pulse 2s infinite;">
                                <span style="font-size: 32px;">ğŸ¨</span>
                            </div>
                            <p style="color: var(--subtext1); margin: 0 0 10px 0; font-size: 16px; font-weight: 500;">
                                Click "Search Images" to generate visualization</p>
                            <p style="color: var(--subtext0); margin: 0; font-size: 14px;">Interactive color space
                                exploration and query analysis</p>
                        </div>
                    </div>
                </div>
                <div class="viz-card"
                    style="background: linear-gradient(135deg, var(--surface1) 0%, var(--surface2) 100%); border: 2px solid var(--blue); box-shadow: 0 8px 32px rgba(137, 180, 250, 0.1);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <div
                            style="width: 40px; height: 40px; background: linear-gradient(45deg, var(--blue), var(--sky)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            ğŸ–¼ï¸
                        </div>
                        <h3
                            style="margin: 0; color: var(--text); font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                            Results Preview</h3>
                    </div>
                    <div id="results-viz"
                        style="min-height: 300px; background: var(--base); border-radius: 12px; border: 1px solid var(--surface2); padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden;">
                        <div
                            style="width: 80px; height: 80px; background: linear-gradient(45deg, var(--blue), var(--sky)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; animation: pulse 2s infinite;">
                            <span style="font-size: 32px;">ğŸ–¼ï¸</span>
                        </div>
                        <p style="color: var(--subtext1); margin: 0 0 10px 0; font-size: 16px; font-weight: 500;">Click
                            "Search Images" to generate collage</p>
                        <p style="color: var(--subtext0); margin: 0; font-size: 14px;">Visual grid of top search results
                        </p>
                    </div>
                </div>
            </div>

            <!-- Histogram Analysis Section -->
            <div class="histogram-section"
                style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, var(--surface1) 0%, var(--surface2) 100%); border-radius: 12px; border: 2px solid var(--green); box-shadow: 0 8px 32px rgba(166, 227, 161, 0.1);">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                    <div
                        style="width: 40px; height: 40px; background: linear-gradient(45deg, var(--green), var(--teal)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                        ğŸ“Š
                    </div>
                    <h3 style="color: var(--text); margin: 0; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                        Histogram Analysis
                    </h3>
                </div>
                <div id="histogram-comparison"></div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <h4 style="color: var(--subtext1); margin: 0 0 10px 0; font-size: 14px;">Query Histogram</h4>
                        <div id="query-histogram"
                            style="background: var(--base); padding: 15px; border-radius: 8px; border: 1px solid var(--surface2); min-height: 200px; display: flex; align-items: center; justify-content: center; color: var(--subtext0);">
                            <p style="margin: 0; text-align: center;">Query histogram will be displayed
                                here<br><small>Shows the 1152-dimensional Lab color distribution</small></p>
                        </div>
                    </div>

                    <div>
                        <h4 style="color: var(--subtext1); margin: 0 0 10px 0; font-size: 14px;">Top Result Histogram
                        </h4>
                        <div id="result-histogram"
                            style="background: var(--base); padding: 15px; border-radius: 8px; border: 1px solid var(--surface2); min-height: 200px; display: flex; align-items: center; justify-content: center; color: var(--subtext0);">
                            <p style="margin: 0; text-align: center;">Top result histogram will be displayed
                                here<br><small>Compare with query to understand similarity</small></p>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                    <button onclick="generateHistogramVisualization()"
                        style="background: linear-gradient(45deg, var(--green), var(--teal)); color: #000000; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; box-shadow: 0 4px 15px rgba(166, 227, 161, 0.3); transition: all 0.2s; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ“ˆ</span>
                        <span>Generate Histogram Visualization</span>
                    </button>
                    <button onclick="compareHistograms()"
                        style="background: linear-gradient(45deg, var(--blue), var(--sky)); color: #000000; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; box-shadow: 0 4px 15px rgba(137, 180, 250, 0.3); transition: all 0.2s; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ”</span>
                        <span>Compare Histograms</span>
                    </button>
                    <button onclick="exportHistogramData()" <span>Export Data</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <h2>ğŸ” Top Search Results</h2>
            <div class="results-grid" id="resultsGrid"></div>

            <!-- Color Schemes Section -->
            <div class="color-schemes-section"
                style="margin-top: 30px; padding: 20px; background: var(--surface1); border-radius: 12px; border: 1px solid var(--surface2);">
                <h3
                    style="color: var(--text); margin: 0 0 15px 0; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                    ğŸ¨ Generate Color Schemes from Results
                </h3>

                <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;">
                    <button onclick="generateColorSchemesFromResults()"
                        style="background: var(--mauve); color: #000000; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s;">
                        ğŸ¨ Generate Schemes
                    </button>
                    <p style="color: var(--subtext1); margin: 0; font-size: 14px;">
                        Create harmonious color palettes based on your search results
                    </p>
                </div>
            </div>

            <!-- Results Collage Section -->
            <div class="collage-section"
                style="margin-top: 30px; padding: 20px; background: var(--surface1); border-radius: 12px; border: 1px solid var(--surface2);">
                <h3
                    style="color: var(--text); margin: 0 0 15px 0; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                    ğŸ–¼ï¸ Results Collage
                </h3>
                <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="tileCount" style="color: var(--subtext1); font-size: 14px; font-weight: 500;">Tiles
                            per row:</label>
                        <select id="tileCount"
                            style="background: var(--base); color: var(--text); border: 1px solid var(--surface2); border-radius: 6px; padding: 8px 12px; font-size: 14px;">
                            <option value="3">3x3 (9 tiles)</option>
                            <option value="4" selected>4x4 (16 tiles)</option>
                            <option value="5">5x5 (25 tiles)</option>
                            <option value="6">6x6 (36 tiles)</option>
                            <option value="8">8x8 (64 tiles)</option>
                            <option value="10">10x10 (100 tiles)</option>
                        </select>
                    </div>
                    <button onclick="generateResultsCollage()"
                        style="background: var(--mauve); color: #000000; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s;">
                        ğŸ¨ Generate Collage
                    </button>
                    <button onclick="downloadCollage()"
                        style="background: var(--green); color: #000000; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s;">
                        Download
                    </button>
                </div>

                <div id="collageContainer"
                    style="text-align: center; min-height: 200px; display: flex; align-items: center; justify-content: center; background: var(--base); border-radius: 8px; border: 1px solid var(--surface2);">
                    <p style="color: var(--subtext0); margin: 0; text-align: center;">
                        Click "Generate Collage" to create a visual grid of search results<br>
                        <small>Configure the number of tiles per row above</small>
                    </p>
                </div>
            </div>
        </div>

        <!-- Ranking Explanation -->
        <div class="ranking-explanation">
            <h3>ğŸ¯ How Images Are Ranked</h3>
            <p><strong>Two-Stage Search Process:</strong></p>
            <p>1. <strong>Fast Initial Retrieval:</strong> FAISS HNSW index finds ~100 similar candidates using L2
                distance on Hellinger-transformed histograms</p>
            <p>2. <strong>High-Fidelity Reranking:</strong> Top candidates are reranked using Sinkhorn-approximated
                Earth Mover's Distance (EMD) for perceptual color similarity</p>
            <p><strong>Distance Values:</strong> Lower distances indicate more similar color distributions. EMD values
                typically range from 0.0 (identical) to 2.0+ (very different).</p>
        </div>


        <!-- Testing Results Section -->
        <div class="testing-results-section" id="testingResultsSection"
            style="background: var(--surface0); padding: 25px; border-radius: 10px; margin: 30px 0; border: 2px solid var(--surface1); display: none;">
            <h2
                style="color: var(--text); margin-top: 0; margin-bottom: 20px; text-align: center; font-size: 1.8em; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                ğŸ“Š Testing Results</h2>
            <div id="testingResultsContent"
                style="background: var(--base); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2); min-height: 200px; display: flex; align-items: center; justify-content: center; color: var(--subtext0);">
                <div style="text-align: center;">
                    <p style="margin: 0 0 10px 0; font-size: 16px;">ğŸ§ª Testing Results</p>
                    <p style="margin: 0; font-size: 14px;">Click any testing button to see results here</p>
                    <p style="margin: 10px 0 0 0; font-size: 12px; color: var(--subtext0);">Results will be displayed in
                        this dedicated area</p>
                </div>
            </div>
        </div>

        <!-- Testing and Development Tools -->
        <div class="testing-section"
            style="background: var(--surface0); padding: 25px; border-radius: 10px; margin: 30px 0; border: 2px solid var(--surface1);">
            <h2
                style="color: var(--text); margin-top: 0; margin-bottom: 20px; text-align: center; font-size: 1.8em; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                ğŸ§ª Testing & Development Tools</h2>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <!-- Row 1: Search Testing -->
                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ” Search Testing</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Test search functionality with different performance modes and parameters. Validates both standard and fast mode searches.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="runSearchTest()"
                            style="background: var(--green); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s;"
                            onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            ğŸš€ Run Search Test
                        </button>
                        <button onclick="runPerformanceBenchmark()"
                            style="background: var(--blue); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s;"
                            onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            âš¡ Performance Test
                        </button>
                    </div>
                </div>

                <!-- Row 1: Histogram Testing -->
                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ“Š Histogram Testing</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Test histogram generation and validation. Ensures 1152-dimensional Lab histograms are correctly created and normalized.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="runHistogramTest()"
                            style="background: var(--yellow); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s;"
                            onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            ğŸ“ˆ Test Histograms
                        </button>
                        <button onclick="validateSystem()"
                            style="background: var(--red); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s;"
                            onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            âœ… Validate System
                        </button>
                    </div>
                </div>

                <!-- Row 2: System Monitoring -->
                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ“Š System Monitoring</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Monitor system status and run comprehensive diagnostics. Check API health, index size, and component availability.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="showSystemStatus()"
                            style="background: var(--mauve); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s;"
                            onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            ğŸ“Š System Status
                        </button>
                        <button onclick="runDiagnostics()"
                            style="background: var(--peach); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s;"
                            onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            ğŸ”§ Diagnostics
                        </button>
                    </div>
                </div>

                <!-- Row 2: Utilities & Export -->
                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ› ï¸ Utilities & Export</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Export logs and system information. Download diagnostic data and log file information for debugging.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="exportLogs()"
                            style="background: var(--teal); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s;"
                            onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            ğŸ“‹ Export Logs
                        </button>
                        <button onclick="showIndexInfo()"
                            style="background: var(--sapphire); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.2s;"
                            onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            ğŸ“š Index Info
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3D Visualization Section -->
        <div class="visualization-3d-section"
            style="background: var(--surface0); padding: 25px; border-radius: 10px; margin: 30px 0; border: 2px solid var(--surface1);">
            <h2
                style="color: var(--text); margin-top: 0; margin-bottom: 20px; text-align: center; font-size: 1.8em; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                ğŸ¨ Interactive 3D Visualizations</h2>
            <p style="color: var(--subtext1); text-align: center; margin-bottom: 30px; font-size: 16px;">
                Explore your color search engine data through immersive 3D visualizations powered by Three.js and
                advanced dimensionality reduction.
            </p>

            <!-- 3D Visualization Controls -->
            <div
                style="background: var(--surface1); padding: 15px; border-radius: 12px; border: 1px solid var(--surface2); margin-bottom: 20px;">
                <h4 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ›ï¸ 3D Visualization Controls</h4>
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; color: var(--subtext1); font-size: 14px;">
                        <input type="checkbox" id="enable3DAnimations" checked style="margin-right: 8px;">
                        ğŸ¬ Enable Animations
                    </label>
                    <label style="display: flex; align-items: center; color: var(--subtext1); font-size: 14px;">
                        <input type="checkbox" id="show3DAxes" checked style="margin-right: 8px;">
                        ğŸ“ Show Axes
                    </label>
                    <label style="display: flex; align-items: center; color: var(--subtext1); font-size: 14px;">
                        <input type="checkbox" id="show3DLabels" checked style="margin-right: 8px;">
                        ğŸ·ï¸ Show Labels
                    </label>
                    <button onclick="toggle3DVisualization()"
                        style="background: var(--red); color: #000000; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        â¸ï¸ Pause/Resume
                    </button>
                    <button onclick="reset3DVisualization()"
                        style="background: var(--yellow); color: #000000; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        ğŸ”„ Reset View
                    </button>
                    <button onclick="startAuto3DShowcase()"
                        style="background: var(--green); color: #000000; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        ğŸ¬ Auto 3D Showcase
                    </button>
                    <button onclick="turnOff3DVisualization()"
                        style="background: var(--red); color: #000000; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        â¹ï¸ Turn Off
                    </button>
                </div>
            </div>

            <!-- 3D Visualization Canvas Container -->
            <div id="visualization3d-container"
                style="background: var(--base); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2); min-height: 600px; display: flex; align-items: center; justify-content: center; color: var(--subtext0); position: relative;">
                <div id="3d-loading"
                    style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: var(--yellow); z-index: 1000;">
                    <div style="font-size: 24px; margin-bottom: 16px;">â³</div>
                    <div>Loading 3D visualization...</div>
                </div>
                <div id="3d-placeholder" style="text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ¨</div>
                    <div style="font-size: 18px; margin-bottom: 8px;">Interactive 3D Visualizations</div>
                    <div style="font-size: 14px; ">Select a visualization below to explore your data in 3D space</div>
                </div>
            </div>

            <!-- 3D Visualization Tools Grid - 2 rows, 3 columns -->
            <div
                style="display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, auto); gap: 20px; margin-top: 30px;">
                <!-- Row 1: Color Space Navigator, Image Globe, Connections Graph -->
                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ¨ Color Space Navigator</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Explore indexed images positioned in 3D CIE Lab color space. Each point represents an image
                        positioned by its dominant colors.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateColorSpaceNavigator()"
                            style="background: var(--mauve); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ¨ Generate Navigator
                        </button>
                        <button onclick="exportColorSpaceData()"
                            style="background: var(--teal); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>

                <!-- Row 3 (Requested order): Density Volume, OT Transport 3D, HNSW Explorer -->
                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ§Š Color Space Density Volume
                    </h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Volumetric view of dataset density in Lab; reveals global color biases.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateColorDensityVolume()"
                            style="background: var(--sapphire); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ§Š Generate Volume
                        </button>
                        <button onclick="exportColorDensityData()"
                            style="background: var(--teal); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>

                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸšš OT Transport 3D</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Visualize optimal transport from query colors to a top resultâ€™s color bins.
                    </p>
                    <div style="display: flex; gap: 5px; margin-bottom: 5px; align-items: center;">
                        <input type="text" id="otColors" placeholder="Colors (e.g., FF0000,00FF00)"
                            style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                        <button onclick="randomOTColors()"
                            style="background: var(--overlay1); color: var(--text); border: 1px solid var(--surface2); padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; white-space: nowrap;">ğŸ²
                            Random</button>
                    </div>
                    <div style="display: flex; gap: 5px; margin-bottom: 10px; align-items: center;">
                        <input type="text" id="otWeights" placeholder="Weights (e.g., 0.5,0.5)"
                            style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                        <button onclick="randomOTWeights()"
                            style="background: var(--overlay1); color: var(--text); border: 1px solid var(--surface2); padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; white-space: nowrap;">ğŸ²
                            Random</button>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateOTTransport3D()"
                            style="background: var(--flamingo); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸšš Generate Transport
                        </button>
                        <button onclick="exportOTTransportData()"
                            style="background: var(--teal); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>

                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ•¸ï¸ HNSW Graph Explorer</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Explore the ANN structure around your query using a 3D graph layout.
                    </p>
                    <div style="display: flex; gap: 5px; margin-bottom: 5px; align-items: center;">
                        <input type="text" id="hnswColors" placeholder="Colors (e.g., FF0000,00FF00)"
                            style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                        <button onclick="randomHNSWColors()"
                            style="background: var(--overlay1); color: var(--text); border: 1px solid var(--surface2); padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; white-space: nowrap;">ğŸ²
                            Random</button>
                    </div>
                    <div style="display: flex; gap: 5px; margin-bottom: 10px; align-items: center;">
                        <input type="text" id="hnswWeights" placeholder="Weights (e.g., 0.5,0.5)"
                            style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                        <button onclick="randomHNSWWeights()"
                            style="background: var(--overlay1); color: var(--text); border: 1px solid var(--surface2); padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; white-space: nowrap;">ğŸ²
                            Random</button>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateHNSWExplorer()"
                            style="background: var(--peach); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ•¸ï¸ Generate Explorer
                        </button>
                        <button onclick="exportHNSWData()"
                            style="background: var(--teal); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>
                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸŒ Image Globe</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Map images onto a 3D sphere positioned by dominant colors. Interactive exploration of your image
                        collection.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateImageGlobe()"
                            style="background: var(--sapphire); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸŒ Generate Globe
                        </button>
                        <button onclick="exportGlobeData()"
                            style="background: var(--sky); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>

                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ”— Connections Graph</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Visualize image similarity as a 3D graph with nodes and edges. Hover to see nearest neighbors.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateConnectionsGraph()"
                            style="background: var(--maroon); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ”— Generate Graph
                        </button>
                        <button onclick="exportGraphData()"
                            style="background: var(--peach); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>

                <!-- Row 2: Histogram Cloud, Reranking Animation, Similarity Landscape -->
                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ“Š Histogram Cloud</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Visualize image histograms as 3D bar charts within the Lab color cube. Click bars to see
                        contributing images.
                    </p>
                    <div style="display: flex; gap: 5px; margin-bottom: 10px; align-items: center;">
                        <input type="text" id="histogramImageId" placeholder="Image ID"
                            style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                        <button onclick="randomHistogramImageId()"
                            style="background: var(--overlay1); color: var(--text); border: 1px solid var(--surface2); padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; white-space: nowrap;">
                            ğŸ² Random
                        </button>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateHistogramCloud()"
                            style="background: var(--blue); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ“Š Generate Cloud
                        </button>
                        <button onclick="exportHistogramData()"
                            style="background: var(--green); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>

                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">âš¡ Reranking Animation</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Watch the two-stage search pipeline in action: FAISS ANN search followed by Sinkhorn-EMD
                        reranking.
                    </p>
                    <div style="display: flex; gap: 5px; margin-bottom: 5px; align-items: center;">
                        <input type="text" id="animationColors" placeholder="Colors (e.g., FF0000,00FF00)"
                            style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                        <button onclick="randomAnimationColors()"
                            style="background: var(--overlay1); color: var(--text); border: 1px solid var(--surface2); padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; white-space: nowrap;">
                            ğŸ² Random
                        </button>
                    </div>
                    <div style="display: flex; gap: 5px; margin-bottom: 10px; align-items: center;">
                        <input type="text" id="animationWeights" placeholder="Weights (e.g., 0.5,0.5)"
                            style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                        <button onclick="randomAnimationWeights()"
                            style="background: var(--overlay1); color: var(--text); border: 1px solid var(--surface2); padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; white-space: nowrap;">
                            ğŸ² Random
                        </button>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateRerankingAnimation()"
                            style="background: var(--pink); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            âš¡ Start Animation
                        </button>
                        <button onclick="exportAnimationData()"
                            style="background: var(--lavender); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>

                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ” Similarity Landscape</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Explore search results in 3D using UMAP/t-SNE projections. See how similar images cluster
                        together.
                    </p>
                    <div style="display: flex; gap: 5px; margin-bottom: 5px; align-items: center;">
                        <input type="text" id="similarityColors" placeholder="Colors (e.g., FF0000,00FF00)"
                            style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                        <button onclick="randomSimilarityColors()"
                            style="background: var(--overlay1); color: var(--text); border: 1px solid var(--surface2); padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; white-space: nowrap;">
                            ğŸ² Random
                        </button>
                    </div>
                    <div style="display: flex; gap: 5px; margin-bottom: 10px; align-items: center;">
                        <input type="text" id="similarityWeights" placeholder="Weights (e.g., 0.5,0.5)"
                            style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                        <button onclick="randomSimilarityWeights()"
                            style="background: var(--overlay1); color: var(--text); border: 1px solid var(--surface2); padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; white-space: nowrap;">
                            ğŸ² Random
                        </button>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateSimilarityLandscape()"
                            style="background: var(--red); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ” Generate Landscape
                        </button>
                        <button onclick="exportSimilarityData()"
                            style="background: var(--yellow); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>

                <!-- Row 4: Image Thumbnails 3D (Full width for better visibility) -->
                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2); grid-column: 1 / -1;">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ–¼ï¸ Image Thumbnails 3D</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Browse all indexed images as small thumbnails positioned in 3D Lab color space by their dominant
                        colors. Navigate your entire image collection visually.
                    </p>
                    <div style="display: flex; gap: 5px; margin-bottom: 10px; align-items: center;">
                        <label style="color: var(--subtext1); font-size: 14px; margin-right: 10px;">Max Images:</label>
                        <input type="number" id="thumbnailLimit" placeholder="300" min="10" max="1000" value="300"
                            style="flex: 0 0 100px; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                        <small style="color: var(--subtext0); font-size: 12px; margin-left: 10px;">10-1000 images
                            (default: 300)</small>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateImageThumbnails3D()"
                            style="background: var(--lavender); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ–¼ï¸ Generate Thumbnails
                        </button>
                        <button onclick="exportThumbnailsData()"
                            style="background: var(--teal); color: #000000; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Test Results Section -->
        <div class="quick-test-results-section" id="quickTestResultsSection"
            style="background: var(--surface0); padding: 25px; border-radius: 10px; margin: 30px 0; border: 2px solid var(--surface1); display: none;">
            <h2
                style="color: var(--text); margin-top: 0; margin-bottom: 20px; text-align: center; font-size: 1.8em; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                ğŸ§ª Quick Test Results</h2>
            <div id="quickTestResultsContent"
                style="background: var(--base); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2); min-height: 200px; display: flex; align-items: center; justify-content: center; color: var(--subtext0);">
                <div style="text-align: center;">
                    <p style="margin: 0 0 10px 0; font-size: 16px;">ğŸ¯ Quick Test Results</p>
                    <p style="margin: 0; font-size: 14px;">Click any "Quick Test" button to see results here</p>
                    <p style="margin: 10px 0 0 0; font-size: 12px; color: var(--subtext0);">Results will be displayed in
                        this dedicated area</p>
                </div>
            </div>
                </div>

                <!-- Error Display -->
                <div class="error" id="error" style="display: none;"></div>

                <!-- Image Popup Modal -->
                <div id="imageModal" class="image-modal"
                    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 1000; justify-content: center; align-items: center;">
                    <div class="image-modal-content" style="position: relative; max-width: 90%; max-height: 90%;">
                        <span class="image-close">Ã—</span>
                        <img id="modalImage" src="" alt="Full size image"
                            style="max-width: 100%; max-height: 90vh; object-fit: contain;">
                    </div>
                </div>

                <!-- Enhanced Details Modal -->
                <div id="detailsModal" class="modal" style="display: none;">
                    <div class="modal-content details-modal">
                        <div id="imageDetailsContent">
                            <!-- Content will be populated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Tool Information Modal -->
    <div id="toolModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <span class="close" onclick="closeToolModal()">&times;</span>
                        <div id="toolModalContent"></div>
                    </div>
                </div>

                <!-- Suggest Palette Modal -->
                <div id="suggestPaletteModal" class="modal"
                    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 1000; overflow: auto;">
                    <div class="modal-content"
                        style="background: var(--base); padding: 30px; border-radius: 12px; border: 2px solid var(--surface1); width: 90%; max-width: 700px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4); max-height: 90vh; overflow-y: auto;">
            <span class="close" onclick="window.closeSuggestPaletteModal(); return false;"
                            style="position: absolute; top: 15px; right: 20px; color: var(--text); font-size: 32px; font-weight: bold; cursor: pointer; line-height: 1; transition: color 0.2s;">&times;</span>
                        
            <h2
                style="color: var(--text); margin-top: 0; margin-bottom: 10px; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                            ğŸ¨ Suggest Color Palette</h2>
                        
            <div
                style="background: var(--surface0); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--surface1);">
                            <p style="color: var(--subtext1); margin: 0; font-size: 14px; line-height: 1.6;">
                                <strong style="color: var(--text);">Current Colors:</strong>
                    <span id="currentColorsDisplay"
                        style="display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap;"></span>
                            </p>
                            <p style="color: var(--subtext0); margin: 10px 0 0 0; font-size: 12px; font-style: italic;">
                                Palettes will be generated based on your first color selection
                            </p>
                        </div>

                        <div class="scheme-modes"
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                            <!-- Monochromatic -->
                            <div class="scheme-mode" onclick="generatePalette('monochromatic')"
                                style="cursor: pointer; padding: 20px; background: var(--surface0); border: 2px solid var(--surface2); border-radius: 10px; transition: all 0.3s; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">â¬›</div>
                    <h3 style="margin: 0 0 8px 0; color: var(--mauve); font-size: 16px; font-weight: 600;">Monochromatic
                    </h3>
                    <p style="color: var(--subtext1); margin: 0; font-size: 12px; line-height: 1.4;">Different shades
                        and tints of a single color</p>
                            </div>

                            <!-- Complementary -->
                            <div class="scheme-mode" onclick="generatePalette('complementary')"
                                style="cursor: pointer; padding: 20px; background: var(--surface0); border: 2px solid var(--surface2); border-radius: 10px; transition: all 0.3s; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">ğŸ¨</div>
                    <h3 style="margin: 0 0 8px 0; color: var(--blue); font-size: 16px; font-weight: 600;">Complementary
                    </h3>
                    <p style="color: var(--subtext1); margin: 0; font-size: 12px; line-height: 1.4;">Two colors opposite
                        on the color wheel</p>
                            </div>

                            <!-- Analogous -->
                            <div class="scheme-mode" onclick="generatePalette('analogous')"
                                style="cursor: pointer; padding: 20px; background: var(--surface0); border: 2px solid var(--surface2); border-radius: 10px; transition: all 0.3s; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">ğŸŒˆ</div>
                    <h3 style="margin: 0 0 8px 0; color: var(--green); font-size: 16px; font-weight: 600;">Analogous
                    </h3>
                    <p style="color: var(--subtext1); margin: 0; font-size: 12px; line-height: 1.4;">Colors adjacent on
                        the color wheel</p>
                            </div>

                            <!-- Triadic -->
                            <div class="scheme-mode" onclick="generatePalette('triadic')"
                                style="cursor: pointer; padding: 20px; background: var(--surface0); border: 2px solid var(--surface2); border-radius: 10px; transition: all 0.3s; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">ğŸ­</div>
                                <h3 style="margin: 0 0 8px 0; color: var(--red); font-size: 16px; font-weight: 600;">Triadic</h3>
                    <p style="color: var(--subtext1); margin: 0; font-size: 12px; line-height: 1.4;">Three colors evenly
                        spaced on the wheel</p>
                            </div>

                            <!-- Split Complementary -->
                            <div class="scheme-mode" onclick="generatePalette('split-complementary')"
                                style="cursor: pointer; padding: 20px; background: var(--surface0); border: 2px solid var(--surface2); border-radius: 10px; transition: all 0.3s; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">âœ¨</div>
                    <h3 style="margin: 0 0 8px 0; color: var(--peach); font-size: 16px; font-weight: 600;">Split
                        Complementary</h3>
                    <p style="color: var(--subtext1); margin: 0; font-size: 12px; line-height: 1.4;">One color and two
                        adjacent to its complement</p>
                            </div>

                            <!-- Random Harmony -->
                            <div class="scheme-mode" onclick="generatePalette('random')"
                                style="cursor: pointer; padding: 20px; background: var(--surface0); border: 2px solid var(--surface2); border-radius: 10px; transition: all 0.3s; text-align: center;">
                                <div style="font-size: 32px; margin-bottom: 10px;">ğŸ²</div>
                    <h3 style="margin: 0 0 8px 0; color: var(--yellow); font-size: 16px; font-weight: 600;">Random
                        Harmony</h3>
                    <p style="color: var(--subtext1); margin: 0; font-size: 12px; line-height: 1.4;">Randomly selected
                        harmonious colors</p>
                            </div>
                        </div>

            <div id="generatedPalette"
                style="margin-top: 30px; display: none; padding: 20px; background: var(--surface0); border-radius: 10px; border: 2px solid var(--surface1);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="color: var(--text); margin: 0; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                        Generated Palette</h3>
                                <span id="paletteCount" style="color: var(--subtext1); font-size: 12px;"></span>
                            </div>
                            <div id="palettePreview"
                    style="display: flex; gap: 8px; margin: 15px 0; flex-wrap: wrap; min-height: 80px; align-items: stretch;">
                </div>
                            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                                <button onclick="window.closeSuggestPaletteModal(); return false;"
                                    style="background: var(--surface2); color: var(--text); border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">
                                    Cancel
                                </button>
                                <button onclick="applyGeneratedPalette()"
                        style="background: var(--blue); color: #000000; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s;">
                                    âœ“ Apply Palette
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Image Upload Modal -->
                <div id="imageUploadModal" class="modal"
                    style="display: none; position: absolute !important; top: 50% !important; left: 50% !important; transform: translate(-50%, -50%); width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 9999; overflow: auto; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box;">
                    <div class="modal-content"
                        style="width: 90%; max-width: 600px; background: var(--base); padding: 30px; border-radius: 12px; border: 2px solid var(--surface1);">
                        <span class="close" onclick="closeImageUploadModal()"
                            style="color: var(--text); float: right; font-size: 28px; font-weight: bold; cursor: pointer; line-height: 20px;">&times;</span>
                        <h2 style="color: var(--text); margin-top: 0;">ğŸ–¼ï¸ Upload Image to Extract Colors</h2>
                        <p style="color: var(--subtext1); margin-bottom: 20px;">Drag and drop an image here, or click to
                            select a file.</p>

                        <div id="imageUploadArea"
                            style="border: 3px dashed var(--surface2); border-radius: 12px; padding: 40px; text-align: center; background: var(--surface0); cursor: pointer; transition: all 0.3s; margin-bottom: 20px;"
                ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)"
                            onclick="document.getElementById('imageFileInput').click()">
                            <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“</div>
                            <div style="color: var(--text); font-size: 16px; font-weight: bold; margin-bottom: 10px;">
                                Drop image here or click to upload</div>
                            <div style="color: var(--subtext1); font-size: 14px;">Supports: JPG, PNG, GIF, WebP</div>
                            <input type="file" id="imageFileInput" accept="image/*" style="display: none;"
                                onchange="handleFileSelect(event)">
                        </div>

                        <div id="imagePreview" style="display: none; margin-bottom: 20px;">
                            <img id="uploadedImagePreview" src="" alt="Preview"
                                style="max-width: 100%; max-height: 300px; border-radius: 8px; border: 2px solid var(--surface2);">
                        </div>

                        <div style="margin-bottom: 20px;">
                <label style="display: block; color: var(--text); margin-bottom: 10px; font-weight: bold;">Number
                                of colors to extract:</label>
                            <input type="number" id="numColorsToExtract" min="1" max="10" value="5"
                                style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text); font-size: 14px;">
                            <small style="color: var(--subtext1); font-size: 12px;">Choose how many dominant colors to
                                extract (1-10)</small>
                        </div>

                        <div id="extractionStatus" style="display: none; margin-bottom: 20px;">
                <div style="background: var(--surface1); padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="color: var(--yellow); font-size: 18px; margin-bottom: 10px;">â³</div>
                                <div style="color: var(--text);">Extracting colors...</div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button onclick="closeImageUploadModal()"
                                style="background: var(--surface2); color: var(--text); border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px;">Cancel</button>
                            <button onclick="extractColorsFromImage()"
                    style="background: var(--teal); color: #000000; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: bold;">Extract
                                Colors</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sticky Restart Button -->
            <div id="restartButton"
        style="position: fixed; top: 20px; right: 20px; z-index: 1000; background: var(--red); color: #000000; border: none; padding: 12px 16px; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); font-size: 14px; font-weight: bold; transition: all 0.3s ease;"
                onclick="restartServer()" title="Restart Chromatica Server">
                ğŸ”„ Restart Server
            </div>

            <script src="/static/js/main.js" type="text/javascript"></script>
            <script src="/static/js/advanced_features.js" type="text/javascript"></script>
            <script src="/static/js/color_wheel.js" type="text/javascript"></script>

            <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

            <!-- <script type="module" src="/static/js/main.js"></script> -->
</body>

</html>