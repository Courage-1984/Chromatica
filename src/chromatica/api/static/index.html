<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chromatica Color Search Engine</title>

    <!-- Three.js for 3D visualizations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23cba6f7'/><circle cx='30' cy='30' r='15' fill='%23f5c2e7'/><circle cx='70' cy='30' r='15' fill='%23f2cdcd'/><circle cx='30' cy='70' r='15' fill='%23a6e3a1'/><circle cx='70' cy='70' r='15' fill='%23f9e2af'/></svg>">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23cba6f7'/><circle cx='30' cy='30' r='15' fill='%23f5c2e7'/><circle cx='70' cy='30' r='15' fill='%23f2cdcd'/><circle cx='30' cy='70' r='15' fill='%23a6e3a1'/><circle cx='70' cy='70' r='15' fill='%23f9e2af'/></svg>">
    <link rel="shortcut icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23cba6f7'/><circle cx='30' cy='30' r='15' fill='%23f5c2e7'/><circle cx='70' cy='30' r='15' fill='%23f2cdcd'/><circle cx='30' cy='70' r='15' fill='%23a6e3a1'/><circle cx='70' cy='70' r='15' fill='%23f9e2af'/></svg>">
    <link rel="apple-touch-icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23cba6f7'/><circle cx='30' cy='30' r='15' fill='%23f5c2e7'/><circle cx='70' cy='30' r='15' fill='%23f2cdcd'/><circle cx='30' cy='70' r='15' fill='%23a6e3a1'/><circle cx='70' cy='70' r='15' fill='%23f9e2af'/></svg>">

    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
    <link rel="manifest" href="/static/site.webmanifest">

    <link rel="stylesheet" type="text/css" href="/static/css/styles.css">

</head>

<body>
    <div class="container">
        <h1>ğŸ¨ Chromatica Color Search Engine</h1>

        <!-- Color Input Section -->
        <div class="color-input-section">
            <h2>Color Query</h2>
            <div id="colorInputs">
                <div class="color-row">
                    <input type="color" class="color-picker" value="#FF0000">
                    <input type="range" class="weight-slider" min="0" max="100" value="100" step="1">
                    <span class="weight-value">100%</span>
                    <button onclick="removeColor(this)"
                        style="background: #e53e3e; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;">Remove</button>
                </div>
            </div>
            <!-- Color Suggestions -->
            <div id="colorSuggestions"></div>
            <div style="display: flex; gap: 10px; margin: 15px 0;">
                <button class="add-color-btn" onclick="addColor()">+ Add Another Color</button>
                <button class="suggest-palette-btn" onclick="showSuggestPaletteModal()"
                    style="background: var(--mauve); color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 16px;">ğŸ¨</span>
                    <span>Suggest Palette</span>
                </button>
            </div>

            <!-- Performance Tuning Options -->
            <div class="performance-options"
                style="margin: 20px 0; padding: 20px; background: var(--surface0); border-radius: 12px; border: 1px solid var(--surface1);">
                <h4
                    style="margin: 0 0 15px 0; color: var(--text); font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                    âš¡ Performance Tuning</h4>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                    <div>
                        <label
                            style="display: block; margin-bottom: 8px; color: var(--subtext1); font-size: 14px; font-weight: 500;">
                            <input type="checkbox" id="fastMode" style="margin-right: 8px;">
                            ğŸš€ Fast Mode (100x faster)
                        </label>
                        <p style="margin: 0; font-size: 12px; color: var(--subtext0); line-height: 1.4;">
                            Use approximate L2 distance instead of Sinkhorn-EMD for much faster results
                        </p>
                    </div>

                    <div>
                        <label
                            style="display: block; margin-bottom: 8px; color: var(--subtext1); font-size: 14px; font-weight: 500;">
                            Batch Size: <span id="batchSizeValue">10</span>
                        </label>
                        <input type="range" id="batchSize" min="5" max="50" value="10" step="5"
                            style="width: 100%; margin-bottom: 5px;"
                            oninput="document.getElementById('batchSizeValue').textContent = this.value;">
                        <p style="margin: 0; font-size: 12px; color: var(--subtext0); line-height: 1.4;">
                            Higher values improve memory efficiency for large datasets
                        </p>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <label style="display: flex; align-items: center; color: var(--subtext1); font-size: 14px;">
                        <input type="range" id="resultCount" min="5" max="50" value="10" step="5"
                            style="margin-right: 8px;"
                            oninput="document.getElementById('resultCountValue').textContent = this.value;">
                        Results: <span id="resultCountValue">10</span>
                    </label>

                    <button onclick="showPerformanceInfo()"
                        style="background: var(--blue); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        â„¹ï¸ Info
                    </button>
                </div>
            </div>

            <button class="search-btn" onclick="performSearch()" id="searchBtn">ğŸ” Search Images</button>
        </div>

        <!-- Loading Indicator -->
        <div class="loading" id="loading" style="display: none;">
            <h3>ğŸ” Searching...</h3>
            <p>Analyzing color similarities and finding the best matches...</p>
        </div>

        <!-- Success Display -->
        <div class="success" id="success" style="display: none;"></div>

        <!-- Error Display -->
        <div class="error" id="error" style="display: none;"></div>

        <!-- Search Statistics -->
        <div class="search-stats" id="searchStats" style="display: none;">
            <h3>ğŸ“Š Search Performance</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="totalResults">0</div>
                    <div class="stat-label">Total Results</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="searchTime">0ms</div>
                    <div class="stat-label">Search Time</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgDistance">0.0</div>
                    <div class="stat-label">Avg Distance</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="searchMode">Standard</div>
                    <div class="stat-label">Search Mode</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="indexSize">0</div>
                    <div class="stat-label">Index Size</div>
                </div>
            </div>
        </div>

        <!-- Visualization Section -->
        <div class="visualization-section" id="visualizationSection" style="display: none;">
            <h2>ğŸ¨ Query Visualization</h2>
            <div class="viz-grid">
                <div class="viz-card"
                    style="background: linear-gradient(135deg, var(--surface1) 0%, var(--surface2) 100%); border: 2px solid var(--mauve); box-shadow: 0 8px 32px rgba(203, 166, 247, 0.1);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <div
                            style="width: 40px; height: 40px; background: linear-gradient(45deg, var(--mauve), var(--pink)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            ğŸ­
                        </div>
                        <h3
                            style="margin: 0; color: var(--text); font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                            Query Visualization</h3>
                    </div>
                    <div id="query-viz"
                        style="min-height: 300px; background: var(--base); border-radius: 12px; border: 1px solid var(--surface2); padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden;">
                        <div id="query-viz-content" style="text-align: center;">
                            <div
                                style="width: 80px; height: 80px; background: linear-gradient(45deg, var(--mauve), var(--pink)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; animation: pulse 2s infinite;">
                                <span style="font-size: 32px;">ğŸ¨</span>
                            </div>
                            <p style="color: var(--subtext1); margin: 0 0 10px 0; font-size: 16px; font-weight: 500;">
                                Click "Search Images" to generate visualization</p>
                            <p style="color: var(--subtext0); margin: 0; font-size: 14px;">Interactive color space
                                exploration and query analysis</p>
                        </div>
                    </div>
                </div>
                <div class="viz-card"
                    style="background: linear-gradient(135deg, var(--surface1) 0%, var(--surface2) 100%); border: 2px solid var(--blue); box-shadow: 0 8px 32px rgba(137, 180, 250, 0.1);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <div
                            style="width: 40px; height: 40px; background: linear-gradient(45deg, var(--blue), var(--sky)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                            ğŸ–¼ï¸
                        </div>
                        <h3
                            style="margin: 0; color: var(--text); font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                            Results Preview</h3>
                    </div>
                    <div id="results-viz"
                        style="min-height: 300px; background: var(--base); border-radius: 12px; border: 1px solid var(--surface2); padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden;">
                        <div
                            style="width: 80px; height: 80px; background: linear-gradient(45deg, var(--blue), var(--sky)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; animation: pulse 2s infinite;">
                            <span style="font-size: 32px;">ğŸ–¼ï¸</span>
                        </div>
                        <p style="color: var(--subtext1); margin: 0 0 10px 0; font-size: 16px; font-weight: 500;">Click
                            "Search Images" to generate collage</p>
                        <p style="color: var(--subtext0); margin: 0; font-size: 14px;">Visual grid of top search results
                        </p>
                    </div>
                </div>
            </div>

            <!-- Histogram Analysis Section -->
            <div class="histogram-section"
                style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, var(--surface1) 0%, var(--surface2) 100%); border-radius: 12px; border: 2px solid var(--green); box-shadow: 0 8px 32px rgba(166, 227, 161, 0.1);">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                    <div
                        style="width: 40px; height: 40px; background: linear-gradient(45deg, var(--green), var(--teal)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                        ğŸ“Š
                    </div>
                    <h3 style="color: var(--text); margin: 0; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                        Histogram Analysis
                    </h3>
                </div>
                <div id="histogram-comparison"></div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <h4 style="color: var(--subtext1); margin: 0 0 10px 0; font-size: 14px;">Query Histogram</h4>
                        <div id="query-histogram"
                            style="background: var(--base); padding: 15px; border-radius: 8px; border: 1px solid var(--surface2); min-height: 200px; display: flex; align-items: center; justify-content: center; color: var(--subtext0);">
                            <p style="margin: 0; text-align: center;">Query histogram will be displayed
                                here<br><small>Shows the 1152-dimensional Lab color distribution</small></p>
                        </div>
                    </div>

                    <div>
                        <h4 style="color: var(--subtext1); margin: 0 0 10px 0; font-size: 14px;">Top Result Histogram
                        </h4>
                        <div id="result-histogram"
                            style="background: var(--base); padding: 15px; border-radius: 8px; border: 1px solid var(--surface2); min-height: 200px; display: flex; align-items: center; justify-content: center; color: var(--subtext0);">
                            <p style="margin: 0; text-align: center;">Top result histogram will be displayed
                                here<br><small>Compare with query to understand similarity</small></p>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                    <button onclick="generateHistogramVisualization()"
                        style="background: linear-gradient(45deg, var(--green), var(--teal)); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; box-shadow: 0 4px 15px rgba(166, 227, 161, 0.3); transition: all 0.2s; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ“ˆ</span>
                        <span>Generate Histogram Visualization</span>
                    </button>
                    <button onclick="compareHistograms()"
                        style="background: linear-gradient(45deg, var(--blue), var(--sky)); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; box-shadow: 0 4px 15px rgba(137, 180, 250, 0.3); transition: all 0.2s; display: flex; align-items: center; gap: 8px;">
                        <span>ğŸ”</span>
                        <span>Compare Histograms</span>
                    </button>
                    <button onclick="exportHistogramData()" <span>Export Data</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <h2>ğŸ” Top Search Results</h2>
            <div class="results-grid" id="resultsGrid"></div>

            <!-- Color Schemes Section -->
            <div class="color-schemes-section"
                style="margin-top: 30px; padding: 20px; background: var(--surface1); border-radius: 12px; border: 1px solid var(--surface2);">
                <h3
                    style="color: var(--text); margin: 0 0 15px 0; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                    ğŸ¨ Generate Color Schemes from Results
                </h3>

                <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;">
                    <button onclick="generateColorSchemesFromResults()"
                        style="background: var(--mauve); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s;">
                        ğŸ¨ Generate Schemes
                    </button>
                    <p style="color: var(--subtext1); margin: 0; font-size: 14px;">
                        Create harmonious color palettes based on your search results
                    </p>
                </div>
            </div>

            <!-- Results Collage Section -->
            <div class="collage-section"
                style="margin-top: 30px; padding: 20px; background: var(--surface1); border-radius: 12px; border: 1px solid var(--surface2);">
                <h3
                    style="color: var(--text); margin: 0 0 15px 0; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                    ğŸ–¼ï¸ Results Collage
                </h3>
                <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="tileCount" style="color: var(--subtext1); font-size: 14px; font-weight: 500;">Tiles
                            per row:</label>
                        <select id="tileCount"
                            style="background: var(--base); color: var(--text); border: 1px solid var(--surface2); border-radius: 6px; padding: 8px 12px; font-size: 14px;">
                            <option value="3">3x3 (9 tiles)</option>
                            <option value="4" selected>4x4 (16 tiles)</option>
                            <option value="5">5x5 (25 tiles)</option>
                            <option value="6">6x6 (36 tiles)</option>
                            <option value="8">8x8 (64 tiles)</option>
                            <option value="10">10x10 (100 tiles)</option>
                        </select>
                    </div>
                    <button onclick="generateResultsCollage()"
                        style="background: var(--mauve); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s;">
                        ğŸ¨ Generate Collage
                    </button>
                    <button onclick="downloadCollage()"
                        style="background: var(--green); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s;">
                        Download
                    </button>
                </div>

                <div id="collageContainer"
                    style="text-align: center; min-height: 200px; display: flex; align-items: center; justify-content: center; background: var(--base); border-radius: 8px; border: 1px solid var(--surface2);">
                    <p style="color: var(--subtext0); margin: 0; text-align: center;">
                        Click "Generate Collage" to create a visual grid of search results<br>
                        <small>Configure the number of tiles per row above</small>
                    </p>
                </div>
            </div>
        </div>

        <!-- Ranking Explanation -->
        <div class="ranking-explanation">
            <h3>ğŸ¯ How Images Are Ranked</h3>
            <p><strong>Two-Stage Search Process:</strong></p>
            <p>1. <strong>Fast Initial Retrieval:</strong> FAISS HNSW index finds ~100 similar candidates using L2
                distance on Hellinger-transformed histograms</p>
            <p>2. <strong>High-Fidelity Reranking:</strong> Top candidates are reranked using Sinkhorn-approximated
                Earth Mover's Distance (EMD) for perceptual color similarity</p>
            <p><strong>Distance Values:</strong> Lower distances indicate more similar color distributions. EMD values
                typically range from 0.0 (identical) to 2.0+ (very different).</p>
        </div>


        <!-- Testing Results Section -->
        <div class="testing-results-section" id="testingResultsSection"
            style="background: var(--surface0); padding: 25px; border-radius: 10px; margin: 30px 0; border: 2px solid var(--surface1); display: none;">
            <h2
                style="color: var(--text); margin-top: 0; margin-bottom: 20px; text-align: center; font-size: 1.8em; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                ğŸ“Š Testing Results</h2>
            <div id="testingResultsContent"
                style="background: var(--base); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2); min-height: 200px; display: flex; align-items: center; justify-content: center; color: var(--subtext0);">
                <div style="text-align: center;">
                    <p style="margin: 0 0 10px 0; font-size: 16px;">ğŸ§ª Testing Results</p>
                    <p style="margin: 0; font-size: 14px;">Click any testing button to see results here</p>
                    <p style="margin: 10px 0 0 0; font-size: 12px; color: var(--subtext0);">Results will be displayed in
                        this dedicated area</p>
                </div>
            </div>
        </div>

        <!-- Testing and Development Tools -->
        <div class="testing-section"
            style="background: var(--surface0); padding: 25px; border-radius: 10px; margin: 30px 0; border: 2px solid var(--surface1);">
            <h2
                style="color: var(--text); margin-top: 0; margin-bottom: 20px; text-align: center; font-size: 1.8em; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                ğŸ§ª Testing & Development Tools</h2>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ” Search Testing</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Test search functionality with different performance modes and parameters.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="runSearchTest()"
                            style="background: var(--green); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸš€ Run Search Test
                        </button>
                        <button onclick="runPerformanceBenchmark()"
                            style="background: var(--blue); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            âš¡ Performance Test
                        </button>
                    </div>
                </div>

                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ“Š Histogram Testing</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Test histogram generation and validation with sample images.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="runHistogramTest()"
                            style="background: var(--yellow); color: var(--base); border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ“ˆ Test Histograms
                        </button>
                        <button onclick="validateSystem()"
                            style="background: var(--red); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            âœ… Validate System
                        </button>
                    </div>
                </div>
            </div>

            <div
                style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ› ï¸ Development Tools</h3>
                <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                    Advanced tools for system monitoring, debugging, and development.
                </p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="showSystemStatus()"
                        style="background: var(--mauve); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                        ğŸ“Š System Status
                    </button>
                    <button onclick="runDiagnostics()"
                        style="background: var(--peach); color: var(--base); border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                        ğŸ”§ Diagnostics
                    </button>
                    <button onclick="exportLogs()"
                        style="background: var(--teal); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                        ğŸ“‹ Export Logs
                    </button>
                </div>
            </div>
        </div>

        <!-- 3D Visualization Section -->
        <div class="visualization-3d-section"
            style="background: var(--surface0); padding: 25px; border-radius: 10px; margin: 30px 0; border: 2px solid var(--surface1);">
            <h2
                style="color: var(--text); margin-top: 0; margin-bottom: 20px; text-align: center; font-size: 1.8em; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                ğŸ¨ Interactive 3D Visualizations</h2>
            <p style="color: var(--subtext1); text-align: center; margin-bottom: 30px; font-size: 16px;">
                Explore your color search engine data through immersive 3D visualizations powered by Three.js and
                advanced dimensionality reduction.
            </p>

            <!-- 3D Visualization Controls -->
            <div
                style="background: var(--surface1); padding: 15px; border-radius: 12px; border: 1px solid var(--surface2); margin-bottom: 20px;">
                <h4 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ›ï¸ 3D Visualization Controls</h4>
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; color: var(--subtext1); font-size: 14px;">
                        <input type="checkbox" id="enable3DAnimations" checked style="margin-right: 8px;">
                        ğŸ¬ Enable Animations
                    </label>
                    <label style="display: flex; align-items: center; color: var(--subtext1); font-size: 14px;">
                        <input type="checkbox" id="show3DAxes" checked style="margin-right: 8px;">
                        ğŸ“ Show Axes
                    </label>
                    <label style="display: flex; align-items: center; color: var(--subtext1); font-size: 14px;">
                        <input type="checkbox" id="show3DLabels" checked style="margin-right: 8px;">
                        ğŸ·ï¸ Show Labels
                    </label>
                    <button onclick="toggle3DVisualization()"
                        style="background: var(--red); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        â¸ï¸ Pause/Resume
                    </button>
                    <button onclick="reset3DVisualization()"
                        style="background: var(--yellow); color: var(--base); border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        ğŸ”„ Reset View
                    </button>
                    <button onclick="turnOff3DVisualization()"
                        style="background: var(--red); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        â¹ï¸ Turn Off
                    </button>
                </div>
            </div>

            <!-- 3D Visualization Canvas Container -->
            <div id="visualization3d-container"
                style="background: var(--base); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2); min-height: 600px; display: flex; align-items: center; justify-content: center; color: var(--subtext0); position: relative;">
                <div id="3d-loading"
                    style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: var(--yellow); z-index: 1000;">
                    <div style="font-size: 24px; margin-bottom: 16px;">â³</div>
                    <div>Loading 3D visualization...</div>
                </div>
                <div id="3d-placeholder" style="text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ¨</div>
                    <div style="font-size: 18px; margin-bottom: 8px;">Interactive 3D Visualizations</div>
                    <div style="font-size: 14px; ">Select a visualization below to explore your data in 3D space</div>
                </div>
            </div>

            <!-- 3D Visualization Tools Grid -->
            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px;">
                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ¨ Color Space Navigator</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Explore indexed images positioned in 3D CIE Lab color space. Each point represents an image
                        positioned by its dominant colors.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateColorSpaceNavigator()"
                            style="background: var(--mauve); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ¨ Generate Navigator
                        </button>
                        <button onclick="exportColorSpaceData()"
                            style="background: var(--teal); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>

                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ“Š Histogram Cloud</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Visualize image histograms as 3D bar charts within the Lab color cube. Click bars to see
                        contributing images.
                    </p>
                    <input type="text" id="histogramImageId" placeholder="Image ID"
                        style="margin-bottom: 10px; width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateHistogramCloud()"
                            style="background: var(--blue); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ“Š Generate Cloud
                        </button>
                        <button onclick="exportHistogramData()"
                            style="background: var(--green); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>

                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ” Similarity Landscape</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Explore search results in 3D using UMAP/t-SNE projections. See how similar images cluster
                        together.
                    </p>
                    <input type="text" id="similarityColors" placeholder="Colors (e.g., FF0000,00FF00)"
                        style="margin-bottom: 5px; width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                    <input type="text" id="similarityWeights" placeholder="Weights (e.g., 0.5,0.5)"
                        style="margin-bottom: 10px; width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateSimilarityLandscape()"
                            style="background: var(--red); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ” Generate Landscape
                        </button>
                        <button onclick="exportSimilarityData()"
                            style="background: var(--yellow); color: var(--base); border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>

                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">âš¡ Reranking Animation</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Watch the two-stage search pipeline in action: FAISS ANN search followed by Sinkhorn-EMD
                        reranking.
                    </p>
                    <input type="text" id="animationColors" placeholder="Colors (e.g., FF0000,00FF00)"
                        style="margin-bottom: 5px; width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                    <input type="text" id="animationWeights" placeholder="Weights (e.g., 0.5,0.5)"
                        style="margin-bottom: 10px; width: 100%; padding: 8px; border-radius: 4px; border: 1px solid var(--surface2); background: var(--surface0); color: var(--text);">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateRerankingAnimation()"
                            style="background: var(--pink); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            âš¡ Start Animation
                        </button>
                        <button onclick="exportAnimationData()"
                            style="background: var(--lavender); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>

                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸŒ Image Globe</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Map images onto a 3D sphere positioned by dominant colors. Interactive exploration of your image
                        collection.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateImageGlobe()"
                            style="background: var(--sapphire); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸŒ Generate Globe
                        </button>
                        <button onclick="exportGlobeData()"
                            style="background: var(--sky); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>

                <div
                    style="background: var(--surface1); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2);">
                    <h3 style="color: var(--text); margin: 0 0 15px 0; font-size: 16px;">ğŸ”— Connections Graph</h3>
                    <p style="color: var(--subtext1); margin: 0 0 15px 0; font-size: 14px; line-height: 1.4;">
                        Visualize image similarity as a 3D graph with nodes and edges. Hover to see nearest neighbors.
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="generateConnectionsGraph()"
                            style="background: var(--maroon); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ”— Generate Graph
                        </button>
                        <button onclick="exportGraphData()"
                            style="background: var(--peach); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                            ğŸ’¾ Export Data
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Test Results Section -->
        <div class="quick-test-results-section" id="quickTestResultsSection"
            style="background: var(--surface0); padding: 25px; border-radius: 10px; margin: 30px 0; border: 2px solid var(--surface1); display: none;">
            <h2
                style="color: var(--text); margin-top: 0; margin-bottom: 20px; text-align: center; font-size: 1.8em; font-family: 'JetBrainsMono Nerd Font Mono', monospace;">
                ğŸ§ª Quick Test Results</h2>
            <div id="quickTestResultsContent"
                style="background: var(--base); padding: 20px; border-radius: 12px; border: 1px solid var(--surface2); min-height: 200px; display: flex; align-items: center; justify-content: center; color: var(--subtext0);">
                <div style="text-align: center;">
                    <p style="margin: 0 0 10px 0; font-size: 16px;">ğŸ¯ Quick Test Results</p>
                    <p style="margin: 0; font-size: 14px;">Click any "Quick Test" button to see results here</p>
                    <p style="margin: 10px 0 0 0; font-size: 12px; color: var(--subtext0);">Results will be displayed in
                        this dedicated area</p>
                </div>
            </div>
        </div>

        <!-- Advanced Visualization Tools -->
        <div class="tools-section">
            <h2>ğŸ¨ Advanced Visualization Tools</h2>
            <p>Professional-grade tools for color analysis, search result visualization, and data exploration.</p>
        </div>

        <!-- Visualization Tools Section -->
        <div class="visualization-tools-section">
            <h2>ğŸ”¬ Advanced Visualization Tools</h2>

            <!-- Core Visualization Tools -->
            <div class="tool-category">
                <h3>ğŸ¨ Core Visualization Module</h3>
                <p>Built-in visualization capabilities for queries and search results, including weighted color bars,
                    color palettes, and result collages.</p>
            </div>

            <div class="tools-grid">
                <!-- Color Palette Visualization Tool -->
                <div class="tool-card">
                    <div class="tool-header">
                        <div class="tool-icon">ğŸ¨</div>
                        <h4 class="tool-title">Color Palette Analyzer</h4>
                    </div>
                    <div class="tool-description">
                        Comprehensive analysis and visualization of color palettes extracted from images, including
                        dominant colors, distribution patterns, and palette comparison.
                    </div>
                    <div class="tool-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Extract dominant colors using K-means clustering</li>
                            <li>Generate color swatches and distribution charts</li>
                            <li>Compare palettes between multiple images</li>
                            <li>L*a*b* color space projections</li>
                            <li>Export palette visualizations</li>
                        </ul>
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn primary-btn" onclick="runColorPaletteTool()">Run Tool</button>
                        <button class="tool-btn info-btn" onclick="showToolInfo('color-palette')">Info</button>
                        <button class="tool-btn quick-test-btn" onclick="quickTestColorPalette()">Quick Test</button>
                    </div>

                    <!-- Expandable Tool Panel -->
                    <div class="tool-panel" id="colorPalettePanel" style="display: none;">
                        <div class="panel-header">
                            <h5>ğŸ¨ Color Palette Analysis Configuration</h5>
                            <button class="panel-close" onclick="toggleToolPanel('colorPalettePanel')">Ã—</button>
                        </div>

                        <div class="panel-content">
                            <div class="input-section">
                                <h6>Image Input</h6>
                                <div class="input-group">
                                    <label for="colorPaletteImage">Select Image:</label>
                                    <input type="file" id="colorPaletteImage" accept="image/*" class="file-input">
                                    <small>Supported formats: JPG, PNG, GIF</small>
                                </div>

                                <div class="input-group">
                                    <label for="colorPaletteDirectory">Or Select Directory:</label>
                                    <input type="text" id="colorPaletteDirectory"
                                        placeholder="e.g., datasets/test-dataset-20" class="text-input">
                                    <button class="browse-btn"
                                        onclick="browseDirectory('colorPaletteDirectory')">Browse</button>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Analysis Parameters</h6>
                                <div class="input-group">
                                    <label for="colorPaletteNumColors">Number of Dominant Colors:</label>
                                    <input type="number" id="colorPaletteNumColors" min="2" max="20" value="5"
                                        class="number-input">
                                    <small>Range: 2-20 colors</small>
                                </div>

                                <div class="input-group">
                                    <label for="colorPaletteColorSpace">Color Space:</label>
                                    <select id="colorPaletteColorSpace" class="select-input">
                                        <option value="lab">L*a*b* (Recommended)</option>
                                        <option value="rgb">RGB</option>
                                        <option value="hsv">HSV</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="colorPaletteClustering">Clustering Method:</label>
                                    <select id="colorPaletteClustering" class="select-input">
                                        <option value="kmeans">K-Means (Default)</option>
                                        <option value="dbscan">DBSCAN</option>
                                        <option value="hierarchical">Hierarchical</option>
                                    </select>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Output Options</h6>
                                <div class="input-group">
                                    <label for="colorPaletteOutputFormat">Output Format:</label>
                                    <select id="colorPaletteOutputFormat" class="select-input">
                                        <option value="png">PNG Image</option>
                                        <option value="pdf">PDF Report</option>
                                        <option value="json">JSON Data</option>
                                        <option value="csv">CSV Data</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="colorPaletteResolution">Image Resolution:</label>
                                    <select id="colorPaletteResolution" class="select-input">
                                        <option value="low">Low (800x600)</option>
                                        <option value="medium" selected>Medium (1200x800)</option>
                                        <option value="high">High (1920x1080)</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="colorPaletteIncludeStats">Include Statistics:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="colorPaletteStats" checked> Color distribution
                                            stats</label>
                                        <label><input type="checkbox" id="colorPaletteCharts" checked> Distribution
                                            charts</label>
                                        <label><input type="checkbox" id="colorPaletteComparison" checked> Palette
                                            comparison</label>
                                        <label><input type="checkbox" id="colorPaletteExport" checked> Export
                                            data</label>
                                    </div>
                                </div>
                            </div>

                            <div class="panel-actions">
                                <button class="action-btn primary-btn" onclick="executeColorPaletteAnalysis()">Run
                                    Analysis</button>
                                <button class="action-btn secondary-btn"
                                    onclick="resetColorPaletteForm()">Reset</button>
                                <button class="action-btn info-btn" onclick="showColorPaletteHelp()">Help</button>
                            </div>
                        </div>

                        <!-- Results Display Area -->
                        <div class="results-area" id="colorPaletteResults" style="display: none;">
                            <h6>Analysis Results</h6>
                            <div class="results-content" id="colorPaletteResultsContent">
                                <!-- Results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search Results Visualization Tool -->
                <div class="tool-card">
                    <div class="tool-header">
                        <div class="tool-icon">ğŸ“Š</div>
                        <h4 class="tool-title">Search Results Analyzer</h4>
                    </div>
                    <div class="tool-description">
                        Advanced visualization and analysis of search results, including ranking analysis, distance
                        distribution, color similarity mapping, and performance metrics.
                    </div>
                    <div class="tool-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Visualize search result rankings and distances</li>
                            <li>Analyze color similarity patterns</li>
                            <li>Generate performance reports and heatmaps</li>
                            <li>Create interactive result galleries</li>
                            <li>Export visualizations for analysis</li>
                        </ul>
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn primary-btn" onclick="runSearchResultsTool()">Run Tool</button>
                        <button class="tool-btn info-btn" onclick="showToolInfo('search-results')">Info</button>
                        <button class="tool-btn quick-test-btn" onclick="quickTestSearchResults()">Quick Test</button>
                    </div>

                    <!-- Expandable Tool Panel -->
                    <div class="tool-panel" id="searchResultsPanel" style="display: none;">
                        <div class="panel-header">
                            <h5>ğŸ“Š Search Results Analysis Configuration</h5>
                            <button class="panel-close" onclick="toggleToolPanel('searchResultsPanel')">Ã—</button>
                        </div>

                        <div class="panel-content">
                            <div class="input-section">
                                <h6>Search Query</h6>
                                <div class="input-group">
                                    <label for="searchResultsQuery">Color Query:</label>
                                    <input type="text" id="searchResultsQuery" placeholder="e.g., FF0000,00FF00"
                                        class="text-input">
                                    <small>Enter hex colors separated by commas</small>
                                </div>

                                <div class="input-group">
                                    <label for="searchResultsWeights">Color Weights:</label>
                                    <input type="text" id="searchResultsWeights" placeholder="e.g., 0.7,0.3"
                                        class="text-input">
                                    <small>Enter weights separated by commas (optional)</small>
                                </div>

                                <div class="input-group">
                                    <label for="searchResultsK">Number of Results (K):</label>
                                    <input type="number" id="searchResultsK" min="1" max="100" value="10"
                                        class="number-input">
                                    <small>Range: 1-100 results</small>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Analysis Options</h6>
                                <div class="input-group">
                                    <label for="searchResultsAnalysisType">Analysis Type:</label>
                                    <select id="searchResultsAnalysisType" class="select-input">
                                        <option value="ranking">Ranking Analysis</option>
                                        <option value="distance">Distance Distribution</option>
                                        <option value="similarity">Color Similarity Mapping</option>
                                        <option value="performance">Performance Metrics</option>
                                        <option value="comprehensive">Comprehensive Analysis</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="searchResultsVisualization">Visualization Style:</label>
                                    <select id="searchResultsVisualization" class="select-input">
                                        <option value="charts">Charts & Graphs</option>
                                        <option value="heatmaps">Heatmaps</option>
                                        <option value="gallery">Interactive Gallery</option>
                                        <option value="comparison">Comparison Views</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="searchResultsIncludeMetadata">Include Metadata:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="searchResultsMetadata" checked> Search
                                            performance metrics</label>
                                        <label><input type="checkbox" id="searchResultsTiming" checked> Timing
                                            breakdown</label>
                                        <label><input type="checkbox" id="searchResultsIndex" checked> Index
                                            information</label>
                                        <label><input type="checkbox" id="searchResultsExport" checked> Export
                                            capabilities</label>
                                    </div>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Output Configuration</h6>
                                <div class="input-group">
                                    <label for="searchResultsOutputFormat">Output Format:</label>
                                    <select id="searchResultsOutputFormat" class="select-input">
                                        <option value="png">PNG Image</option>
                                        <option value="pdf">PDF Report</option>
                                        <option value="html">Interactive HTML</option>
                                        <option value="json">JSON Data</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="searchResultsResolution">Resolution:</label>
                                    <select id="searchResultsResolution" class="select-input">
                                        <option value="low">Low (800x600)</option>
                                        <option value="medium" selected>Medium (1200x800)</option>
                                        <option value="high">High (1920x1080)</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>
                            </div>

                            <div class="panel-actions">
                                <button class="action-btn primary-btn" onclick="executeSearchResultsAnalysis()">Run
                                    Analysis</button>
                                <button class="action-btn secondary-btn"
                                    onclick="resetSearchResultsForm()">Reset</button>
                                <button class="action-btn info-btn" onclick="showSearchResultsHelp()">Help</button>
                            </div>
                        </div>

                        <!-- Results Display Area -->
                        <div class="results-area" id="searchResultsResults" style="display: none;">
                            <h6>Analysis Results</h6>
                            <div class="results-content" id="searchResultsResultsContent">
                                <!-- Results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Color Explorer Tool -->
                <div class="tool-card">
                    <div class="tool-header">
                        <div class="tool-icon">ğŸ”</div>
                        <h4 class="tool-title">Interactive Color Explorer</h4>
                    </div>
                    <div class="tool-description">
                        Interactive interface for exploring color combinations, analyzing color relationships, and
                        experimenting with different color schemes and harmonies.
                    </div>
                    <div class="tool-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Interactive color picker and palette builder</li>
                            <li>Color harmony analysis (complementary, analogous, triadic)</li>
                            <li>Real-time color preview and scheme generation</li>
                            <li>Integration with Chromatica API for live search</li>
                            <li>Export color palettes and schemes</li>
                        </ul>
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn primary-btn" onclick="runColorExplorer()">Run Tool</button>
                        <button class="tool-btn info-btn" onclick="showToolInfo('color-explorer')">Info</button>
                        <button class="tool-btn quick-test-btn" onclick="quickTestColorExplorer()">Quick Test</button>
                    </div>

                    <!-- Expandable Tool Panel -->
                    <div class="tool-panel" id="colorExplorerPanel" style="display: none;">
                        <div class="panel-header">
                            <h5>ğŸ” Interactive Color Explorer Configuration</h5>
                            <button class="panel-close" onclick="toggleToolPanel('colorExplorerPanel')">Ã—</button>
                        </div>

                        <div class="panel-content">
                            <div class="input-section">
                                <h6>Color Input</h6>
                                <div class="input-group">
                                    <label for="colorExplorerBaseColor">Base Color:</label>
                                    <input type="color" id="colorExplorerBaseColor" value="#FF0000" class="file-input">
                                    <small>Select a base color to explore harmonies</small>
                                </div>

                                <div class="input-group">
                                    <label for="colorExplorerColorCount">Number of Colors:</label>
                                    <input type="number" id="colorExplorerColorCount" min="2" max="12" value="5"
                                        class="number-input">
                                    <small>Range: 2-12 colors in palette</small>
                                </div>

                                <div class="input-group">
                                    <label for="colorExplorerColorSpace">Color Space:</label>
                                    <select id="colorExplorerColorSpace" class="select-input">
                                        <option value="hsv">HSV (Recommended)</option>
                                        <option value="lab">L*a*b*</option>
                                        <option value="rgb">RGB</option>
                                        <option value="hsl">HSL</option>
                                    </select>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Harmony Analysis</h6>
                                <div class="input-group">
                                    <label for="colorExplorerHarmonyType">Harmony Type:</label>
                                    <select id="colorExplorerHarmonyType" class="select-input">
                                        <option value="complementary">Complementary</option>
                                        <option value="analogous">Analogous</option>
                                        <option value="triadic">Triadic</option>
                                        <option value="split_complementary">Split Complementary</option>
                                        <option value="tetradic">Tetradic</option>
                                        <option value="monochromatic">Monochromatic</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="colorExplorerSaturation">Saturation Range:</label>
                                    <select id="colorExplorerSaturation" class="select-input">
                                        <option value="low">Low (Pastel)</option>
                                        <option value="medium" selected>Medium (Balanced)</option>
                                        <option value="high">High (Vibrant)</option>
                                        <option value="full">Full Spectrum</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="colorExplorerBrightness">Brightness Range:</label>
                                    <select id="colorExplorerBrightness" class="select-input">
                                        <option value="dark">Dark</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="light">Light</option>
                                        <option value="full">Full Range</option>
                                    </select>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Integration Options</h6>
                                <div class="input-group">
                                    <label for="colorExplorerAPIIntegration">API Integration:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="colorExplorerLiveSearch" checked> Live search
                                            integration</label>
                                        <label><input type="checkbox" id="colorExplorerPaletteSearch" checked>
                                            Palette-based search</label>
                                        <label><input type="checkbox" id="colorExplorerExportPalette" checked> Export
                                            generated palettes</label>
                                        <label><input type="checkbox" id="colorExplorerSaveSchemes" checked> Save color
                                            schemes</label>
                                    </div>
                                </div>

                                <div class="input-group">
                                    <label for="colorExplorerOutputFormat">Output Format:</label>
                                    <select id="colorExplorerOutputFormat" class="select-input">
                                        <option value="png">PNG Image</option>
                                        <option value="svg">SVG Vector</option>
                                        <option value="html">Interactive HTML</option>
                                        <option value="json">JSON Data</option>
                                        <option value="css">CSS Variables</option>
                                    </select>
                                </div>
                            </div>

                            <div class="panel-actions">
                                <button class="action-btn primary-btn" onclick="executeColorExplorer()">Run
                                    Explorer</button>
                                <button class="action-btn secondary-btn"
                                    onclick="resetColorExplorerForm()">Reset</button>
                                <button class="action-btn info-btn" onclick="showColorExplorerHelp()">Help</button>
                            </div>
                        </div>

                        <!-- Results Display Area -->
                        <div class="results-area" id="colorExplorerResults" style="display: none;">
                            <h6>Exploration Results</h6>
                            <div class="results-content" id="colorExplorerResultsContent">
                                <!-- Results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Histogram Analysis Tool -->
                <div class="tool-card">
                    <div class="tool-header">
                        <div class="tool-icon">ğŸ“ˆ</div>
                        <h4 class="tool-title">Histogram Analysis</h4>
                    </div>
                    <div class="tool-description">
                        Comprehensive testing and visualization of histogram generation, including validation,
                        performance benchmarking, and distribution analysis.
                    </div>
                    <div class="tool-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Single image and batch directory processing</li>
                            <li>Histogram validation and quality checks</li>
                            <li>Performance benchmarking and timing</li>
                            <li>Visualization of histogram distributions</li>
                            <li>Multiple output formats (JSON, CSV, visualizations)</li>
                        </ul>
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn primary-btn" onclick="runHistogramAnalysis()">Run Tool</button>
                        <button class="tool-btn info-btn" onclick="showToolInfo('histogram-analysis')">Info</button>
                        <button class="tool-btn quick-test-btn" onclick="quickTestHistogramAnalysis()">Quick
                            Test</button>
                    </div>

                    <!-- Expandable Tool Panel -->
                    <div class="tool-panel" id="histogramAnalysisPanel" style="display: none;">
                        <div class="panel-header">
                            <h5>ğŸ“ˆ Histogram Analysis Configuration</h5>
                            <button class="panel-close" onclick="toggleToolPanel('histogramAnalysisPanel')">Ã—</button>
                        </div>

                        <div class="panel-content">
                            <div class="input-section">
                                <h6>Input Configuration</h6>
                                <div class="input-group">
                                    <label for="histogramAnalysisInput">Input Source:</label>
                                    <select id="histogramAnalysisInput" class="select-input">
                                        <option value="single">Single Image</option>
                                        <option value="directory" selected>Directory (Batch)</option>
                                        <option value="histogram">Pre-computed Histogram</option>
                                        <option value="api">API Query Results</option>
                                    </select>
                                    <small>Choose input type for histogram analysis</small>
                                </div>

                                <div class="input-group">
                                    <label for="histogramAnalysisPath">Path/File:</label>
                                    <input type="text" id="histogramAnalysisPath" class="text-input"
                                        placeholder="datasets/test-dataset-20">
                                    <button class="browse-btn"
                                        onclick="browseDirectory('histogramAnalysisPath')">Browse</button>
                                    <small>Directory path or file path for analysis</small>
                                </div>

                                <div class="input-group">
                                    <label for="histogramAnalysisMaxFiles">Max Files:</label>
                                    <input type="number" id="histogramAnalysisMaxFiles" min="1" max="1000" value="50"
                                        class="number-input">
                                    <small>Maximum number of files to process (1-1000)</small>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Analysis Parameters</h6>
                                <div class="input-group">
                                    <label for="histogramAnalysisValidation">Validation Level:</label>
                                    <select id="histogramAnalysisValidation" class="select-input">
                                        <option value="basic">Basic (Fast)</option>
                                        <option value="standard" selected>Standard (Balanced)</option>
                                        <option value="comprehensive">Comprehensive (Thorough)</option>
                                        <option value="expert">Expert (All Checks)</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="histogramAnalysisPerformance">Performance Testing:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="histogramAnalysisTiming" checked> Timing
                                            measurements</label>
                                        <label><input type="checkbox" id="histogramAnalysisMemory" checked> Memory usage
                                            tracking</label>
                                        <label><input type="checkbox" id="histogramAnalysisThroughput" checked>
                                            Throughput analysis</label>
                                        <label><input type="checkbox" id="histogramAnalysisBenchmarks" checked>
                                            Benchmark comparisons</label>
                                    </div>
                                </div>

                                <div class="input-group">
                                    <label for="histogramAnalysisVisualization">Visualization Options:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="histogramAnalysisCharts" checked> Distribution
                                            charts</label>
                                        <label><input type="checkbox" id="histogramAnalysisHeatmaps" checked> Color
                                            heatmaps</label>
                                        <label><input type="checkbox" id="histogramAnalysis3D" checked> 3D
                                            projections</label>
                                        <label><input type="checkbox" id="histogramAnalysisComparison" checked>
                                            Comparison plots</label>
                                    </div>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Output Configuration</h6>
                                <div class="input-group">
                                    <label for="histogramAnalysisOutputFormat">Output Format:</label>
                                    <select id="histogramAnalysisOutputFormat" class="select-input">
                                        <option value="png">PNG Images</option>
                                        <option value="pdf">PDF Report</option>
                                        <option value="html">Interactive HTML</option>
                                        <option value="json">JSON Data</option>
                                        <option value="csv">CSV Export</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="histogramAnalysisResolution">Resolution:</label>
                                    <select id="histogramAnalysisResolution" class="select-input">
                                        <option value="low">Low (800x600)</option>
                                        <option value="medium" selected>Medium (1200x800)</option>
                                        <option value="high">High (1920x1080)</option>
                                        <option value="ultra">Ultra HD (4K)</option>
                                    </select>
                                    <small>Resolution for generated visualizations</small>
                                </div>

                                <div class="input-group">
                                    <label for="histogramAnalysisIncludeData">Include Data:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="histogramAnalysisRawData" checked> Raw
                                            histogram data</label>
                                        <label><input type="checkbox" id="histogramAnalysisMetadata" checked> Image
                                            metadata</label>
                                        <label><input type="checkbox" id="histogramAnalysisStatistics" checked>
                                            Statistical summaries</label>
                                        <label><input type="checkbox" id="histogramAnalysisQuality" checked> Quality
                                            metrics</label>
                                    </div>
                                </div>
                            </div>

                            <div class="panel-actions">
                                <button class="action-btn primary-btn" onclick="executeHistogramAnalysis()">Run
                                    Analysis</button>
                                <button class="action-btn secondary-btn"
                                    onclick="resetHistogramAnalysisForm()">Reset</button>
                                <button class="action-btn info-btn" onclick="showHistogramAnalysisHelp()">Help</button>
                            </div>
                        </div>

                        <!-- Results Display Area -->
                        <div class="results-area" id="histogramAnalysisResults" style="display: none;">
                            <h6>Analysis Results</h6>
                            <div class="results-content" id="histogramAnalysisResultsContent">
                                <!-- Results will be populated here -->
                            </div </div>
                        </div>
                    </div>

                    <!-- Distance Debugging Tool -->
                    <div class="tool-card">
                        <div class="tool-header">
                            <div class="tool-icon">ğŸ›</div>
                            <h4 class="tool-title">Distance Debugger</h4>
                        </div>
                        <div class="tool-description">
                            Debug and analyze Sinkhorn-EMD distance calculations, identify numerical stability issues,
                            and
                            validate distance metrics.
                        </div>
                        <div class="tool-features">
                            <h4>Key Features:</h4>
                            <ul class="feature-list">
                                <li>Debug Sinkhorn-EMD distance calculations</li>
                                <li>Identify numerical stability issues</li>
                                <li>Validate distance metrics and fallbacks</li>
                                <li>Compare different distance calculation methods</li>
                                <li>Generate debugging reports</li>
                            </ul>
                        </div>
                        <div class="tool-actions">
                            <button class="tool-btn primary-btn" onclick="runDistanceDebugger()">Run Tool</button>
                            <button class="tool-btn info-btn" onclick="showToolInfo('distance-debugger')">Info</button>
                            <button class="tool-btn quick-test-btn" onclick="quickTestDistanceDebugger()">Quick
                                Test</button>
                        </div>

                        <!-- Expandable Tool Panel -->
                        <div class="tool-panel" id="distanceDebuggerPanel" style="display: none;">
                            <div class="panel-header">
                                <h5>ğŸ› Distance Debugger Configuration</h5>
                                <button class="panel-close"
                                    onclick="toggleToolPanel('distanceDebuggerPanel')">Ã—</button>
                            </div>

                            <div class="panel-content">
                                <div class="input-section">
                                    <h6>Test Configuration</h6>
                                    <div class="input-group">
                                        <label for="distanceDebuggerTestType">Test Type:</label>
                                        <select id="distanceDebuggerTestType" class="select-input">
                                            <option value="pairwise">Pairwise Comparison</option>
                                            <option value="batch" selected>Batch Analysis</option>
                                            <option value="stability">Numerical Stability</option>
                                            <option value="performance">Performance Benchmarking</option>
                                            <option value="fallback">Fallback Analysis</option>
                                        </select>
                                        <small>Choose the type of distance debugging to perform</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="distanceDebuggerDataset">Test Dataset:</label>
                                        <select id="distanceDebuggerDataset" class="select-input">
                                            <option value="test-dataset-20">Test Dataset 20 (20 images)</option>
                                            <option value="test-dataset-50" selected>Test Dataset 50 (50 images)
                                            </option>
                                            <option value="test-dataset-200">Test Dataset 200 (200 images)</option>
                                            <option value="custom">Custom Path</option>
                                        </select>
                                        <small>Select dataset for distance debugging</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="distanceDebuggerCustomPath">Custom Path:</label>
                                        <input type="text" id="distanceDebuggerCustomPath" class="text-input"
                                            placeholder="datasets/custom-path" disabled>
                                        <small>Enter custom dataset path (enabled when Custom Path is selected)</small>
                                    </div>
                                </div>

                                <div class="input-section">
                                    <h6>Distance Calculation Settings</h6>
                                    <div class="input-group">
                                        <label for="distanceDebuggerEpsilon">Sinkhorn Epsilon:</label>
                                        <select id="distanceDebuggerEpsilon" class="select-input">
                                            <option value="0.1">0.1 (Aggressive)</option>
                                            <option value="0.5">0.5 (Balanced)</option>
                                            <option value="1.0" selected>1.0 (Stable - Current)</option>
                                            <option value="2.0">2.0 (Conservative)</option>
                                            <option value="5.0">5.0 (Very Conservative)</option>
                                        </select>
                                        <small>Epsilon value for Sinkhorn-EMD calculation (lower = more precise, higher
                                            =
                                            more stable)</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="distanceDebuggerMaxIterations">Max Iterations:</label>
                                        <input type="number" id="distanceDebuggerMaxIterations" min="100" max="10000"
                                            value="1000" class="number-input">
                                        <small>Maximum iterations for Sinkhorn algorithm (100-10000)</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="distanceDebuggerFallback">Fallback Strategy:</label>
                                        <select id="distanceDebuggerFallback" class="select-input">
                                            <option value="l2">L2 Distance (Fast)</option>
                                            <option value="cosine">Cosine Similarity (Balanced)</option>
                                            <option value="manhattan" selected>Manhattan Distance (Robust)</option>
                                            <option value="chebyshev">Chebyshev Distance (Conservative)</option>
                                        </select>
                                        <small>Distance metric to use when Sinkhorn-EMD fails</small>
                                    </div>
                                </div>

                                <div class="input-section">
                                    <h6>Debugging Options</h6>
                                    <div class="input-group">
                                        <label for="distanceDebuggerAnalysis">Analysis Depth:</label>
                                        <div class="checkbox-group">
                                            <label><input type="checkbox" id="distanceDebuggerNumerical" checked>
                                                Numerical
                                                stability analysis</label>
                                            <label><input type="checkbox" id="distanceDebuggerConvergence" checked>
                                                Convergence tracking</label>
                                            <label><input type="checkbox" id="distanceDebuggerError" checked> Error
                                                pattern
                                                analysis</label>
                                            <label><input type="checkbox" id="distanceDebuggerComparison" checked>
                                                Metric
                                                comparison</label>
                                        </div>
                                    </div>

                                    <div class="input-group">
                                        <label for="distanceDebuggerOutput">Output Options:</label>
                                        <div class="checkbox-group">
                                            <label><input type="checkbox" id="distanceDebuggerDetailed" checked>
                                                Detailed
                                                debug logs</label>
                                            <label><input type="checkbox" id="distanceDebuggerSummary" checked> Summary
                                                report</label>
                                            <label><input type="checkbox" id="distanceDebuggerVisualization" checked>
                                                Debug
                                                visualizations</label>
                                            <label><input type="checkbox" id="distanceDebuggerExport" checked> Export
                                                debug
                                                data</label>
                                        </div>
                                    </div>

                                    <div class="input-group">
                                        <label for="distanceDebuggerOutputFormat">Output Format:</label>
                                        <select id="distanceDebuggerOutputFormat" class="select-input">
                                            <option value="json">JSON Report</option>
                                            <option value="html" selected>HTML Report</option>
                                            <option value="pdf">PDF Report</option>
                                            <option value="csv">CSV Data</option>
                                            <option value="text">Plain Text</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="panel-actions">
                                    <button class="action-btn primary-btn" onclick="executeDistanceDebugger()">Run
                                        Debugger</button>
                                    <button class="action-btn secondary-btn"
                                        onclick="resetDistanceDebuggerForm()">Reset</button>
                                    <button class="action-btn info-btn"
                                        onclick="showDistanceDebuggerHelp()">Help</button>
                                </div>
                            </div>

                            <!-- Results Display Area -->
                            <div class="results-area" id="distanceDebuggerResults" style="display: none;">
                                <h6>Debug Results</h6>
                                <div class="results-content" id="distanceDebuggerResultsContent">
                                    <!-- Results will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Query Visualization Tool -->
                    <div class="tool-card">
                        <div class="tool-header">
                            <div class="tool-icon">ğŸ­</div>
                            <h4 class="tool-title">Query Visualizer</h4>
                        </div>
                        <div class="tool-description">
                            Create visual representations of color queries with weighted color bars, color palettes, and
                            comprehensive query summaries.
                        </div>
                        <div class="tool-features">
                            <h4>Key Features:</h4>
                            <ul class="feature-list">
                                <li>Generate weighted color bars representing query colors</li>
                                <li>Create color palette visualizations with weights</li>
                                <li>Build comprehensive query summary images</li>
                                <li>Export query visualizations</li>
                                <li>Customizable color representations</li>
                            </ul>
                        </div>
                        <div class="tool-actions">
                            <button class="tool-btn primary-btn" onclick="runQueryVisualizer()">Run Tool</button>
                            <button class="tool-btn info-btn" onclick="showToolInfo('query-visualizer')">Info</button>
                            <button class="tool-btn quick-test-btn" onclick="quickTestQueryVisualizer()">Quick
                                Test</button>
                        </div>

                        <!-- Expandable Tool Panel -->
                        <div class="tool-panel" id="queryVisualizerPanel" style="display: none;">
                            <div class="panel-header">
                                <h5>ğŸ­ Query Visualizer Configuration</h5>
                                <button class="panel-close" onclick="toggleToolPanel('queryVisualizerPanel')">Ã—</button>
                            </div>

                            <div class="panel-content">
                                <div class="input-section">
                                    <h6>Query Configuration</h6>
                                    <div class="input-group">
                                        <label for="queryVisualizerColors">Color Query:</label>
                                        <input type="text" id="queryVisualizerColors" class="text-input"
                                            placeholder="FF0000,00FF00,0000FF" value="FF0000,00FF00">
                                        <small>Enter hex colors separated by commas (without #)</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="queryVisualizerWeights">Color Weights:</label>
                                        <input type="text" id="queryVisualizerWeights" class="text-input"
                                            placeholder="0.6,0.4" value="0.6,0.4">
                                        <small>Enter weights separated by commas (will be normalized to sum to
                                            1.0)</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="queryVisualizerQueryType">Query Type:</label>
                                        <select id="queryVisualizerQueryType" class="select-input">
                                            <option value="single">Single Color</option>
                                            <option value="dual" selected>Dual Color</option>
                                            <option value="multi">Multi-Color</option>
                                            <option value="gradient">Color Gradient</option>
                                            <option value="palette">Color Palette</option>
                                        </select>
                                        <small>Choose the type of color query to visualize</small>
                                    </div>
                                </div>

                                <div class="input-section">
                                    <h6>Visualization Settings</h6>
                                    <div class="input-group">
                                        <label for="queryVisualizerStyle">Visualization Style:</label>
                                        <select id="queryVisualizerStyle" class="select-input">
                                            <option value="bars">Weighted Color Bars</option>
                                            <option value="circles" selected>Color Circles</option>
                                            <option value="squares">Color Squares</option>
                                            <option value="hexagons">Color Hexagons</option>
                                            <option value="gradient">Gradient Bar</option>
                                        </select>
                                        <small>Choose the visual representation style</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="queryVisualizerLayout">Layout:</label>
                                        <select id="queryVisualizerLayout" class="select-input">
                                            <option value="horizontal">Horizontal</option>
                                            <option value="vertical" selected>Vertical</option>
                                            <option value="radial">Radial</option>
                                            <option value="grid">Grid</option>
                                            <option value="flow">Flow</option>
                                        </select>
                                        <small>Choose the layout arrangement</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="queryVisualizerSize">Visualization Size:</label>
                                        <select id="queryVisualizerSize" class="select-input">
                                            <option value="small">Small (400x300)</option>
                                            <option value="medium" selected>Medium (600x450)</option>
                                            <option value="large">Large (800x600)</option>
                                            <option value="custom">Custom Dimensions</option>
                                        </select>
                                        <small>Choose the output size</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="queryVisualizerCustomWidth">Custom Width:</label>
                                        <input type="number" id="queryVisualizerCustomWidth" class="number-input"
                                            placeholder="800" min="200" max="2000" disabled>
                                        <small>Custom width in pixels (enabled when Custom Dimensions selected)</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="queryVisualizerCustomHeight">Custom Height:</label>
                                        <input type="number" id="queryVisualizerCustomHeight" class="number-input"
                                            placeholder="600" min="150" max="1500" disabled>
                                        <small>Custom height in pixels (enabled when Custom Dimensions selected)</small>
                                    </div>
                                </div>

                                <div class="input-section">
                                    <h6>Advanced Options</h6>
                                    <div class="input-group">
                                        <label for="queryVisualizerFeatures">Additional Features:</label>
                                        <div class="checkbox-group">
                                            <label><input type="checkbox" id="queryVisualizerLabels" checked> Color
                                                labels
                                                and hex codes</label>
                                            <label><input type="checkbox" id="queryVisualizerWeights" checked> Weight
                                                percentages</label>
                                            <label><input type="checkbox" id="queryVisualizerColorNames" checked> Color
                                                names (if available)</label>
                                            <label><input type="checkbox" id="queryVisualizerHarmony" checked> Color
                                                harmony
                                                indicators</label>
                                            <label><input type="checkbox" id="queryVisualizerAccessibility" checked>
                                                Accessibility information</label>
                                        </div>
                                    </div>

                                    <div class="input-group">
                                        <label for="queryVisualizerBackground">Background Style:</label>
                                        <select id="queryVisualizerBackground" class="select-input">
                                            <option value="transparent">Transparent</option>
                                            <option value="white" selected>White</option>
                                            <option value="black">Black</option>
                                            <option value="gradient">Gradient</option>
                                            <option value="custom">Custom Color</option>
                                        </select>
                                        <small>Choose background style for the visualization</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="queryVisualizerCustomBackground">Custom Background Color:</label>
                                        <input type="color" id="queryVisualizerCustomBackground" class="file-input"
                                            value="#F5F5F5" disabled>
                                        <small>Custom background color (enabled when Custom Color selected)</small>
                                    </div>
                                </div>

                                <div class="input-section">
                                    <h6>Output Configuration</h6>
                                    <div class="input-group">
                                        <label for="queryVisualizerOutputFormat">Output Format:</label>
                                        <select id="queryVisualizerOutputFormat" class="select-input">
                                            <option value="png">PNG Image</option>
                                            <option value="svg" selected>SVG Vector</option>
                                            <option value="pdf">PDF Document</option>
                                            <option value="html">Interactive HTML</option>
                                            <option value="json">JSON Data</option>
                                        </select>
                                        <small>Choose the output format for the visualization</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="queryVisualizerQuality">Image Quality:</label>
                                        <select id="queryVisualizerQuality" class="select-input">
                                            <option value="low">Low (Fast)</option>
                                            <option value="medium" selected>Medium (Balanced)</option>
                                            <option value="high">High (Quality)</option>
                                            <option value="ultra">Ultra (Best)</option>
                                        </select>
                                        <small>Choose image quality (affects file size and generation time)</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="queryVisualizerIncludeMetadata">Include Metadata:</label>
                                        <div class="checkbox-group">
                                            <label><input type="checkbox" id="queryVisualizerQueryInfo" checked> Query
                                                information</label>
                                            <label><input type="checkbox" id="queryVisualizerGenerationInfo" checked>
                                                Generation details</label>
                                            <label><input type="checkbox" id="queryVisualizerColorInfo" checked> Color
                                                analysis</label>
                                            <label><input type="checkbox" id="queryVisualizerExportInfo" checked> Export
                                                options</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="panel-actions">
                                    <button class="action-btn primary-btn" onclick="executeQueryVisualizer()">Generate
                                        Visualization</button>
                                    <button class="action-btn secondary-btn"
                                        onclick="resetQueryVisualizerForm()">Reset</button>
                                    <button class="action-btn info-btn"
                                        onclick="showQueryVisualizerHelp()">Help</button>
                                </div>
                            </div>

                            <!-- Results Display Area -->
                            <div class="results-area" id="queryVisualizerResults" style="display: none;">
                                <h6>Visualization Results</h6>
                                <div class="results-content" id="queryVisualizerResultsContent">
                                    <!-- Results will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Color Analysis Tool -->
                    <div class="tool-card">
                        <div class="tool-header">
                            <div class="tool-icon">ğŸ¨</div>
                            <h4 class="tool-title">Color Analysis</h4>
                        </div>
                        <div class="tool-description">
                            Analyze color relationships, harmony scores, and palette characteristics with comprehensive
                            metrics and visual feedback.
                        </div>
                        <div class="tool-features">
                            <h4>Key Features:</h4>
                            <ul class="feature-list">
                                <li>Color harmony score calculation</li>
                                <li>Color relationship analysis</li>
                                <li>Complementary color detection</li>
                                <li>Contrast ratio evaluation</li>
                                <li>Accessibility compliance checks</li>
                                <li>Color scheme suggestions</li>
                            </ul>
                        </div>
                        <div class="tool-actions">
                            <button class="tool-btn primary-btn" onclick="runColorAnalysis()">Run Tool</button>
                            <button class="tool-btn info-btn" onclick="showToolInfo('color-analysis')">Info</button>
                            <button class="tool-btn quick-test-btn" onclick="quickTestColorAnalysis()">Quick
                                Test</button>
                        </div>

                        <!-- Expandable Tool Panel -->
                        <div class="tool-panel" id="colorAnalysisPanel" style="display: none;">
                            <div class="panel-header">
                                <h5>ğŸ¨ Color Analysis Configuration</h5>
                                <button class="panel-close" onclick="toggleToolPanel('colorAnalysisPanel')">Ã—</button>
                            </div>

                            <div class="panel-content">
                                <div class="input-section">
                                    <h6>Color Input</h6>
                                    <div class="input-group">
                                        <label for="colorAnalysisInput">Colors to Analyze:</label>
                                        <input type="text" id="colorAnalysisInput" class="text-input"
                                            placeholder="Enter hex colors (e.g., #FF0000, #00FF00)" value="">
                                        <small>Enter hex colors separated by commas or spaces</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="colorAnalysisMode">Analysis Mode:</label>
                                        <select id="colorAnalysisMode" class="select-input">
                                            <option value="basic">Basic Analysis</option>
                                            <option value="advanced" selected>Advanced Analysis</option>
                                            <option value="comprehensive">Comprehensive Analysis</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="input-section">
                                    <h6>Analysis Options</h6>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="analyzeHarmony" checked> Color Harmony</label>
                                        <label><input type="checkbox" id="analyzeRelationships" checked> Color
                                            Relationships</label>
                                        <label><input type="checkbox" id="analyzeContrast" checked> Contrast
                                            Ratios</label>
                                        <label><input type="checkbox" id="analyzeAccessibility" checked>
                                            Accessibility</label>
                                        <label><input type="checkbox" id="analyzePsychology" checked> Color
                                            Psychology</label>
                                        <label><input type="checkbox" id="generateSuggestions" checked> Generate
                                            Suggestions</label>
                                    </div>
                                </div>

                                <div class="input-section">
                                    <h6>Harmony Metrics</h6>
                                    <div class="input-group">
                                        <label for="harmonyThreshold">Harmony Threshold:</label>
                                        <input type="range" id="harmonyThreshold" min="0" max="100" value="75"
                                            class="range-input">
                                        <span id="harmonyThresholdValue">75%</span>
                                    </div>

                                    <div class="input-group">
                                        <label for="harmonyRules">Harmony Rules:</label>
                                        <select id="harmonyRules" class="select-input" multiple>
                                            <option value="complementary" selected>Complementary</option>
                                            <option value="analogous" selected>Analogous</option>
                                            <option value="triadic" selected>Triadic</option>
                                            <option value="split-complementary" selected>Split Complementary</option>
                                            <option value="tetradic" selected>Tetradic</option>
                                            <option value="monochromatic" selected>Monochromatic</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="input-section">
                                    <h6>Output Options</h6>
                                    <div class="input-group">
                                        <label for="outputFormat">Output Format:</label>
                                        <select id="outputFormat" class="select-input">
                                            <option value="visual">Visual Report</option>
                                            <option value="detailed">Detailed Text Report</option>
                                            <option value="json">JSON Data</option>
                                            <option value="all" selected>All Formats</option>
                                        </select>
                                    </div>

                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="includeVisualizations" checked> Include
                                            Visualizations</label>
                                        <label><input type="checkbox" id="includeMetrics" checked> Include
                                            Metrics</label>
                                        <label><input type="checkbox" id="includeSuggestions" checked> Include
                                            Suggestions</label>
                                        <label><input type="checkbox" id="includeExplanations" checked> Include
                                            Explanations</label>
                                    </div>
                                </div>

                                <div class="panel-actions">
                                    <button class="action-btn primary-btn" onclick="executeColorAnalysis()">Run
                                        Analysis</button>
                                    <button class="action-btn secondary-btn"
                                        onclick="resetColorAnalysisForm()">Reset</button>
                                    <button class="action-btn info-btn" onclick="showColorAnalysisHelp()">Help</button>
                                </div>
                            </div>

                            <!-- Results Display Area -->
                            <div class="results-area" id="colorAnalysisResults" style="display: none;">
                                <h6>Analysis Results</h6>
                                <div class="results-content" id="colorAnalysisResultsContent">
                                    <!-- Results will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Color Analysis Tool -->
                    <div class="tool-card">
                        <div class="tool-header">
                            <div class="tool-icon">ğŸ¨</div>
                            <h4 class="tool-title">Color Analysis</h4>
                        </div>
                        <div class="tool-description">
                            Analyze color relationships, harmony scores, and palette characteristics with comprehensive
                            metrics and visual feedback.
                        </div>
                        <div class="tool-features">
                            <h4>Key Features:</h4>
                            <ul class="feature-list">
                                <li>Color harmony score calculation</li>
                                <li>Color relationship analysis</li>
                                <li>Complementary color detection</li>
                                <li>Contrast ratio evaluation</li>
                                <li>Accessibility compliance checks</li>
                                <li>Color scheme suggestions</li>
                            </ul>
                        </div>
                        <div class="tool-actions">
                            <button class="tool-btn primary-btn" onclick="runColorAnalysis()">Run Tool</button>
                            <button class="tool-btn info-btn" onclick="showToolInfo('color-analysis')">Info</button>
                            <button class="tool-btn quick-test-btn" onclick="quickTestColorAnalysis()">Quick
                                Test</button>
                        </div>

                        <!-- Expandable Tool Panel -->
                        <div class="tool-panel" id="colorAnalysisPanel" style="display: none;">
                            <div class="panel-header">
                                <h5>ğŸ¨ Color Analysis Configuration</h5>
                                <button class="panel-close" onclick="toggleToolPanel('colorAnalysisPanel')">Ã—</button>
                            </div>

                            <div class="panel-content">
                                <div class="input-section">
                                    <h6>Color Input</h6>
                                    <div class="input-group">
                                        <label for="colorAnalysisInput">Colors to Analyze:</label>
                                        <input type="text" id="colorAnalysisInput" class="text-input"
                                            placeholder="Enter hex colors (e.g., #FF0000, #00FF00)" value="">
                                        <small>Enter hex colors separated by commas or spaces</small>
                                    </div>

                                    <div class="input-group">
                                        <label for="colorAnalysisMode">Analysis Mode:</label>
                                        <select id="colorAnalysisMode" class="select-input">
                                            <option value="basic">Basic Analysis</option>
                                            <option value="advanced" selected>Advanced Analysis</option>
                                            <option value="comprehensive">Comprehensive Analysis</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="input-section">
                                    <h6>Analysis Options</h6>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="analyzeHarmony" checked> Color Harmony</label>
                                        <label><input type="checkbox" id="analyzeRelationships" checked> Color
                                            Relationships</label>
                                        <label><input type="checkbox" id="analyzeContrast" checked> Contrast
                                            Ratios</label>
                                        <label><input type="checkbox" id="analyzeAccessibility" checked>
                                            Accessibility</label>
                                        <label><input type="checkbox" id="analyzePsychology" checked> Color
                                            Psychology</label>
                                        <label><input type="checkbox" id="generateSuggestions" checked> Generate
                                            Suggestions</label>
                                    </div>
                                </div>

                                <div class="input-section">
                                    <h6>Harmony Metrics</h6>
                                    <div class="input-group">
                                        <label for="harmonyThreshold">Harmony Threshold:</label>
                                        <input type="range" id="harmonyThreshold" min="0" max="100" value="75"
                                            class="range-input">
                                        <span id="harmonyThresholdValue">75%</span>
                                    </div>

                                    <div class="input-group">
                                        <label for="harmonyRules">Harmony Rules:</label>
                                        <select id="harmonyRules" class="select-input" multiple>
                                            <option value="complementary" selected>Complementary</option>
                                            <option value="analogous" selected>Analogous</option>
                                            <option value="triadic" selected>Triadic</option>
                                            <option value="split-complementary" selected>Split Complementary</option>
                                            <option value="tetradic" selected>Tetradic</option>
                                            <option value="monochromatic" selected>Monochromatic</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="input-section">
                                    <h6>Output Options</h6>
                                    <div class="input-group">
                                        <label for="outputFormat">Output Format:</label>
                                        <select id="outputFormat" class="select-input">
                                            <option value="visual">Visual Report</option>
                                            <option value="detailed">Detailed Text Report</option>
                                            <option value="json">JSON Data</option>
                                            <option value="all" selected>All Formats</option>
                                        </select>
                                    </div>

                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="includeVisualizations" checked> Include
                                            Visualizations</label>
                                        <label><input type="checkbox" id="includeMetrics" checked> Include
                                            Metrics</label>
                                        <label><input type="checkbox" id="includeSuggestions" checked> Include
                                            Suggestions</label>
                                        <label><input type="checkbox" id="includeExplanations" checked> Include
                                            Explanations</label>
                                    </div>
                                </div>

                                <div class="panel-actions">
                                    <button class="action-btn primary-btn" onclick="executeColorAnalysis()">Run
                                        Analysis</button>
                                    <button class="action-btn secondary-btn"
                                        onclick="resetColorAnalysisForm()">Reset</button>
                                    <button class="action-btn info-btn" onclick="showColorAnalysisHelp()">Help</button>
                                </div>
                            </div>

                            <!-- Results Display Area -->
                            <div class="results-area" id="colorAnalysisResults" style="display: none;">
                                <h6>Analysis Results</h6>
                                <div class="results-content" id="colorAnalysisResultsContent">
                                    <!-- Results will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tool Usage Instructions -->
                    <div class="tool-category">
                        <h3>ğŸ“– How to Use These Tools</h3>
                        <p>All visualization tools are available as Python scripts in the <code>tools/</code> directory.
                            You can
                            run them directly from the command line or use the web interface buttons above to execute
                            them with
                            sample data.</p>
                        <p><strong>Note:</strong> Some tools require the Chromatica API to be running and may need
                            additional
                            dependencies. Check the tool documentation for specific requirements.</p>
                    </div>
                </div>

                <!-- Error Display -->
                <div class="error" id="error" style="display: none;"></div>

                <!-- Image Popup Modal -->
                <div id="imageModal" class="image-modal" style="display: none;">
                    <div class="image-modal-content">
                        <span class="image-close">&times;</span>
                        <img id="modalImage" src="" alt="Full size image">
                    </div>
                </div>

                <!-- Enhanced Details Modal -->
                <div id="detailsModal" class="modal">
                    <div class="modal-content details-modal">
                        <span class="close">&times;</span>
                        <h2>Image Details</h2>
                        <div id="imageDetailsContent">
                            <!-- Content will be populated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Tool Information Modal -->
                <div id="toolModal" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="closeToolModal()">&times;</span>
                        <div id="toolModalContent"></div>
                    </div>
                </div>

                <!-- Suggest Palette Modal -->
                <div id="suggestPaletteModal" class="modal">
                    <div class="modal-content" style="width: 90%; max-width: 600px;">
                        <span class="close"
                            onclick="document.getElementById('suggestPaletteModal').style.display='none'">&times;</span>
                        <h2 style="color: var(--text); margin-top: 0;">ğŸ¨ Suggest Color Palette</h2>

                        <div class="scheme-modes"
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
                            <!-- Monochromatic -->
                            <div class="scheme-mode" onclick="generatePalette('monochromatic')"
                                style="cursor: pointer; padding: 15px; background: var(--surface0); border: 2px solid var(--surface2); border-radius: 8px; transition: all 0.2s;">
                                <h3 style="margin: 0 0 10px 0; color: var(--mauve);">Monochromatic</h3>
                                <p style="color: var(--subtext1); margin: 0; font-size: 14px;">Different shades and
                                    tints of a
                                    single color</p>
                            </div>

                            <!-- Complementary -->
                            <div class="scheme-mode" onclick="generatePalette('complementary')"
                                style="cursor: pointer; padding: 15px; background: var(--surface0); border: 2px solid var(--surface2); border-radius: 8px; transition: all 0.2s;">
                                <h3 style="margin: 0 0 10px 0; color: var(--blue);">Complementary</h3>
                                <p style="color: var(--subtext1); margin: 0; font-size: 14px;">Two colors opposite on
                                    the color
                                    wheel</p>
                            </div>

                            <!-- Analogous -->
                            <div class="scheme-mode" onclick="generatePalette('analogous')"
                                style="cursor: pointer; padding: 15px; background: var(--surface0); border: 2px solid var(--surface2); border-radius: 8px; transition: all 0.2s;">
                                <h3 style="margin: 0 0 10px 0; color: var(--green);">Analogous</h3>
                                <p style="color: var(--subtext1); margin: 0; font-size: 14px;">Colors adjacent on the
                                    color
                                    wheel</p>
                            </div>

                            <!-- Triadic -->
                            <div class="scheme-mode" onclick="generatePalette('triadic')"
                                style="cursor: pointer; padding: 15px; background: var(--surface0); border: 2px solid var(--surface2); border-radius: 8px; transition: all 0.2s;">
                                <h3 style="margin: 0 0 10px 0; color: var(--red);">Triadic</h3>
                                <p style="color: var(--subtext1); margin: 0; font-size: 14px;">Three colors evenly
                                    spaced on the
                                    wheel</p>
                            </div>

                            <!-- Split Complementary -->
                            <div class="scheme-mode" onclick="generatePalette('split-complementary')"
                                style="cursor: pointer; padding: 15px; background: var(--surface0); border: 2px solid var(--surface2); border-radius: 8px; transition: all 0.2s;">
                                <h3 style="margin: 0 0 10px 0; color: var(--peach);">Split Complementary</h3>
                                <p style="color: var(--subtext1); margin: 0; font-size: 14px;">One color and two
                                    adjacent to its
                                    complement</p>
                            </div>

                            <!-- Random Harmony -->
                            <div class="scheme-mode" onclick="generatePalette('random')"
                                style="cursor: pointer; padding: 15px; background: var(--surface0); border: 2px solid var(--surface2); border-radius: 8px; transition: all 0.2s;">
                                <h3 style="margin: 0 0 10px 0; color: var(--yellow);">Random Harmony</h3>
                                <p style="color: var(--subtext1); margin: 0; font-size: 14px;">Randomly selected
                                    harmonious
                                    colors</p>
                            </div>
                        </div>

                        <div id="generatedPalette" style="margin-top: 20px; display: none;">
                            <h3 style="color: var(--text);">Generated Palette</h3>
                            <div id="palettePreview" style="display: flex; gap: 10px; margin: 15px 0;"></div>
                            <button onclick="applyGeneratedPalette()"
                                style="background: var(--blue); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                                Apply Palette
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sticky Restart Button -->
            <div id="restartButton"
                style="position: fixed; top: 20px; right: 20px; z-index: 1000; background: var(--red); color: white; border: none; padding: 12px 16px; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); font-size: 14px; font-weight: bold; transition: all 0.3s ease;"
                onclick="restartServer()" title="Restart Chromatica Server">
                ğŸ”„ Restart Server
            </div>

            <script src="/static/js/main.js" type="text/javascript"></script>

            <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

            <!-- <script type="module" src="/static/js/main.js"></script> -->
</body>

</html>