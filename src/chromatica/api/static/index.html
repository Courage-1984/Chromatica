<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chromatica Color Search Engine</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23cba6f7'/><circle cx='30' cy='30' r='15' fill='%23f5c2e7'/><circle cx='70' cy='30' r='15' fill='%23f2cdcd'/><circle cx='30' cy='70' r='15' fill='%23a6e3a1'/><circle cx='70' cy='70' r='15' fill='%23f9e2af'/></svg>">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23cba6f7'/><circle cx='30' cy='30' r='15' fill='%23f5c2e7'/><circle cx='70' cy='30' r='15' fill='%23f2cdcd'/><circle cx='30' cy='70' r='15' fill='%23a6e3a1'/><circle cx='70' cy='70' r='15' fill='%23f9e2af'/></svg>">
    <link rel="shortcut icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23cba6f7'/><circle cx='30' cy='30' r='15' fill='%23f5c2e7'/><circle cx='70' cy='30' r='15' fill='%23f2cdcd'/><circle cx='30' cy='70' r='15' fill='%23a6e3a1'/><circle cx='70' cy='70' r='15' fill='%23f9e2af'/></svg>">
    <link rel="apple-touch-icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23cba6f7'/><circle cx='30' cy='30' r='15' fill='%23f5c2e7'/><circle cx='70' cy='30' r='15' fill='%23f2cdcd'/><circle cx='30' cy='70' r='15' fill='%23a6e3a1'/><circle cx='70' cy='70' r='15' fill='%23f9e2af'/></svg>">
    <style>
        /* Font Face Declarations */
        @font-face {
            font-family: 'JetBrainsMono Nerd Font Mono';
            src: url('/static/fonts/JetBrainsMonoNerdFontMono-Regular.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'JetBrainsMono Nerd Font Mono';
            src: url('/static/fonts/JetBrainsMonoNerdFontMono-Bold.ttf') format('truetype');
            font-weight: 700;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'JetBrainsMono Nerd Font Mono';
            src: url('/static/fonts/JetBrainsMonoNerdFontMono-Italic.ttf') format('truetype');
            font-weight: 400;
            font-style: italic;
            font-display: swap;
        }

        @font-face {
            font-family: 'JetBrainsMono Nerd Font Mono';
            src: url('/static/fonts/JetBrainsMonoNerdFontMono-BoldItalic.ttf') format('truetype');
            font-weight: 700;
            font-style: italic;
            font-display: swap;
        }

        @font-face {
            font-family: 'JetBrainsMono Nerd Font Mono';
            src: url('/static/fonts/JetBrainsMonoNerdFontMono-Medium.ttf') format('truetype');
            font-weight: 500;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'JetBrainsMono Nerd Font Mono';
            src: url('/static/fonts/JetBrainsMonoNerdFontMono-SemiBold.ttf') format('truetype');
            font-weight: 600;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'Segoe UI Emoji';
            src: url('/static/fonts/seguiemj.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'Segoe UI Symbol';
            src: url('/static/fonts/seguisym.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        /* Catppuccin Mocha Theme Colors */
        :root {
            /* Base colors */
            --base: #1e1e2e;
            --mantle: #181825;
            --crust: #11111b;

            /* Surface colors */
            --surface0: #313244;
            --surface1: #45475a;
            --surface2: #585b70;

            /* Overlay colors */
            --overlay0: #6c7086;
            --overlay1: #7f849c;
            --overlay2: #9399b2;

            /* Text colors */
            --text: #cdd6f4;
            --subtext0: #a6adc8;
            --subtext1: #bac2de;

            /* Accent colors */
            --rosewater: #f5e0dc;
            --flamingo: #f2cdcd;
            --pink: #f5c2e7;
            --mauve: #cba6f7;
            --red: #f38ba8;
            --maroon: #eba0ac;
            --peach: #fab387;
            --yellow: #f9e2af;
            --green: #a6e3a1;
            --teal: #94e2d5;
            --sky: #89dceb;
            --sapphire: #74c7ec;
            --blue: #89b4fa;
            --lavender: #b4befe;
        }

        /* Base Typography */
        body {
            font-family: 'JetBrainsMono Nerd Font Mono', 'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, var(--base) 0%, var(--mantle) 100%);
            min-height: 100vh;
            color: var(--text);
            font-size: 14px;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Emoji and Symbol Fonts */
        .emoji,
        .symbol,
        h1,
        h2,
        h3,
        h4,
        button,
        .tool-icon {
            font-family: 'Segoe UI Emoji', 'Segoe UI Symbol', 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', 'Android Emoji', 'EmojiSymbols', 'EmojiOne Mozilla', 'Twemoji Mozilla', 'Segoe UI Symbol', 'Arial Unicode MS', 'JetBrainsMono Nerd Font Mono', monospace;
        }

        /* Headings with mixed fonts */
        h1,
        h2,
        h3,
        h4 {
            font-family: 'JetBrainsMono Nerd Font Mono', 'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', 'Courier New', monospace;
            font-weight: 600;
        }

        h1 {
            text-align: center;
            color: var(--text);
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 700;
        }

        h2 {
            color: var(--text);
            font-weight: 600;
        }

        h3 {
            color: var(--text);
            font-weight: 600;
        }

        h4 {
            color: var(--text);
            font-weight: 600;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--crust);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--surface0);
        }

        .color-input-section {
            background: var(--surface0);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px solid var(--surface1);
        }

        .color-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }

        .color-picker {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .weight-slider {
            flex: 1;
            height: 8px;
            border-radius: 5px;
            background: var(--surface1);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .weight-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--mauve);
            cursor: pointer;
        }

        .weight-value {
            min-width: 60px;
            text-align: center;
            font-weight: 600;
            color: var(--text);
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
        }

        .add-color-btn {
            background: var(--blue);
            color: var(--crust);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            transition: background 0.3s;
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
            font-weight: 500;
        }

        .add-color-btn:hover {
            background: var(--sapphire);
        }

        .search-btn {
            background: var(--green);
            color: var(--crust);
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            margin-top: 20px;
            transition: background 0.3s;
            width: 100%;
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
        }

        .search-btn:hover {
            background: var(--teal);
        }

        .search-btn:disabled {
            background: var(--overlay0);
            cursor: not-allowed;
        }

        .results-section {
            margin-top: 30px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: var(--surface0);
            border: 2px solid var(--surface1);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
            border-color: var(--mauve);
        }

        .result-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid var(--surface1);
        }

        .result-info {
            margin-bottom: 10px;
        }

        .result-info strong {
            color: var(--text);
            font-weight: 600;
        }

        .result-info p {
            color: var(--subtext1);
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
        }

        .color-swatches {
            display: flex;
            gap: 8px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .color-swatch {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 2px solid var(--surface1);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .color-swatch:hover {
            transform: scale(1.1);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
            flex: 1;
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
            font-weight: 500;
        }

        .download-btn {
            background: var(--blue);
            color: var(--crust);
        }

        .download-btn:hover {
            background: var(--sapphire);
        }

        .copy-btn {
            background: var(--peach);
            color: var(--crust);
        }

        .copy-btn:hover {
            background: var(--yellow);
        }

        .details-btn {
            background: var(--mauve);
            color: var(--crust);
        }

        .details-btn:hover {
            background: var(--pink);
        }

        .search-stats {
            background: var(--surface0);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid var(--surface1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: var(--text);
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
        }

        .stat-label {
            color: var(--subtext0);
            font-size: 0.9em;
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
        }

        .ranking-explanation {
            background: var(--surface0);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid var(--green);
        }

        .ranking-explanation h3 {
            color: var(--green);
            margin-top: 0;
        }

        .ranking-explanation p {
            color: var(--subtext1);
            line-height: 1.6;
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
        }

        /* Visualization Section */
        .visualization-section {
            background: var(--surface0);
            padding: 25px;
            border-radius: 10px;
            margin: 30px 0;
            border: 2px solid var(--surface1);
        }

        .visualization-section h2 {
            color: var(--text);
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8em;
        }

        .viz-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .viz-card {
            background: var(--surface0);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid var(--surface1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .viz-card h3 {
            margin-top: 0;
            color: var(--text);
        }

        .viz-image {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Visualization Tools Section */
        .visualization-tools-section {
            background: var(--surface0);
            padding: 25px;
            border-radius: 10px;
            margin: 30px 0;
            border: 2px solid var(--surface1);
        }

        .visualization-tools-section h2 {
            color: var(--text);
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8em;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .tool-card {
            background: var(--surface0);
            border: 2px solid var(--surface1);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .tool-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
            border-color: var(--mauve);
        }

        .tool-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .tool-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--mauve) 0%, var(--pink) 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--crust);
            font-size: 18px;
            margin-right: 15px;
        }

        .tool-title {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--text);
            margin: 0;
        }

        .tool-description {
            color: var(--subtext1);
            line-height: 1.5;
            margin-bottom: 15px;
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
        }

        .tool-features {
            margin-bottom: 15px;
        }

        .tool-features h4 {
            color: var(--text);
            margin-bottom: 8px;
            font-size: 1em;
        }

        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .feature-list li {
            color: var(--subtext1);
            margin-bottom: 4px;
            padding-left: 20px;
            position: relative;
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
        }

        .feature-list li:before {
            content: "✓";
            color: var(--green);
            font-weight: 700;
            position: absolute;
            left: 0;
        }

        .tool-actions {
            display: flex;
            gap: 10px;
        }

        .tool-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
            flex: 1;
            text-decoration: none;
            text-align: center;
            display: inline-block;
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
            font-weight: 500;
        }

        .primary-btn {
            background: var(--blue);
            color: var(--crust);
        }

        .primary-btn:hover {
            background: var(--sapphire);
        }

        .secondary-btn {
            background: var(--peach);
            color: var(--crust);
        }

        .secondary-btn:hover {
            background: var(--yellow);
        }

        .info-btn {
            background: var(--mauve);
            color: var(--crust);
        }

        .info-btn:hover {
            background: var(--pink);
        }

        .demo-btn {
            background: var(--green);
            color: var(--crust);
        }

        .demo-btn:hover {
            background: var(--teal);
        }

        .tool-category {
            background: var(--surface1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .tool-category h3 {
            color: var(--text);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .tool-category p {
            color: var(--subtext1);
            margin: 0;
            line-height: 1.5;
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--subtext0);
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
        }

        .error {
            background: var(--surface0);
            color: var(--red);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid var(--red);
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
        }

        .success {
            background: var(--surface0);
            color: var(--green);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid var(--green);
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modal-content {
            background-color: var(--crust);
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid var(--surface0);
        }

        .close {
            color: var(--subtext0);
            float: right;
            font-size: 28px;
            font-weight: 700;
            cursor: pointer;
        }

        .close:hover {
            color: var(--text);
        }

        .code-block {
            background: var(--surface0);
            border: 1px solid var(--surface1);
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'JetBrainsMono Nerd Font Mono', 'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            color: var(--text);
        }

        .usage-example {
            background: var(--surface0);
            border: 1px solid var(--green);
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }

        .usage-example h4 {
            color: var(--green);
            margin-top: 0;
        }

        .usage-example code {
            background: var(--surface1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrainsMono Nerd Font Mono', 'JetBrains Mono', 'Fira Code', 'Consolas', 'Monaco', 'Courier New', monospace;
            color: var(--text);
        }

        /* Remove button styling */
        button[onclick*="removeColor"] {
            background: var(--red) !important;
            color: var(--crust) !important;
            border: none !important;
            padding: 8px 12px !important;
            border-radius: 6px !important;
            cursor: pointer !important;
            font-family: 'JetBrainsMono Nerd Font Mono', monospace !important;
            font-weight: 500 !important;
        }

        button[onclick*="removeColor"]:hover {
            background: var(--maroon) !important;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .tools-grid {
                grid-template-columns: 1fr;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        /* Image Popup Modal */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
        }

        .image-modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .image-close {
            position: absolute;
            top: 15px;
            right: 25px;
            color: var(--subtext0);
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }

        .image-close:hover {
            color: var(--text);
        }

        .image-modal-content img {
            display: block;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* Enhanced Details Modal */
        .details-modal {
            max-width: 800px;
            width: 90%;
            padding: 30px;
        }

        .details-modal h2 {
            color: var(--text);
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
        }

        .details-modal .modal-content {
            padding: 20px;
        }

        .details-modal .modal-content h2 {
            margin-bottom: 15px;
        }

        .details-modal .modal-content p {
            color: var(--subtext1);
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .details-modal .modal-content strong {
            color: var(--text);
        }

        .details-modal .modal-content ul {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
        }

        .details-modal .modal-content li {
            color: var(--subtext1);
            margin-bottom: 8px;
            padding-left: 25px;
            position: relative;
        }

        .details-modal .modal-content li:before {
            content: "•";
            color: var(--green);
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .details-modal .modal-content .image-preview {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid var(--surface1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .details-modal .modal-content .color-swatches {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .details-modal .modal-content .color-swatch {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid var(--surface1);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .details-modal .modal-content .color-swatch:hover {
            transform: scale(1.1);
        }

        .details-modal .modal-content .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .details-modal .modal-content .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
            flex: 1;
        }

        .details-modal .modal-content .download-btn {
            background: var(--blue);
            color: var(--crust);
        }

        .details-modal .modal-content .download-btn:hover {
            background: var(--sapphire);
        }

        .details-modal .modal-content .copy-btn {
            background: var(--peach);
            color: var(--crust);
        }

        .details-modal .modal-content .copy-btn:hover {
            background: var(--yellow);
        }

        .details-modal .modal-content .details-btn {
            background: var(--mauve);
            color: var(--crust);
        }

        .details-modal .modal-content .details-btn:hover {
            background: var(--pink);
        }

        .advanced-details {
            max-width: 100%;
        }

        .advanced-details h3 {
            color: var(--text);
            margin-bottom: 20px;
            text-align: center;
            font-size: 20px;
        }

        .analysis-section {
            background: var(--surface1);
            border: 1px solid var(--surface2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .analysis-section h4 {
            color: var(--blue);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
            border-bottom: 2px solid var(--surface2);
            padding-bottom: 5px;
        }

        .analysis-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .analysis-section li {
            color: var(--subtext1);
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
            line-height: 1.4;
        }

        .analysis-section li:before {
            content: "•";
            color: var(--green);
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .analysis-section li:last-child {
            margin-bottom: 0;
        }

        /* Tool Panel Styles */
        .tool-panel {
            margin-top: 20px;
            border: 2px solid var(--surface2);
            border-radius: 12px;
            background: var(--surface0);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .panel-header {
            background: var(--surface1);
            padding: 15px 20px;
            border-bottom: 1px solid var(--surface2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header h5 {
            margin: 0;
            color: var(--text);
            font-size: 16px;
        }

        .panel-close {
            background: none;
            border: none;
            color: var(--subtext1);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .panel-close:hover {
            background: var(--surface2);
            color: var(--text);
        }

        .panel-content {
            padding: 20px;
        }

        .input-section {
            margin-bottom: 25px;
        }

        .input-section h6 {
            color: var(--blue);
            margin: 0 0 15px 0;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text);
            font-weight: 500;
        }

        .input-group small {
            display: block;
            margin-top: 5px;
            color: var(--subtext1);
            font-size: 12px;
        }

        .file-input,
        .text-input,
        .number-input,
        .select-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--surface2);
            border-radius: 6px;
            background: var(--crust);
            color: var(--text);
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .file-input:focus,
        .text-input:focus,
        .number-input:focus,
        .select-input:focus {
            outline: none;
            border-color: var(--blue);
        }

        .browse-btn {
            background: var(--surface2);
            color: var(--text);
            border: 1px solid var(--surface3);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            transition: all 0.2s ease;
        }

        .browse-btn:hover {
            background: var(--surface3);
            border-color: var(--blue);
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: normal;
            cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .panel-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--surface2);
        }

        .results-area {
            margin-top: 20px;
            padding: 20px;
            background: var(--surface1);
            border-top: 1px solid var(--surface2);
        }

        .results-area h6 {
            color: var(--green);
            margin: 0 0 15px 0;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .results-content {
            min-height: 100px;
        }

        /* Analysis Results Styles */
        .analysis-results {
            color: var(--text);
        }

        .result-section {
            margin-bottom: 25px;
            padding: 15px;
            background: var(--crust);
            border-radius: 8px;
            border: 1px solid var(--surface2);
        }

        .result-section h4 {
            color: var(--blue);
            margin: 0 0 15px 0;
            font-size: 16px;
        }

        .result-section ul {
            margin: 0;
            padding-left: 20px;
        }

        .result-section li {
            margin-bottom: 8px;
        }

        .result-section p {
            margin: 0;
            line-height: 1.5;
        }

        .color-swatches {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .color-swatch {
            width: 80px;
            height: 60px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease;
        }

        .color-swatch:hover {
            transform: scale(1.05);
        }

        .color-swatch small {
            font-size: 10px;
            opacity: 0.9;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            color: var(--text);
            font-size: 16px;
        }

        .result-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--surface2);
        }

        /* Quick Test Button Styles */
        .quick-test-btn {
            background: var(--green);
            color: var(--crust);
        }

        .quick-test-btn:hover {
            background: var(--teal);
        }

        /* Quick Test Results Area Styles */
        .quick-test-results-area {
            background: var(--surface0);
            border: 2px solid var(--surface1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .quick-test-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--surface1);
        }

        .quick-test-header h3 {
            color: var(--green);
            margin: 0 0 10px 0;
            font-size: 1.8em;
        }

        .quick-test-header p {
            color: var(--subtext1);
            margin: 0;
            font-size: 1.1em;
        }

        .quick-test-content {
            min-height: 100px;
        }

        .quick-test-placeholder {
            text-align: center;
            color: var(--subtext1);
            padding: 40px 20px;
        }

        .quick-test-placeholder p {
            margin: 5px 0;
            font-size: 1.1em;
        }

        .quick-test-results {
            background: var(--crust);
            border: 1px solid var(--surface1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .quick-test-results h4 {
            color: var(--green);
            margin: 0 0 15px 0;
            font-size: 1.3em;
        }

        .quick-test-command {
            background: var(--mantle);
            border: 1px solid var(--surface2);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
            font-size: 0.9em;
            color: var(--yellow);
        }

        .quick-test-output {
            background: var(--mantle);
            border: 1px solid var(--surface2);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .quick-test-output pre {
            margin: 0;
            color: var(--text);
            font-family: 'JetBrainsMono Nerd Font Mono', monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .quick-test-loading {
            text-align: center;
            color: var(--green);
            padding: 20px;
            font-size: 1.2em;
        }

        .quick-test-error {
            background: var(--red);
            color: var(--crust);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }

        .quick-test-success {
            background: var(--green);
            color: var(--crust);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }

        /* Image Hover Effects */
        .result-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .result-image:hover {
            transform: scale(1.05);
        }

        .image-container {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .image-container:hover .image-overlay {
            opacity: 1;
        }

        .overlay-text {
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .no-image {
            width: 100%;
            height: 200px;
            background: var(--surface1);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            color: var(--subtext1);
            font-style: italic;
        }

        .no-colors {
            color: var(--subtext1);
            font-style: italic;
            font-size: 14px;
        }

        .no-results {
            text-align: center;
            color: var(--subtext1);
            font-style: italic;
            padding: 40px;
            font-size: 18px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>🎨 Chromatica Color Search Engine</h1>

        <!-- Color Input Section -->
        <div class="color-input-section">
            <h2>Color Query</h2>
            <div id="colorInputs">
                <div class="color-row">
                    <input type="color" class="color-picker" value="#FF0000">
                    <input type="range" class="weight-slider" min="0" max="100" value="100" step="1">
                    <span class="weight-value">100%</span>
                    <button onclick="removeColor(this)"
                        style="background: #e53e3e; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;">Remove</button>
                </div>
            </div>
            <button class="add-color-btn" onclick="addColor()">+ Add Another Color</button>
            <button class="search-btn" onclick="performSearch()" id="searchBtn">🔍 Search Images</button>
        </div>

        <!-- Loading Indicator -->
        <div class="loading" id="loading" style="display: none;">
            <h3>🔍 Searching...</h3>
            <p>Analyzing color similarities and finding the best matches...</p>
        </div>

        <!-- Success Display -->
        <div class="success" id="success" style="display: none;"></div>

        <!-- Error Display -->
        <div class="error" id="error" style="display: none;"></div>

        <!-- Search Statistics -->
        <div class="search-stats" id="searchStats" style="display: none;">
            <h3>📊 Search Performance</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="totalResults">0</div>
                    <div class="stat-label">Total Results</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="searchTime">0ms</div>
                    <div class="stat-label">Search Time</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgDistance">0.0</div>
                    <div class="stat-label">Avg Distance</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="indexSize">0</div>
                    <div class="stat-label">Index Size</div>
                </div>
            </div>
        </div>

        <!-- Visualization Section -->
        <div class="visualization-section" id="visualizationSection" style="display: none;">
            <h2>🎨 Query Visualization</h2>
            <div class="viz-grid">
                <div class="viz-card">
                    <h3>Query Visualization</h3>
                    <div id="query-viz">
                        <p class="loading">Click "Search Images" to generate visualization</p>
                    </div>
                </div>
                <div class="viz-card">
                    <h3>Results Collage</h3>
                    <div id="results-viz">
                        <p class="loading">Click "Search Images" to generate collage</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <h2>🔍 Top Search Results</h2>
            <div class="results-grid" id="resultsGrid"></div>
        </div>

        <!-- Ranking Explanation -->
        <div class="ranking-explanation">
            <h3>🎯 How Images Are Ranked</h3>
            <p><strong>Two-Stage Search Process:</strong></p>
            <p>1. <strong>Fast Initial Retrieval:</strong> FAISS HNSW index finds ~100 similar candidates using L2
                distance on Hellinger-transformed histograms</p>
            <p>2. <strong>High-Fidelity Reranking:</strong> Top candidates are reranked using Sinkhorn-approximated
                Earth Mover's Distance (EMD) for perceptual color similarity</p>
            <p><strong>Distance Values:</strong> Lower distances indicate more similar color distributions. EMD values
                typically range from 0.0 (identical) to 2.0+ (very different).</p>
        </div>

        <!-- Quick Test Results Area - Always Visible -->
        <div class="quick-test-results-area" id="quickTestResultsArea">
            <div class="quick-test-header">
                <h3>🧪 Quick Test Results</h3>
                <p>Results from Quick Test executions appear here automatically</p>
            </div>
            <div class="quick-test-content" id="quickTestResultsContent">
                <div class="quick-test-placeholder">
                    <p>🎯 Click any "Quick Test" button to see results here</p>
                    <p>Results will be displayed in this dedicated area and will execute actual commands</p>
                </div>
            </div>
        </div>

        <!-- Advanced Visualization Tools -->
        <div class="tools-section">
            <h2>🎨 Advanced Visualization Tools</h2>
            <p>Professional-grade tools for color analysis, search result visualization, and data exploration.</p>
        </div>

        <!-- Visualization Tools Section -->
        <div class="visualization-tools-section">
            <h2>🔬 Advanced Visualization Tools</h2>

            <!-- Core Visualization Tools -->
            <div class="tool-category">
                <h3>🎨 Core Visualization Module</h3>
                <p>Built-in visualization capabilities for queries and search results, including weighted color bars,
                    color palettes, and result collages.</p>
            </div>

            <div class="tools-grid">
                <!-- Color Palette Visualization Tool -->
                <div class="tool-card">
                    <div class="tool-header">
                        <div class="tool-icon">🎨</div>
                        <h4 class="tool-title">Color Palette Analyzer</h4>
                    </div>
                    <div class="tool-description">
                        Comprehensive analysis and visualization of color palettes extracted from images, including
                        dominant colors, distribution patterns, and palette comparison.
                    </div>
                    <div class="tool-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Extract dominant colors using K-means clustering</li>
                            <li>Generate color swatches and distribution charts</li>
                            <li>Compare palettes between multiple images</li>
                            <li>L*a*b* color space projections</li>
                            <li>Export palette visualizations</li>
                        </ul>
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn primary-btn" onclick="runColorPaletteTool()">Run Tool</button>
                        <button class="tool-btn info-btn" onclick="showToolInfo('color-palette')">Info</button>
                        <button class="tool-btn quick-test-btn" onclick="quickTestColorPalette()">Quick Test</button>
                    </div>

                    <!-- Expandable Tool Panel -->
                    <div class="tool-panel" id="colorPalettePanel" style="display: none;">
                        <div class="panel-header">
                            <h5>🎨 Color Palette Analysis Configuration</h5>
                            <button class="panel-close" onclick="toggleToolPanel('colorPalettePanel')">×</button>
                        </div>

                        <div class="panel-content">
                            <div class="input-section">
                                <h6>Image Input</h6>
                                <div class="input-group">
                                    <label for="colorPaletteImage">Select Image:</label>
                                    <input type="file" id="colorPaletteImage" accept="image/*" class="file-input">
                                    <small>Supported formats: JPG, PNG, GIF</small>
                                </div>

                                <div class="input-group">
                                    <label for="colorPaletteDirectory">Or Select Directory:</label>
                                    <input type="text" id="colorPaletteDirectory"
                                        placeholder="e.g., datasets/test-dataset-20" class="text-input">
                                    <button class="browse-btn"
                                        onclick="browseDirectory('colorPaletteDirectory')">Browse</button>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Analysis Parameters</h6>
                                <div class="input-group">
                                    <label for="colorPaletteNumColors">Number of Dominant Colors:</label>
                                    <input type="number" id="colorPaletteNumColors" min="2" max="20" value="5"
                                        class="number-input">
                                    <small>Range: 2-20 colors</small>
                                </div>

                                <div class="input-group">
                                    <label for="colorPaletteColorSpace">Color Space:</label>
                                    <select id="colorPaletteColorSpace" class="select-input">
                                        <option value="lab">L*a*b* (Recommended)</option>
                                        <option value="rgb">RGB</option>
                                        <option value="hsv">HSV</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="colorPaletteClustering">Clustering Method:</label>
                                    <select id="colorPaletteClustering" class="select-input">
                                        <option value="kmeans">K-Means (Default)</option>
                                        <option value="dbscan">DBSCAN</option>
                                        <option value="hierarchical">Hierarchical</option>
                                    </select>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Output Options</h6>
                                <div class="input-group">
                                    <label for="colorPaletteOutputFormat">Output Format:</label>
                                    <select id="colorPaletteOutputFormat" class="select-input">
                                        <option value="png">PNG Image</option>
                                        <option value="pdf">PDF Report</option>
                                        <option value="json">JSON Data</option>
                                        <option value="csv">CSV Data</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="colorPaletteResolution">Image Resolution:</label>
                                    <select id="colorPaletteResolution" class="select-input">
                                        <option value="low">Low (800x600)</option>
                                        <option value="medium" selected>Medium (1200x800)</option>
                                        <option value="high">High (1920x1080)</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="colorPaletteIncludeStats">Include Statistics:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="colorPaletteStats" checked> Color distribution
                                            stats</label>
                                        <label><input type="checkbox" id="colorPaletteCharts" checked> Distribution
                                            charts</label>
                                        <label><input type="checkbox" id="colorPaletteComparison" checked> Palette
                                            comparison</label>
                                        <label><input type="checkbox" id="colorPaletteExport" checked> Export
                                            data</label>
                                    </div>
                                </div>
                            </div>

                            <div class="panel-actions">
                                <button class="action-btn primary-btn" onclick="executeColorPaletteAnalysis()">Run
                                    Analysis</button>
                                <button class="action-btn secondary-btn"
                                    onclick="resetColorPaletteForm()">Reset</button>
                                <button class="action-btn info-btn" onclick="showColorPaletteHelp()">Help</button>
                            </div>
                        </div>

                        <!-- Results Display Area -->
                        <div class="results-area" id="colorPaletteResults" style="display: none;">
                            <h6>Analysis Results</h6>
                            <div class="results-content" id="colorPaletteResultsContent">
                                <!-- Results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search Results Visualization Tool -->
                <div class="tool-card">
                    <div class="tool-header">
                        <div class="tool-icon">📊</div>
                        <h4 class="tool-title">Search Results Analyzer</h4>
                    </div>
                    <div class="tool-description">
                        Advanced visualization and analysis of search results, including ranking analysis, distance
                        distribution, color similarity mapping, and performance metrics.
                    </div>
                    <div class="tool-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Visualize search result rankings and distances</li>
                            <li>Analyze color similarity patterns</li>
                            <li>Generate performance reports and heatmaps</li>
                            <li>Create interactive result galleries</li>
                            <li>Export visualizations for analysis</li>
                        </ul>
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn primary-btn" onclick="runSearchResultsTool()">Run Tool</button>
                        <button class="tool-btn info-btn" onclick="showToolInfo('search-results')">Info</button>
                        <button class="tool-btn quick-test-btn" onclick="quickTestSearchResults()">Quick Test</button>
                    </div>

                    <!-- Expandable Tool Panel -->
                    <div class="tool-panel" id="searchResultsPanel" style="display: none;">
                        <div class="panel-header">
                            <h5>📊 Search Results Analysis Configuration</h5>
                            <button class="panel-close" onclick="toggleToolPanel('searchResultsPanel')">×</button>
                        </div>

                        <div class="panel-content">
                            <div class="input-section">
                                <h6>Search Query</h6>
                                <div class="input-group">
                                    <label for="searchResultsQuery">Color Query:</label>
                                    <input type="text" id="searchResultsQuery" placeholder="e.g., FF0000,00FF00"
                                        class="text-input">
                                    <small>Enter hex colors separated by commas</small>
                                </div>

                                <div class="input-group">
                                    <label for="searchResultsWeights">Color Weights:</label>
                                    <input type="text" id="searchResultsWeights" placeholder="e.g., 0.7,0.3"
                                        class="text-input">
                                    <small>Enter weights separated by commas (optional)</small>
                                </div>

                                <div class="input-group">
                                    <label for="searchResultsK">Number of Results (K):</label>
                                    <input type="number" id="searchResultsK" min="1" max="100" value="10"
                                        class="number-input">
                                    <small>Range: 1-100 results</small>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Analysis Options</h6>
                                <div class="input-group">
                                    <label for="searchResultsAnalysisType">Analysis Type:</label>
                                    <select id="searchResultsAnalysisType" class="select-input">
                                        <option value="ranking">Ranking Analysis</option>
                                        <option value="distance">Distance Distribution</option>
                                        <option value="similarity">Color Similarity Mapping</option>
                                        <option value="performance">Performance Metrics</option>
                                        <option value="comprehensive">Comprehensive Analysis</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="searchResultsVisualization">Visualization Style:</label>
                                    <select id="searchResultsVisualization" class="select-input">
                                        <option value="charts">Charts & Graphs</option>
                                        <option value="heatmaps">Heatmaps</option>
                                        <option value="gallery">Interactive Gallery</option>
                                        <option value="comparison">Comparison Views</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="searchResultsIncludeMetadata">Include Metadata:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="searchResultsMetadata" checked> Search
                                            performance metrics</label>
                                        <label><input type="checkbox" id="searchResultsTiming" checked> Timing
                                            breakdown</label>
                                        <label><input type="checkbox" id="searchResultsIndex" checked> Index
                                            information</label>
                                        <label><input type="checkbox" id="searchResultsExport" checked> Export
                                            capabilities</label>
                                    </div>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Output Configuration</h6>
                                <div class="input-group">
                                    <label for="searchResultsOutputFormat">Output Format:</label>
                                    <select id="searchResultsOutputFormat" class="select-input">
                                        <option value="png">PNG Image</option>
                                        <option value="pdf">PDF Report</option>
                                        <option value="html">Interactive HTML</option>
                                        <option value="json">JSON Data</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="searchResultsResolution">Resolution:</label>
                                    <select id="searchResultsResolution" class="select-input">
                                        <option value="low">Low (800x600)</option>
                                        <option value="medium" selected>Medium (1200x800)</option>
                                        <option value="high">High (1920x1080)</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>
                            </div>

                            <div class="panel-actions">
                                <button class="action-btn primary-btn" onclick="executeSearchResultsAnalysis()">Run
                                    Analysis</button>
                                <button class="action-btn secondary-btn"
                                    onclick="resetSearchResultsForm()">Reset</button>
                                <button class="action-btn info-btn" onclick="showSearchResultsHelp()">Help</button>
                            </div>
                        </div>

                        <!-- Results Display Area -->
                        <div class="results-area" id="searchResultsResults" style="display: none;">
                            <h6>Analysis Results</h6>
                            <div class="results-content" id="searchResultsResultsContent">
                                <!-- Results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Color Explorer Tool -->
                <div class="tool-card">
                    <div class="tool-header">
                        <div class="tool-icon">🔍</div>
                        <h4 class="tool-title">Interactive Color Explorer</h4>
                    </div>
                    <div class="tool-description">
                        Interactive interface for exploring color combinations, analyzing color relationships, and
                        experimenting with different color schemes and harmonies.
                    </div>
                    <div class="tool-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Interactive color picker and palette builder</li>
                            <li>Color harmony analysis (complementary, analogous, triadic)</li>
                            <li>Real-time color preview and scheme generation</li>
                            <li>Integration with Chromatica API for live search</li>
                            <li>Export color palettes and schemes</li>
                        </ul>
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn primary-btn" onclick="runColorExplorer()">Run Tool</button>
                        <button class="tool-btn info-btn" onclick="showToolInfo('color-explorer')">Info</button>
                        <button class="tool-btn quick-test-btn" onclick="quickTestColorExplorer()">Quick Test</button>
                    </div>

                    <!-- Expandable Tool Panel -->
                    <div class="tool-panel" id="colorExplorerPanel" style="display: none;">
                        <div class="panel-header">
                            <h5>🔍 Interactive Color Explorer Configuration</h5>
                            <button class="panel-close" onclick="toggleToolPanel('colorExplorerPanel')">×</button>
                        </div>

                        <div class="panel-content">
                            <div class="input-section">
                                <h6>Color Input</h6>
                                <div class="input-group">
                                    <label for="colorExplorerBaseColor">Base Color:</label>
                                    <input type="color" id="colorExplorerBaseColor" value="#FF0000" class="file-input">
                                    <small>Select a base color to explore harmonies</small>
                                </div>

                                <div class="input-group">
                                    <label for="colorExplorerColorCount">Number of Colors:</label>
                                    <input type="number" id="colorExplorerColorCount" min="2" max="12" value="5"
                                        class="number-input">
                                    <small>Range: 2-12 colors in palette</small>
                                </div>

                                <div class="input-group">
                                    <label for="colorExplorerColorSpace">Color Space:</label>
                                    <select id="colorExplorerColorSpace" class="select-input">
                                        <option value="hsv">HSV (Recommended)</option>
                                        <option value="lab">L*a*b*</option>
                                        <option value="rgb">RGB</option>
                                        <option value="hsl">HSL</option>
                                    </select>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Harmony Analysis</h6>
                                <div class="input-group">
                                    <label for="colorExplorerHarmonyType">Harmony Type:</label>
                                    <select id="colorExplorerHarmonyType" class="select-input">
                                        <option value="complementary">Complementary</option>
                                        <option value="analogous">Analogous</option>
                                        <option value="triadic">Triadic</option>
                                        <option value="split_complementary">Split Complementary</option>
                                        <option value="tetradic">Tetradic</option>
                                        <option value="monochromatic">Monochromatic</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="colorExplorerSaturation">Saturation Range:</label>
                                    <select id="colorExplorerSaturation" class="select-input">
                                        <option value="low">Low (Pastel)</option>
                                        <option value="medium" selected>Medium (Balanced)</option>
                                        <option value="high">High (Vibrant)</option>
                                        <option value="full">Full Spectrum</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="colorExplorerBrightness">Brightness Range:</label>
                                    <select id="colorExplorerBrightness" class="select-input">
                                        <option value="dark">Dark</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="light">Light</option>
                                        <option value="full">Full Range</option>
                                    </select>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Integration Options</h6>
                                <div class="input-group">
                                    <label for="colorExplorerAPIIntegration">API Integration:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="colorExplorerLiveSearch" checked> Live search
                                            integration</label>
                                        <label><input type="checkbox" id="colorExplorerPaletteSearch" checked>
                                            Palette-based search</label>
                                        <label><input type="checkbox" id="colorExplorerExportPalette" checked> Export
                                            generated palettes</label>
                                        <label><input type="checkbox" id="colorExplorerSaveSchemes" checked> Save color
                                            schemes</label>
                                    </div>
                                </div>

                                <div class="input-group">
                                    <label for="colorExplorerOutputFormat">Output Format:</label>
                                    <select id="colorExplorerOutputFormat" class="select-input">
                                        <option value="png">PNG Image</option>
                                        <option value="svg">SVG Vector</option>
                                        <option value="html">Interactive HTML</option>
                                        <option value="json">JSON Data</option>
                                        <option value="css">CSS Variables</option>
                                    </select>
                                </div>
                            </div>

                            <div class="panel-actions">
                                <button class="action-btn primary-btn" onclick="executeColorExplorer()">Run
                                    Explorer</button>
                                <button class="action-btn secondary-btn"
                                    onclick="resetColorExplorerForm()">Reset</button>
                                <button class="action-btn info-btn" onclick="showColorExplorerHelp()">Help</button>
                            </div>
                        </div>

                        <!-- Results Display Area -->
                        <div class="results-area" id="colorExplorerResults" style="display: none;">
                            <h6>Exploration Results</h6>
                            <div class="results-content" id="colorExplorerResultsContent">
                                <!-- Results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Histogram Analysis Tool -->
                <div class="tool-card">
                    <div class="tool-header">
                        <div class="tool-icon">📈</div>
                        <h4 class="tool-title">Histogram Analysis</h4>
                    </div>
                    <div class="tool-description">
                        Comprehensive testing and visualization of histogram generation, including validation,
                        performance benchmarking, and distribution analysis.
                    </div>
                    <div class="tool-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Single image and batch directory processing</li>
                            <li>Histogram validation and quality checks</li>
                            <li>Performance benchmarking and timing</li>
                            <li>Visualization of histogram distributions</li>
                            <li>Multiple output formats (JSON, CSV, visualizations)</li>
                        </ul>
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn primary-btn" onclick="runHistogramAnalysis()">Run Tool</button>
                        <button class="tool-btn info-btn" onclick="showToolInfo('histogram-analysis')">Info</button>
                        <button class="tool-btn quick-test-btn" onclick="quickTestHistogramAnalysis()">Quick
                            Test</button>
                    </div>

                    <!-- Expandable Tool Panel -->
                    <div class="tool-panel" id="histogramAnalysisPanel" style="display: none;">
                        <div class="panel-header">
                            <h5>📈 Histogram Analysis Configuration</h5>
                            <button class="panel-close" onclick="toggleToolPanel('histogramAnalysisPanel')">×</button>
                        </div>

                        <div class="panel-content">
                            <div class="input-section">
                                <h6>Input Configuration</h6>
                                <div class="input-group">
                                    <label for="histogramAnalysisInput">Input Source:</label>
                                    <select id="histogramAnalysisInput" class="select-input">
                                        <option value="single">Single Image</option>
                                        <option value="directory" selected>Directory (Batch)</option>
                                        <option value="histogram">Pre-computed Histogram</option>
                                        <option value="api">API Query Results</option>
                                    </select>
                                    <small>Choose input type for histogram analysis</small>
                                </div>

                                <div class="input-group">
                                    <label for="histogramAnalysisPath">Path/File:</label>
                                    <input type="text" id="histogramAnalysisPath" class="text-input"
                                        placeholder="datasets/test-dataset-20">
                                    <button class="browse-btn"
                                        onclick="browseDirectory('histogramAnalysisPath')">Browse</button>
                                    <small>Directory path or file path for analysis</small>
                                </div>

                                <div class="input-group">
                                    <label for="histogramAnalysisMaxFiles">Max Files:</label>
                                    <input type="number" id="histogramAnalysisMaxFiles" min="1" max="1000" value="50"
                                        class="number-input">
                                    <small>Maximum number of files to process (1-1000)</small>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Analysis Parameters</h6>
                                <div class="input-group">
                                    <label for="histogramAnalysisValidation">Validation Level:</label>
                                    <select id="histogramAnalysisValidation" class="select-input">
                                        <option value="basic">Basic (Fast)</option>
                                        <option value="standard" selected>Standard (Balanced)</option>
                                        <option value="comprehensive">Comprehensive (Thorough)</option>
                                        <option value="expert">Expert (All Checks)</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="histogramAnalysisPerformance">Performance Testing:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="histogramAnalysisTiming" checked> Timing
                                            measurements</label>
                                        <label><input type="checkbox" id="histogramAnalysisMemory" checked> Memory usage
                                            tracking</label>
                                        <label><input type="checkbox" id="histogramAnalysisThroughput" checked>
                                            Throughput analysis</label>
                                        <label><input type="checkbox" id="histogramAnalysisBenchmarks" checked>
                                            Benchmark comparisons</label>
                                    </div>
                                </div>

                                <div class="input-group">
                                    <label for="histogramAnalysisVisualization">Visualization Options:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="histogramAnalysisCharts" checked> Distribution
                                            charts</label>
                                        <label><input type="checkbox" id="histogramAnalysisHeatmaps" checked> Color
                                            heatmaps</label>
                                        <label><input type="checkbox" id="histogramAnalysis3D" checked> 3D
                                            projections</label>
                                        <label><input type="checkbox" id="histogramAnalysisComparison" checked>
                                            Comparison plots</label>
                                    </div>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Output Configuration</h6>
                                <div class="input-group">
                                    <label for="histogramAnalysisOutputFormat">Output Format:</label>
                                    <select id="histogramAnalysisOutputFormat" class="select-input">
                                        <option value="png">PNG Images</option>
                                        <option value="pdf">PDF Report</option>
                                        <option value="html">Interactive HTML</option>
                                        <option value="json">JSON Data</option>
                                        <option value="csv">CSV Export</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label for="histogramAnalysisResolution">Resolution:</label>
                                    <select id="histogramAnalysisResolution" class="select-input">
                                        <option value="low">Low (800x600)</option>
                                        <option value="medium" selected>Medium (1200x800)</option>
                                        <option value="high">High (1920x1080)</option>
                                        <option value="ultra">Ultra HD (4K)</option>
                                    </select>
                                    <small>Resolution for generated visualizations</small>
                                </div>

                                <div class="input-group">
                                    <label for="histogramAnalysisIncludeData">Include Data:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="histogramAnalysisRawData" checked> Raw
                                            histogram data</label>
                                        <label><input type="checkbox" id="histogramAnalysisMetadata" checked> Image
                                            metadata</label>
                                        <label><input type="checkbox" id="histogramAnalysisStatistics" checked>
                                            Statistical summaries</label>
                                        <label><input type="checkbox" id="histogramAnalysisQuality" checked> Quality
                                            metrics</label>
                                    </div>
                                </div>
                            </div>

                            <div class="panel-actions">
                                <button class="action-btn primary-btn" onclick="executeHistogramAnalysis()">Run
                                    Analysis</button>
                                <button class="action-btn secondary-btn"
                                    onclick="resetHistogramAnalysisForm()">Reset</button>
                                <button class="action-btn info-btn" onclick="showHistogramAnalysisHelp()">Help</button>
                            </div>
                        </div>

                        <!-- Results Display Area -->
                        <div class="results-area" id="histogramAnalysisResults" style="display: none;">
                            <h6>Analysis Results</h6>
                            <div class="results-content" id="histogramAnalysisResultsContent">
                                <!-- Results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Distance Debugging Tool -->
                <div class="tool-card">
                    <div class="tool-header">
                        <div class="tool-icon">🐛</div>
                        <h4 class="tool-title">Distance Debugger</h4>
                    </div>
                    <div class="tool-description">
                        Debug and analyze Sinkhorn-EMD distance calculations, identify numerical stability issues, and
                        validate distance metrics.
                    </div>
                    <div class="tool-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Debug Sinkhorn-EMD distance calculations</li>
                            <li>Identify numerical stability issues</li>
                            <li>Validate distance metrics and fallbacks</li>
                            <li>Compare different distance calculation methods</li>
                            <li>Generate debugging reports</li>
                        </ul>
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn primary-btn" onclick="runDistanceDebugger()">Run Tool</button>
                        <button class="tool-btn info-btn" onclick="showToolInfo('distance-debugger')">Info</button>
                        <button class="tool-btn quick-test-btn" onclick="quickTestDistanceDebugger()">Quick
                            Test</button>
                    </div>

                    <!-- Expandable Tool Panel -->
                    <div class="tool-panel" id="distanceDebuggerPanel" style="display: none;">
                        <div class="panel-header">
                            <h5>🐛 Distance Debugger Configuration</h5>
                            <button class="panel-close" onclick="toggleToolPanel('distanceDebuggerPanel')">×</button>
                        </div>

                        <div class="panel-content">
                            <div class="input-section">
                                <h6>Test Configuration</h6>
                                <div class="input-group">
                                    <label for="distanceDebuggerTestType">Test Type:</label>
                                    <select id="distanceDebuggerTestType" class="select-input">
                                        <option value="pairwise">Pairwise Comparison</option>
                                        <option value="batch" selected>Batch Analysis</option>
                                        <option value="stability">Numerical Stability</option>
                                        <option value="performance">Performance Benchmarking</option>
                                        <option value="fallback">Fallback Analysis</option>
                                    </select>
                                    <small>Choose the type of distance debugging to perform</small>
                                </div>

                                <div class="input-group">
                                    <label for="distanceDebuggerDataset">Test Dataset:</label>
                                    <select id="distanceDebuggerDataset" class="select-input">
                                        <option value="test-dataset-20">Test Dataset 20 (20 images)</option>
                                        <option value="test-dataset-50" selected>Test Dataset 50 (50 images)</option>
                                        <option value="test-dataset-200">Test Dataset 200 (200 images)</option>
                                        <option value="custom">Custom Path</option>
                                    </select>
                                    <small>Select dataset for distance debugging</small>
                                </div>

                                <div class="input-group">
                                    <label for="distanceDebuggerCustomPath">Custom Path:</label>
                                    <input type="text" id="distanceDebuggerCustomPath" class="text-input"
                                        placeholder="datasets/custom-path" disabled>
                                    <small>Enter custom dataset path (enabled when Custom Path is selected)</small>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Distance Calculation Settings</h6>
                                <div class="input-group">
                                    <label for="distanceDebuggerEpsilon">Sinkhorn Epsilon:</label>
                                    <select id="distanceDebuggerEpsilon" class="select-input">
                                        <option value="0.1">0.1 (Aggressive)</option>
                                        <option value="0.5">0.5 (Balanced)</option>
                                        <option value="1.0" selected>1.0 (Stable - Current)</option>
                                        <option value="2.0">2.0 (Conservative)</option>
                                        <option value="5.0">5.0 (Very Conservative)</option>
                                    </select>
                                    <small>Epsilon value for Sinkhorn-EMD calculation (lower = more precise, higher =
                                        more stable)</small>
                                </div>

                                <div class="input-group">
                                    <label for="distanceDebuggerMaxIterations">Max Iterations:</label>
                                    <input type="number" id="distanceDebuggerMaxIterations" min="100" max="10000"
                                        value="1000" class="number-input">
                                    <small>Maximum iterations for Sinkhorn algorithm (100-10000)</small>
                                </div>

                                <div class="input-group">
                                    <label for="distanceDebuggerFallback">Fallback Strategy:</label>
                                    <select id="distanceDebuggerFallback" class="select-input">
                                        <option value="l2">L2 Distance (Fast)</option>
                                        <option value="cosine">Cosine Similarity (Balanced)</option>
                                        <option value="manhattan" selected>Manhattan Distance (Robust)</option>
                                        <option value="chebyshev">Chebyshev Distance (Conservative)</option>
                                    </select>
                                    <small>Distance metric to use when Sinkhorn-EMD fails</small>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Debugging Options</h6>
                                <div class="input-group">
                                    <label for="distanceDebuggerAnalysis">Analysis Depth:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="distanceDebuggerNumerical" checked> Numerical
                                            stability analysis</label>
                                        <label><input type="checkbox" id="distanceDebuggerConvergence" checked>
                                            Convergence tracking</label>
                                        <label><input type="checkbox" id="distanceDebuggerError" checked> Error pattern
                                            analysis</label>
                                        <label><input type="checkbox" id="distanceDebuggerComparison" checked> Metric
                                            comparison</label>
                                    </div>
                                </div>

                                <div class="input-group">
                                    <label for="distanceDebuggerOutput">Output Options:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="distanceDebuggerDetailed" checked> Detailed
                                            debug logs</label>
                                        <label><input type="checkbox" id="distanceDebuggerSummary" checked> Summary
                                            report</label>
                                        <label><input type="checkbox" id="distanceDebuggerVisualization" checked> Debug
                                            visualizations</label>
                                        <label><input type="checkbox" id="distanceDebuggerExport" checked> Export debug
                                            data</label>
                                    </div>
                                </div>

                                <div class="input-group">
                                    <label for="distanceDebuggerOutputFormat">Output Format:</label>
                                    <select id="distanceDebuggerOutputFormat" class="select-input">
                                        <option value="json">JSON Report</option>
                                        <option value="html" selected>HTML Report</option>
                                        <option value="pdf">PDF Report</option>
                                        <option value="csv">CSV Data</option>
                                        <option value="text">Plain Text</option>
                                    </select>
                                </div>
                            </div>

                            <div class="panel-actions">
                                <button class="action-btn primary-btn" onclick="executeDistanceDebugger()">Run
                                    Debugger</button>
                                <button class="action-btn secondary-btn"
                                    onclick="resetDistanceDebuggerForm()">Reset</button>
                                <button class="action-btn info-btn" onclick="showDistanceDebuggerHelp()">Help</button>
                            </div>
                        </div>

                        <!-- Results Display Area -->
                        <div class="results-area" id="distanceDebuggerResults" style="display: none;">
                            <h6>Debug Results</h6>
                            <div class="results-content" id="distanceDebuggerResultsContent">
                                <!-- Results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Query Visualization Tool -->
                <div class="tool-card">
                    <div class="tool-header">
                        <div class="tool-icon">🎭</div>
                        <h4 class="tool-title">Query Visualizer</h4>
                    </div>
                    <div class="tool-description">
                        Create visual representations of color queries with weighted color bars, color palettes, and
                        comprehensive query summaries.
                    </div>
                    <div class="tool-features">
                        <h4>Key Features:</h4>
                        <ul class="feature-list">
                            <li>Generate weighted color bars representing query colors</li>
                            <li>Create color palette visualizations with weights</li>
                            <li>Build comprehensive query summary images</li>
                            <li>Export query visualizations</li>
                            <li>Customizable color representations</li>
                        </ul>
                    </div>
                    <div class="tool-actions">
                        <button class="tool-btn primary-btn" onclick="runQueryVisualizer()">Run Tool</button>
                        <button class="tool-btn info-btn" onclick="showToolInfo('query-visualizer')">Info</button>
                        <button class="tool-btn quick-test-btn" onclick="quickTestQueryVisualizer()">Quick Test</button>
                    </div>

                    <!-- Expandable Tool Panel -->
                    <div class="tool-panel" id="queryVisualizerPanel" style="display: none;">
                        <div class="panel-header">
                            <h5>🎭 Query Visualizer Configuration</h5>
                            <button class="panel-close" onclick="toggleToolPanel('queryVisualizerPanel')">×</button>
                        </div>

                        <div class="panel-content">
                            <div class="input-section">
                                <h6>Query Configuration</h6>
                                <div class="input-group">
                                    <label for="queryVisualizerColors">Color Query:</label>
                                    <input type="text" id="queryVisualizerColors" class="text-input"
                                        placeholder="FF0000,00FF00,0000FF" value="FF0000,00FF00">
                                    <small>Enter hex colors separated by commas (without #)</small>
                                </div>

                                <div class="input-group">
                                    <label for="queryVisualizerWeights">Color Weights:</label>
                                    <input type="text" id="queryVisualizerWeights" class="text-input"
                                        placeholder="0.6,0.4" value="0.6,0.4">
                                    <small>Enter weights separated by commas (will be normalized to sum to 1.0)</small>
                                </div>

                                <div class="input-group">
                                    <label for="queryVisualizerQueryType">Query Type:</label>
                                    <select id="queryVisualizerQueryType" class="select-input">
                                        <option value="single">Single Color</option>
                                        <option value="dual" selected>Dual Color</option>
                                        <option value="multi">Multi-Color</option>
                                        <option value="gradient">Color Gradient</option>
                                        <option value="palette">Color Palette</option>
                                    </select>
                                    <small>Choose the type of color query to visualize</small>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Visualization Settings</h6>
                                <div class="input-group">
                                    <label for="queryVisualizerStyle">Visualization Style:</label>
                                    <select id="queryVisualizerStyle" class="select-input">
                                        <option value="bars">Weighted Color Bars</option>
                                        <option value="circles" selected>Color Circles</option>
                                        <option value="squares">Color Squares</option>
                                        <option value="hexagons">Color Hexagons</option>
                                        <option value="gradient">Gradient Bar</option>
                                    </select>
                                    <small>Choose the visual representation style</small>
                                </div>

                                <div class="input-group">
                                    <label for="queryVisualizerLayout">Layout:</label>
                                    <select id="queryVisualizerLayout" class="select-input">
                                        <option value="horizontal">Horizontal</option>
                                        <option value="vertical" selected>Vertical</option>
                                        <option value="radial">Radial</option>
                                        <option value="grid">Grid</option>
                                        <option value="flow">Flow</option>
                                    </select>
                                    <small>Choose the layout arrangement</small>
                                </div>

                                <div class="input-group">
                                    <label for="queryVisualizerSize">Visualization Size:</label>
                                    <select id="queryVisualizerSize" class="select-input">
                                        <option value="small">Small (400x300)</option>
                                        <option value="medium" selected>Medium (600x450)</option>
                                        <option value="large">Large (800x600)</option>
                                        <option value="custom">Custom Dimensions</option>
                                    </select>
                                    <small>Choose the output size</small>
                                </div>

                                <div class="input-group">
                                    <label for="queryVisualizerCustomWidth">Custom Width:</label>
                                    <input type="number" id="queryVisualizerCustomWidth" class="number-input"
                                        placeholder="800" min="200" max="2000" disabled>
                                    <small>Custom width in pixels (enabled when Custom Dimensions selected)</small>
                                </div>

                                <div class="input-group">
                                    <label for="queryVisualizerCustomHeight">Custom Height:</label>
                                    <input type="number" id="queryVisualizerCustomHeight" class="number-input"
                                        placeholder="600" min="150" max="1500" disabled>
                                    <small>Custom height in pixels (enabled when Custom Dimensions selected)</small>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Advanced Options</h6>
                                <div class="input-group">
                                    <label for="queryVisualizerFeatures">Additional Features:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="queryVisualizerLabels" checked> Color labels
                                            and hex codes</label>
                                        <label><input type="checkbox" id="queryVisualizerWeights" checked> Weight
                                            percentages</label>
                                        <label><input type="checkbox" id="queryVisualizerColorNames" checked> Color
                                            names (if available)</label>
                                        <label><input type="checkbox" id="queryVisualizerHarmony" checked> Color harmony
                                            indicators</label>
                                        <label><input type="checkbox" id="queryVisualizerAccessibility" checked>
                                            Accessibility information</label>
                                    </div>
                                </div>

                                <div class="input-group">
                                    <label for="queryVisualizerBackground">Background Style:</label>
                                    <select id="queryVisualizerBackground" class="select-input">
                                        <option value="transparent">Transparent</option>
                                        <option value="white" selected>White</option>
                                        <option value="black">Black</option>
                                        <option value="gradient">Gradient</option>
                                        <option value="custom">Custom Color</option>
                                    </select>
                                    <small>Choose background style for the visualization</small>
                                </div>

                                <div class="input-group">
                                    <label for="queryVisualizerCustomBackground">Custom Background Color:</label>
                                    <input type="color" id="queryVisualizerCustomBackground" class="file-input"
                                        value="#F5F5F5" disabled>
                                    <small>Custom background color (enabled when Custom Color selected)</small>
                                </div>
                            </div>

                            <div class="input-section">
                                <h6>Output Configuration</h6>
                                <div class="input-group">
                                    <label for="queryVisualizerOutputFormat">Output Format:</label>
                                    <select id="queryVisualizerOutputFormat" class="select-input">
                                        <option value="png">PNG Image</option>
                                        <option value="svg" selected>SVG Vector</option>
                                        <option value="pdf">PDF Document</option>
                                        <option value="html">Interactive HTML</option>
                                        <option value="json">JSON Data</option>
                                    </select>
                                    <small>Choose the output format for the visualization</small>
                                </div>

                                <div class="input-group">
                                    <label for="queryVisualizerQuality">Image Quality:</label>
                                    <select id="queryVisualizerQuality" class="select-input">
                                        <option value="low">Low (Fast)</option>
                                        <option value="medium" selected>Medium (Balanced)</option>
                                        <option value="high">High (Quality)</option>
                                        <option value="ultra">Ultra (Best)</option>
                                    </select>
                                    <small>Choose image quality (affects file size and generation time)</small>
                                </div>

                                <div class="input-group">
                                    <label for="queryVisualizerIncludeMetadata">Include Metadata:</label>
                                    <div class="checkbox-group">
                                        <label><input type="checkbox" id="queryVisualizerQueryInfo" checked> Query
                                            information</label>
                                        <label><input type="checkbox" id="queryVisualizerGenerationInfo" checked>
                                            Generation details</label>
                                        <label><input type="checkbox" id="queryVisualizerColorInfo" checked> Color
                                            analysis</label>
                                        <label><input type="checkbox" id="queryVisualizerExportInfo" checked> Export
                                            options</label>
                                    </div>
                                </div>
                            </div>

                            <div class="panel-actions">
                                <button class="action-btn primary-btn" onclick="executeQueryVisualizer()">Generate
                                    Visualization</button>
                                <button class="action-btn secondary-btn"
                                    onclick="resetQueryVisualizerForm()">Reset</button>
                                <button class="action-btn info-btn" onclick="showQueryVisualizerHelp()">Help</button>
                            </div>
                        </div>

                        <!-- Results Display Area -->
                        <div class="results-area" id="queryVisualizerResults" style="display: none;">
                            <h6>Visualization Results</h6>
                            <div class="results-content" id="queryVisualizerResultsContent">
                                <!-- Results will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tool Usage Instructions -->
            <div class="tool-category">
                <h3>📖 How to Use These Tools</h3>
                <p>All visualization tools are available as Python scripts in the <code>tools/</code> directory. You can
                    run them directly from the command line or use the web interface buttons above to execute them with
                    sample data.</p>
                <p><strong>Note:</strong> Some tools require the Chromatica API to be running and may need additional
                    dependencies. Check the tool documentation for specific requirements.</p>
            </div>
        </div>

        <!-- Error Display -->
        <div class="error" id="error" style="display: none;"></div>

        <!-- Image Popup Modal -->
        <div id="imageModal" class="image-modal" style="display: none;">
            <div class="image-modal-content">
                <span class="image-close">&times;</span>
                <img id="modalImage" src="" alt="Full size image">
            </div>
        </div>

        <!-- Enhanced Details Modal -->
        <div id="detailsModal" class="modal">
            <div class="modal-content details-modal">
                <span class="close">&times;</span>
                <h2>Image Details</h2>
                <div id="imageDetailsContent">
                    <!-- Content will be populated dynamically -->
                </div>
            </div>
        </div>

        <!-- Tool Information Modal -->
        <div id="toolModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeToolModal()">&times;</span>
                <div id="toolModalContent"></div>
            </div>
        </div>
    </div>

    <script>
        let colors = ['#FF0000'];
        let weights = [100];

        function updateColors() {
            const colorPickers = document.querySelectorAll('.color-picker');
            colors = Array.from(colorPickers).map(picker => picker.value);
            updatePreview();
        }

        function updateWeights() {
            const sliders = document.querySelectorAll('.weight-slider');
            weights = Array.from(sliders).map(slider => parseInt(slider.value));

            // Update weight display
            const weightValues = document.querySelectorAll('.weight-value');
            weightValues.forEach((value, index) => {
                value.textContent = weights[index] + '%';
            });

            updatePreview();
        }

        function updatePreview() {
            // Update preview is no longer needed since we removed the preview elements
            // This function is kept for compatibility but doesn't do anything
            console.log('Colors updated:', colors);
            console.log('Weights updated:', weights);
        }

        function addColor() {
            const colorInputs = document.getElementById('colorInputs');
            const newRow = document.createElement('div');
            newRow.className = 'color-row';
            newRow.innerHTML = `
                <input type="color" class="color-picker" value="#00FF00">
                <input type="range" class="weight-slider" min="0" max="100" value="25" step="1">
                <span class="weight-value">25%</span>
                <button onclick="removeColor(this)" style="background: #e53e3e; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;">Remove</button>
            `;
            colorInputs.appendChild(newRow);

            // Add event listeners to new elements
            const newColorPicker = newRow.querySelector('.color-picker');
            const newWeightSlider = newRow.querySelector('.weight-slider');

            newColorPicker.addEventListener('change', updateColors);
            newWeightSlider.addEventListener('input', updateWeights);

            // Show remove buttons for all rows
            document.querySelectorAll('.color-row').forEach((row, index) => {
                const removeBtn = row.querySelector('button');
                if (removeBtn && index > 0) {
                    removeBtn.style.display = 'inline-block';
                }
            });

            updateColors();
            updateWeights();
        }

        function removeColor(button) {
            const row = button.parentElement;
            row.remove();

            // Hide remove buttons if only one color remains
            if (document.querySelectorAll('.color-row').length === 1) {
                document.querySelectorAll('.color-row button').forEach(btn => btn.style.display = 'none');
            }

            updateColors();
            updateWeights();
        }

        async function performSearch() {
            const searchBtn = document.getElementById('searchBtn');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const success = document.getElementById('success');
            const resultsSection = document.getElementById('resultsSection');
            const resultsGrid = document.getElementById('resultsGrid');
            const searchStats = document.getElementById('searchStats');
            const visualizationSection = document.getElementById('visualizationSection');
            const queryViz = document.getElementById('query-viz');
            const resultsViz = document.getElementById('results-viz');

            // Disable search button and show loading
            searchBtn.disabled = true;
            searchBtn.textContent = '⏳ Searching...';
            loading.style.display = 'block';
            error.style.display = 'none';
            success.style.display = 'none';
            resultsSection.style.display = 'none';
            visualizationSection.style.display = 'none';

            try {
                // Normalize weights to sum to 100
                const totalWeight = weights.reduce((sum, weight) => sum + weight, 0);
                const normalizedWeights = weights.map(weight => (weight / totalWeight).toFixed(3));

                // Remove # from colors for API
                const apiColors = colors.map(color => color.substring(1));

                // Perform search
                const searchResponse = await fetch(`/search?colors=${apiColors.join(',')}&weights=${normalizedWeights.join(',')}&k=10`);

                if (!searchResponse.ok) {
                    throw new Error(`Search failed with status: ${searchResponse.status}`);
                }

                const searchData = await searchResponse.json();

                // Generate query visualization
                queryViz.innerHTML = '<p class="loading">Generating visualization...</p>';
                try {
                    const vizResponse = await fetch(`/visualize/query?colors=${apiColors.join(',')}&weights=${normalizedWeights.join(',')}`);
                    if (vizResponse.ok) {
                        const vizBlob = await vizResponse.blob();
                        const vizUrl = URL.createObjectURL(vizBlob);
                        queryViz.innerHTML = `<img src="${vizUrl}" alt="Query Visualization" class="viz-image">`;
                    } else {
                        queryViz.innerHTML = '<p class="error">Failed to generate query visualization</p>';
                    }
                } catch (vizError) {
                    queryViz.innerHTML = '<p class="error">Query visualization not available</p>';
                }

                // Generate results collage
                resultsViz.innerHTML = '<p class="loading">Generating collage...</p>';
                try {
                    const collageResponse = await fetch(`/visualize/results?colors=${apiColors.join(',')}&weights=${normalizedWeights.join(',')}&k=10`);
                    if (collageResponse.ok) {
                        const collageBlob = await collageResponse.blob();
                        const collageUrl = URL.createObjectURL(collageBlob);
                        resultsViz.innerHTML = `<img src="${collageUrl}" alt="Results Collage" class="viz-image">`;
                    } else {
                        resultsViz.innerHTML = '<p class="error">Failed to generate results collage</p>';
                    }
                } catch (collageError) {
                    resultsViz.innerHTML = '<p class="error">Results collage not available</p>';
                }

                // Show visualization section
                visualizationSection.style.display = 'block';

                // Display search results
                displaySearchResults(searchData, searchStats, resultsSection, resultsGrid);

            } catch (error) {
                console.error('Search failed:', error);

                // Handle different types of errors
                let errorMessage = 'Search failed';
                if (error.message.includes('status: 503')) {
                    errorMessage = 'Search system is not available. Please ensure the index has been built.';
                } else if (error.message.includes('status: 500')) {
                    errorMessage = 'Internal server error. Please try again.';
                } else if (error.message.includes('status: 400')) {
                    errorMessage = 'Invalid search parameters. Please check your colors and weights.';
                } else {
                    errorMessage = `Search failed: ${error.message}`;
                }

                document.getElementById('error').innerHTML = `<h3>❌ Search Error</h3><p>${errorMessage}</p>`;
                document.getElementById('error').style.display = 'block';
            } finally {
                // Re-enable search button and hide loading
                searchBtn.disabled = false;
                searchBtn.textContent = '🔍 Search Images';
                loading.style.display = 'none';
            }
        }

        function displaySearchResults(data, searchStats, resultsSection, resultsGrid) {
            // Check if data has the expected structure
            if (!data || !data.metadata) {
                document.getElementById('error').innerHTML = '<h3>❌ Invalid Response</h3><p>Invalid search response format</p>';
                document.getElementById('error').style.display = 'block';
                return;
            }

            // Store results globally for other functions to access
            window.lastSearchResults = data.results || [];

            // Update search statistics
            if (searchStats) {
                document.getElementById('totalResults').textContent = data.results_count || 0;
                document.getElementById('searchTime').textContent = `${data.metadata.total_time_ms || 'N/A'}ms`;

                // Calculate average distance
                if (data.results && data.results.length > 0) {
                    const distances = data.results.map(r => r.distance).filter(d => d !== null && d !== undefined);
                    if (distances.length > 0) {
                        const avgDistance = distances.reduce((sum, d) => sum + d, 0) / distances.length;
                        document.getElementById('avgDistance').textContent = avgDistance.toFixed(4);
                    }
                }

                // Get index size from metadata if available
                document.getElementById('indexSize').textContent = data.metadata.index_size || 'N/A';

                searchStats.style.display = 'block';
            }

            // Display search results
            if (resultsSection && resultsGrid) {
                if (data.results && data.results.length > 0) {
                    let html = '';

                    data.results.forEach((result, index) => {
                        // Create color swatches display with click-to-copy functionality
                        let colorSwatches = '';
                        if (result.dominant_colors && result.dominant_colors.length > 0) {
                            colorSwatches = '<div class="color-swatches">';
                            result.dominant_colors.forEach(color => {
                                colorSwatches += `<div class="color-swatch" style="background-color: ${color}" title="${color}" onclick="copyColorToClipboard('${color}')"></div>`;
                            });
                            colorSwatches += '</div>';
                        }

                        html += `
                            <div class="result-card">
                                <div class="image-container">
                                    ${result.file_path ? `<img src="/image/${result.image_id}" alt="Result ${index + 1}" class="result-image" onclick="showImageModal('${result.image_id}')">` : '<div class="no-image">No image available</div>'}
                                    <div class="image-overlay">
                                        <span class="overlay-text">Click to View</span>
                                    </div>
                                </div>
                                <div class="result-info">
                                    <p><strong>Rank:</strong> #${index + 1}</p>
                                    <p><strong>Image ID:</strong> ${result.image_id || 'N/A'}</p>
                                    <p><strong>Distance:</strong> ${result.distance ? result.distance.toFixed(4) : 'N/A'}</p>
                                    <p><strong>Dominant Colors:</strong></p>
                                    ${colorSwatches}
                                    
                                    <div class="action-buttons">
                                        <button class="action-btn download-btn" onclick="downloadImage('${result.image_id}')">Download</button>
                                        <button class="action-btn copy-btn" onclick="copyImageInfo('${result.image_id}')">Copy Info</button>
                                        <button class="action-btn details-btn" onclick="showImageDetails('${result.image_id}')">Details</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });

                    resultsGrid.innerHTML = html;
                    resultsSection.style.display = 'block';
                } else {
                    resultsGrid.innerHTML = '<p class="no-results">No results found. Try adjusting your color query.</p>';
                    resultsSection.style.display = 'block';
                }
            }

            // Show success message
            showSuccess('🔍 Search Complete', `Found ${data.results_count || 0} results in ${data.metadata.total_time_ms || 'N/A'}ms`);
        }

        // Initialize
        updatePreview();

        // Add event listeners to existing color pickers and sliders
        document.addEventListener('DOMContentLoaded', function () {
            // Add event listeners to existing elements
            const colorPickers = document.querySelectorAll('.color-picker');
            const weightSliders = document.querySelectorAll('.weight-slider');

            colorPickers.forEach(picker => {
                picker.addEventListener('change', updateColors);
            });

            weightSliders.forEach(slider => {
                slider.addEventListener('input', updateWeights);
            });
        });

        // Check system status on page load
        checkSystemStatus();

        // Action button functions
        function downloadImage(imageId) {
            const link = document.createElement('a');
            link.href = `/image/${imageId}`;
            link.download = `image_${imageId}.jpg`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function copyImageId(imageId) {
            navigator.clipboard.writeText(imageId).then(() => {
                // Show a brief success message
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = '#4caf50';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 1000);
            }).catch(err => {
                console.error('Failed to copy image ID:', err);
            });
        }

        function viewImageDetails(imageId) {
            // For now, just show an alert. This could be expanded to show a modal
            alert(`Image ID: ${imageId}\n\nThis feature could show:\n- Image metadata\n- Color analysis\n- File information\n- Usage statistics`);
        }

        // Visualization Tools Functions
        function runColorPaletteTool() {
            showSuccess('🎨 Color Palette Tool', 'Running color palette analysis tool...\n\nThis tool will analyze color palettes from images in your dataset.\n\nTo run manually:\npython tools/visualize_color_palettes.py --batch datasets/test-dataset-20');
        }

        function runSearchResultsTool() {
            showSuccess('📊 Search Results Tool', 'Running search results analysis tool...\n\nThis tool will analyze and visualize search results.\n\nTo run manually:\npython tools/visualize_search_results.py --api-query "FF0000" --k 10');
        }

        function runColorExplorer() {
            showSuccess('🔍 Color Explorer Tool', 'Running interactive color explorer...\n\nThis tool provides an interactive interface for color exploration.\n\nTo run manually:\npython tools/color_explorer.py');
        }

        function runHistogramAnalysis() {
            showSuccess('📈 Histogram Analysis Tool', 'Running histogram analysis tool...\n\nThis tool will test and visualize histogram generation.\n\nTo run manually:\npython tools/test_histogram_generation.py --directory datasets/test-dataset-20 --visualize');
        }

        function runDistanceDebugger() {
            showSuccess('🐛 Distance Debugger Tool', 'Running distance debugging tool...\n\nThis tool will debug Sinkhorn-EMD distance calculations.\n\nTo run manually:\npython tools/debug_distances.py');
        }

        function runQueryVisualizer() {
            showSuccess('🎭 Query Visualizer Tool', 'Running query visualization tool...\n\nThis tool will create visual representations of color queries.\n\nTo run manually:\npython tools/demo_visualization.py');
        }

        // Tool Information Functions
        function showToolInfo(toolType) {
            const toolInfo = {
                'color-palette': {
                    title: 'Color Palette Analyzer',
                    description: 'Comprehensive analysis and visualization of color palettes extracted from images.',
                    features: [
                        'Extract dominant colors using K-means clustering',
                        'Generate color swatches and distribution charts',
                        'Compare color palettes between multiple images',
                        'L*a*b* color space projections',
                        'Export palette visualizations'
                    ],
                    usage: 'python tools/visualize_color_palettes.py --image path/to/image.jpg',
                    requirements: 'Requires: opencv-python, scikit-learn, matplotlib, seaborn',
                    quickTest: 'Quick Test: Color palette analysis with sample data\n\nThis would run:\npython tools/visualize_color_palettes.py --image datasets/test-dataset-20/001.jpg\n\nGenerates:\n- Dominant color extraction\n- Color distribution charts\n- Palette comparison visualizations'
                },
                'search-results': {
                    title: 'Search Results Analyzer',
                    description: 'Advanced visualization and analysis of search results with comprehensive metrics.',
                    features: [
                        'Visualize search result rankings and distances',
                        'Analyze color similarity patterns',
                        'Generate performance reports and heatmaps',
                        'Create interactive result galleries',
                        'Export visualizations for analysis'
                    ],
                    usage: 'python tools/visualize_search_results.py --api-query "FF0000" --k 10',
                    requirements: 'Requires: matplotlib, seaborn, requests, Chromatica API running',
                    quickTest: 'Quick Test: Search results analysis with sample dataset\n\nThis would run:\npython tools/visualize_search_results.py --dataset datasets/quick-test/search-results/sample-query-1.json\n\nGenerates:\n- Ranking analysis charts\n- Distance distribution plots\n- Color similarity heatmaps\n- Performance metrics analysis\n\nSample dataset includes 5 red-dominated search results with distances from 0.15 to 0.68'
                },
                'color-explorer': {
                    title: 'Interactive Color Explorer',
                    description: 'Interactive interface for exploring color combinations and harmonies.',
                    features: [
                        'Interactive color picker and palette builder',
                        'Color harmony analysis (complementary, analogous, triadic)',
                        'Real-time color preview and scheme generation',
                        'Integration with Chromatica API for live search',
                        'Export color palettes and schemes'
                    ],
                    usage: 'python tools/visualize_color_palettes.py --image path/to/image.jpg',
                    requirements: 'Requires: matplotlib, matplotlib.widgets, requests',
                    quickTest: 'Quick Test: Interactive color exploration with sample dataset\n\nThis would run:\npython tools/color_explorer.py --dataset datasets/quick-test/color-explorer/color-harmonies.json\n\nFeatures:\n- Interactive color picker\n- Color harmony generation (complementary, analogous, triadic)\n- Real-time preview\n- API integration for live search\n\nSample dataset includes 5 harmony types with 15+ color combinations'
                },
                'histogram-analysis': {
                    title: 'Histogram Analysis Tool',
                    description: 'Comprehensive testing and visualization of histogram generation.',
                    features: [
                        'Single image and batch directory processing',
                        'Histogram validation and quality checks',
                        'Performance benchmarking and timing',
                        'Visualization of histogram distributions',
                        'Multiple output formats (JSON, CSV, visualizations)'
                    ],
                    usage: 'python tools/test_histogram_generation.py --directory datasets/test-dataset-20',
                    requirements: 'Requires: opencv-python, scikit-image, matplotlib, seaborn',
                    quickTest: 'Quick Test: Histogram generation testing and visualization\n\nThis would run:\npython tools/test_histogram_generation.py --directory datasets/test-dataset-20 --visualize --max-files 20\n\nGenerates:\n- Histogram validation reports (20 sample histograms)\n- Performance benchmarks (timing, memory, throughput)\n- Distribution visualizations (charts, heatmaps, 3D projections)\n- Quality metrics (dimensions, normalization, consistency)\n\nSample dataset includes 20 test images for quick validation'
                },
                'distance-debugger': {
                    title: 'Distance Debugger Tool',
                    description: 'Debug and analyze Sinkhorn-EMD distance calculations.',
                    features: [
                        'Debug Sinkhorn-EMD distance calculations',
                        'Identify numerical stability issues',
                        'Validate distance metrics and fallbacks',
                        'Compare different distance calculation methods',
                        'Generate debugging reports'
                    ],
                    usage: 'python tools/debug_distances.py',
                    requirements: 'Requires: numpy, POT library, Chromatica core modules',
                    quickTest: 'Quick Test: Distance calculation debugging with sample dataset\n\nThis would run:\npython tools/debug_distances.py --dataset datasets/quick-test/distance-debugger/ --test-type stability --epsilon 1.0\n\nGenerates:\n- Distance calculation analysis (5 test pairs)\n- Sinkhorn-EMD debugging with stability metrics\n- Metric comparison reports (Sinkhorn vs L2 vs Manhattan)\n- Stability analysis and fallback behavior\n\nSample dataset includes 5 test pairs for numerical stability testing'
                },
                'query-visualizer': {
                    title: 'Query Visualizer Tool',
                    description: 'Create visual representations of color queries with weighted color bars.',
                    features: [
                        'Generate weighted color bars representing query colors',
                        'Create color palette visualizations with weights',
                        'Build comprehensive query summary images',
                        'Export query visualizations',
                        'Customizable color representations'
                    ],
                    usage: 'python tools/demo_visualization.py',
                    requirements: 'Requires: matplotlib, PIL, Chromatica visualization modules',
                    quickTest: 'Quick Test: Query visualization generation with sample dataset\n\nThis would run:\npython tools/demo_visualization.py --dataset datasets/quick-test/query-visualizer/ --query-type multi --style circles --layout radial\n\nGenerates:\n- Weighted color bars for 5 sample queries\n- Color palette representations with harmony analysis\n- Query summary images in multiple styles\n- Exportable visualizations (PNG, SVG, PDF)\n\nSample dataset includes 5 different query types: single color, dual color, multi-color, gradient, and palette'
                }
            };

            const info = toolInfo[toolType];
            if (info) {
                const modalContent = `
                    <h2>${info.title}</h2>
                    <p>${info.description}</p>
                    
                    <div class="usage-example">
                        <h4>Usage Example:</h4>
                        <div class="code-block">${info.usage}</div>
                    </div>
                    
                    <div class="usage-example">
                        <h4>Requirements:</h4>
                        <p>${info.requirements}</p>
                    </div>
                    
                    <h4>Key Features:</h4>
                    <ul>
                        ${info.features.map(feature => `<li>${feature}</li>`).join('')}
                    </ul>
                    
                    <div class="usage-example">
                        <h4>Quick Test Information:</h4>
                        <div class="code-block">${info.quickTest}</div>
                    </div>
                    
                    <div class="usage-example">
                        <h4>Documentation:</h4>
                        <p>For detailed documentation, see <code>docs/visualization_tools_guide.md</code></p>
                    </div>
                `;

                document.getElementById('toolModalContent').innerHTML = modalContent;
                document.getElementById('toolModal').style.display = 'block';
            }
        }

        function closeToolModal() {
            document.getElementById('toolModal').style.display = 'none';
        }

        function showDistanceDebugInfo() {
            const modalContent = `
                <h2>🐛 Distance Debugging Information</h2>
                <p>This tool helps debug issues with Sinkhorn-EMD distance calculations in the Chromatica search engine.</p>
                
                <div class="usage-example">
                    <h4>Common Issues:</h4>
                    <ul>
                        <li><strong>Numerical Stability:</strong> Sinkhorn algorithm may fail with very small epsilon values</li>
                        <li><strong>Distance Values:</strong> 0.0 distances may indicate identical histograms or calculation failures</li>
                        <li><strong>Fallback Mechanism:</strong> System automatically falls back to L2 distance if Sinkhorn fails</li>
                    </ul>
                </div>
                
                <div class="usage-example">
                    <h4>Configuration:</h4>
                    <p>Current SINKHORN_EPSILON: <code>1.0</code> (increased from 0.1 for better stability)</p>
                </div>
                
                <div class="code-block">
# Run the debug tool
python tools/debug_distances.py

# This will:
# 1. Load test histograms
# 2. Compute Sinkhorn-EMD distances
# 3. Identify problematic calculations
# 4. Show fallback behavior
                </div>
            `;

            document.getElementById('toolModalContent').innerHTML = modalContent;
            document.getElementById('toolModal').style.display = 'block';
        }

        // Demo Functions
        function demoColorPalette() {
            showSuccess('🎨 Color Palette Demo', 'Demo: Color palette analysis with sample data\n\nThis would run:\npython tools/visualize_color_palettes.py --image datasets/test-dataset-20/001.jpg\n\nGenerates:\n- Dominant color extraction\n- Color distribution charts\n- Palette comparison visualizations');
        }

        function demoSearchResults() {
            showSuccess('📊 Search Results Demo', 'Demo: Search results analysis with sample query\n\nThis would run:\npython tools/visualize_search_results.py --api-query "FF0000,00FF00" --weights "0.7,0.3" --k 5\n\nGenerates:\n- Ranking analysis charts\n- Distance distribution plots\n- Color similarity heatmaps');
        }

        function demoColorExplorer() {
            showSuccess('🔍 Color Explorer Demo', 'Demo: Interactive color exploration interface\n\nThis would run:\npython tools/color_explorer.py\n\nFeatures:\n- Interactive color picker\n- Color harmony generation\n- Real-time preview\n- API integration for live search');
        }

        function demoHistogramAnalysis() {
            showSuccess('📈 Histogram Analysis Demo', 'Demo: Histogram generation testing and visualization\n\nThis would run:\npython tools/test_histogram_generation.py --directory datasets/test-dataset-20 --visualize\n\nGenerates:\n- Histogram validation reports\n- Performance benchmarks\n- Distribution visualizations\n- Quality metrics');
        }

        function demoQueryVisualizer() {
            showSuccess('🎭 Query Visualizer Demo', 'Demo: Query visualization generation\n\nThis would run:\npython tools/demo_visualization.py\n\nGenerates:\n- Weighted color bars\n- Color palette representations\n- Query summary images\n- Exportable visualizations');
        }

        // Utility Functions
        function showSuccess(title, message) {
            const successDiv = document.getElementById('success');
            successDiv.innerHTML = `
                <h3>${title}</h3>
                <p>${message.replace(/\n/g, '<br>')}</p>
            `;
            successDiv.style.display = 'block';

            // Auto-hide after 8 seconds
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 8000);
        }

        async function checkSystemStatus() {
            try {
                const response = await fetch('/api/info');
                const data = await response.json();

                if (data.status === 'ready') {
                    // System is ready - no need to show status since we removed the status div
                    console.log('System is ready');
                } else {
                    console.log('System not ready:', data.status);
                }
            } catch (error) {
                console.log('Cannot connect to API:', error);
            }
        }

        // Image Modal Functions
        function showImageModal(imageId) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            modalImage.src = `/image/${imageId}`;
            modal.style.display = 'flex';
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
        }

        // Copy color hex to clipboard
        function copyColorToClipboard(hexColor) {
            const colorWithHash = hexColor.startsWith('#') ? hexColor : `#${hexColor}`;
            navigator.clipboard.writeText(colorWithHash).then(() => {
                showSuccess('Color Copied!', `${colorWithHash} copied to clipboard`);
            }).catch(err => {
                console.error('Failed to copy color: ', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = colorWithHash;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showSuccess('Color Copied!', `${colorWithHash} copied to clipboard`);
            });
        }

        // Enhanced Details Modal Functions
        function showImageDetails(imageId) {
            const modal = document.getElementById('detailsModal');
            const modalContent = document.getElementById('imageDetailsContent');
            modalContent.innerHTML = '<p>Loading image details...</p>';
            modal.style.display = 'block';

            // For now, show basic details since we don't have a detailed API endpoint
            // In a real implementation, you would fetch detailed metadata from the server
            modalContent.innerHTML = `
                <div class="image-preview">
                    <img src="/image/${imageId}" alt="Image ${imageId}" style="max-width: 100%; height: auto;">
                </div>
                
                <h3>Image Information</h3>
                <p><strong>Image ID:</strong> ${imageId}</p>
                <p><strong>File Path:</strong> ${getImagePathFromResults(imageId) || 'N/A'}</p>
                <p><strong>Distance Score:</strong> ${getDistanceFromResults(imageId) || 'N/A'}</p>
                <p><strong>Rank Position:</strong> ${getRankFromResults(imageId) || 'N/A'}</p>
                
                <h3>Color Analysis</h3>
                <p><strong>Dominant Colors:</strong></p>
                <div class="color-swatches">
                    ${getDominantColorsFromResults(imageId) || 'No dominant colors available'}
                </div>
                
                <h3>Technical Details</h3>
                <p><strong>File Type:</strong> Image file</p>
                <p><strong>Processing Status:</strong> Indexed and searchable</p>
                <p><strong>Search Relevance:</strong> ${getRelevanceLevel(getDistanceFromResults(imageId))}</p>
                
                <div class="action-buttons">
                    <button class="action-btn download-btn" onclick="downloadImage('${imageId}')">Download</button>
                    <button class="action-btn copy-btn" onclick="copyImageInfo('${imageId}')">Copy Info</button>
                    <button class="action-btn details-btn" onclick="showAdvancedDetails('${imageId}')">Advanced Details</button>
                </div>
            `;
        }

        // Helper functions to get data from search results
        function getImagePathFromResults(imageId) {
            const results = window.lastSearchResults || [];
            const result = results.find(r => r.image_id === imageId);
            return result ? result.file_path : null;
        }

        function getDistanceFromResults(imageId) {
            const results = window.lastSearchResults || [];
            const result = results.find(r => r.image_id === imageId);
            return result ? result.distance : null;
        }

        function getRankFromResults(imageId) {
            const results = window.lastSearchResults || [];
            const result = results.find(r => r.image_id === imageId);
            return result ? results.indexOf(result) + 1 : null;
        }

        function getDominantColorsFromResults(imageId) {
            const results = window.lastSearchResults || [];
            const result = results.find(r => r.image_id === imageId);
            if (result && result.dominant_colors) {
                return result.dominant_colors.map(color =>
                    `<div class="color-swatch" style="background-color: ${color}" title="${color}" onclick="copyColorToClipboard('${color}')"></div>`
                ).join('');
            }
            return null;
        }

        function downloadImage(imageId) {
            const link = document.createElement('a');
            link.href = `/image/${imageId}`;
            link.download = `image_${imageId}.jpg`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function copyImageInfo(imageId) {
            const results = window.lastSearchResults || [];
            const result = results.find(r => r.image_id === imageId);
            if (result) {
                const rank = results.indexOf(result) + 1;
                const info = `Image Details:
Image ID: ${result.image_id}
Rank Position: #${rank}
Distance Score: ${result.distance ? result.distance.toFixed(4) : 'N/A'}
File Path: ${result.file_path || 'N/A'}
Dominant Colors: ${result.dominant_colors ? result.dominant_colors.join(', ') : 'None detected'}
Search Relevance: ${getRelevanceLevel(result.distance)}
Timestamp: ${new Date().toLocaleString()}`;

                navigator.clipboard.writeText(info).then(() => {
                    showSuccess('Info Copied!', 'Comprehensive image information copied to clipboard');
                }).catch(err => {
                    console.error('Failed to copy image info: ', err);
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = info;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showSuccess('Info Copied!', 'Comprehensive image information copied to clipboard');
                });
            }
        }

        // Helper function to determine relevance level based on distance
        function getRelevanceLevel(distance) {
            if (distance === null || distance === undefined) return 'Unknown';
            if (distance < 0.1) return 'Excellent Match';
            if (distance < 0.3) return 'Very Good Match';
            if (distance < 0.5) return 'Good Match';
            if (distance < 0.7) return 'Fair Match';
            if (distance < 1.0) return 'Poor Match';
            return 'Very Poor Match';
        }

        function showAdvancedDetails(imageId) {
            const results = window.lastSearchResults || [];
            const result = results.find(r => r.image_id === imageId);

            if (!result) {
                showSuccess('Advanced Details', 'No image data available for advanced analysis.');
                return;
            }

            try {
                // Calculate distance range safely
                const distances = results.map(r => r.distance).filter(d => d !== null && d !== undefined);
                const minDistance = distances.length > 0 ? Math.min(...distances) : 0;
                const maxDistance = distances.length > 0 ? Math.max(...distances) : 0;

                // Create a comprehensive advanced details view
                const advancedInfo = `
                    <div class="advanced-details">
                        <h3>🔬 Advanced Image Analysis</h3>
                        
                        <div class="analysis-section">
                            <h4>📊 Search Performance Metrics</h4>
                            <ul>
                                <li><strong>Distance Score:</strong> ${result.distance ? result.distance.toFixed(6) : 'N/A'}</li>
                                <li><strong>Relevance Level:</strong> ${getRelevanceLevel(result.distance)}</li>
                                <li><strong>Rank Position:</strong> #${results.indexOf(result) + 1} of ${results.length}</li>
                                <li><strong>Percentile Rank:</strong> ${((results.indexOf(result) + 1) / results.length * 100).toFixed(1)}%</li>
                            </ul>
                        </div>

                        <div class="analysis-section">
                            <h4>🎨 Color Analysis Details</h4>
                            <ul>
                                <li><strong>Dominant Colors Count:</strong> ${result.dominant_colors ? result.dominant_colors.length : 0}</li>
                                <li><strong>Color Palette:</strong> ${result.dominant_colors ? result.dominant_colors.join(', ') : 'None detected'}</li>
                                <li><strong>Color Diversity:</strong> ${getColorDiversity(result.dominant_colors)}</li>
                            </ul>
                        </div>

                        <div class="analysis-section">
                            <h4>📁 File Information</h4>
                            <ul>
                                <li><strong>File Path:</strong> ${result.file_path || 'N/A'}</li>
                                <li><strong>File Extension:</strong> ${getFileExtension(result.file_path)}</li>
                                <li><strong>Processing Status:</strong> Indexed and searchable</li>
                                <li><strong>Index Location:</strong> FAISS HNSW Index</li>
                            </ul>
                        </div>

                        <div class="analysis-section">
                            <h4>🔍 Search Context</h4>
                            <ul>
                                <li><strong>Search Timestamp:</strong> ${new Date().toLocaleString()}</li>
                                <li><strong>Total Results:</strong> ${results.length}</li>
                                <li><strong>Distance Range:</strong> ${minDistance.toFixed(4)} - ${maxDistance.toFixed(4)}</li>
                                <li><strong>Algorithm Used:</strong> Sinkhorn-EMD with FAISS HNSW</li>
                            </ul>
                        </div>

                        <div class="action-buttons">
                            <button class="action-btn download-btn" onclick="downloadImage('${imageId}')">Download Image</button>
                            <button class="action-btn copy-btn" onclick="copyAdvancedInfo('${imageId}')">Copy Advanced Info</button>
                            <button class="action-btn details-btn" onclick="exportAnalysisReport('${imageId}')">Export Report</button>
                        </div>
                    </div>
                `;

                // Show the advanced details in a new modal or replace the current content
                const modalContent = document.getElementById('imageDetailsContent');
                modalContent.innerHTML = advancedInfo;
            } catch (error) {
                console.error('Error generating advanced details:', error);
                const modalContent = document.getElementById('imageDetailsContent');
                modalContent.innerHTML = `
                    <div class="error">
                        <h3>❌ Error Generating Advanced Details</h3>
                        <p>An error occurred while generating the advanced analysis. Please try again.</p>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Helper function to get color diversity assessment
        function getColorDiversity(colors) {
            if (!colors || colors.length === 0) return 'No colors detected';
            if (colors.length === 1) return 'Monochromatic';
            if (colors.length === 2) return 'Dichromatic';
            if (colors.length === 3) return 'Tricolor';
            if (colors.length <= 5) return 'Multicolor';
            return 'Highly diverse palette';
        }

        // Helper function to get file extension
        function getFileExtension(filePath) {
            if (!filePath) return 'Unknown';
            const parts = filePath.split('.');
            return parts.length > 1 ? parts[parts.length - 1].toUpperCase() : 'Unknown';
        }

        // Function to copy advanced information
        function copyAdvancedInfo(imageId) {
            const results = window.lastSearchResults || [];
            const result = results.find(r => r.image_id === imageId);

            if (result) {
                const advancedInfo = `ADVANCED IMAGE ANALYSIS REPORT
=====================================
Image ID: ${result.image_id}
Rank Position: #${results.indexOf(result) + 1} of ${results.length}
Distance Score: ${result.distance ? result.distance.toFixed(6) : 'N/A'}
Relevance Level: ${getRelevanceLevel(result.distance)}
File Path: ${result.file_path || 'N/A'}
Dominant Colors: ${result.dominant_colors ? result.dominant_colors.join(', ') : 'None detected'}
Color Diversity: ${getColorDiversity(result.dominant_colors)}
File Extension: ${getFileExtension(result.file_path)}
Search Algorithm: Sinkhorn-EMD with FAISS HNSW
Analysis Timestamp: ${new Date().toLocaleString()}
=====================================`;

                navigator.clipboard.writeText(advancedInfo).then(() => {
                    showSuccess('Advanced Info Copied!', 'Comprehensive analysis report copied to clipboard');
                });
            }
        }

        // Function to export analysis report (placeholder for future implementation)
        function exportAnalysisReport(imageId) {
            showSuccess('Export Feature', 'This feature would generate and download a detailed PDF/JSON report of the image analysis. Coming soon!');
        }

        // Close modals when clicking outside
        document.addEventListener('click', (event) => {
            const imageModal = document.getElementById('imageModal');
            const detailsModal = document.getElementById('detailsModal');

            if (event.target == imageModal) {
                imageModal.style.display = 'none';
            }
            if (event.target == detailsModal) {
                detailsModal.style.display = 'none';
            }
        });

        // Close image modal with X button
        document.addEventListener('DOMContentLoaded', function () {
            const imageClose = document.querySelector('.image-close');
            if (imageClose) {
                imageClose.addEventListener('click', closeImageModal);
            }

            // Also add click event for the close button in case it's added dynamically
            document.addEventListener('click', function (e) {
                if (e.target.classList.contains('image-close')) {
                    closeImageModal();
                }
            });
        });

        // Quick Test Functions
        function quickTestColorPalette() {
            // Show results in the dedicated Quick Test results area
            const resultsContent = document.getElementById('quickTestResultsContent');

            resultsContent.innerHTML = '<div class="quick-test-loading">🎨 Running Color Palette Quick Test...</div>';

            // Execute the actual tool with quick test dataset
            executeQuickTest('color-palette', resultsContent);
        }

        function quickTestSearchResults() {
            // Show results in the dedicated Quick Test results area
            const resultsContent = document.getElementById('quickTestResultsContent');

            resultsContent.innerHTML = '<div class="quick-test-loading">📊 Running Search Results Quick Test...</div>';

            // Execute the actual tool with quick test dataset
            executeQuickTest('search-results', resultsContent);
        }

        function quickTestColorExplorer() {
            // Show results in the dedicated Quick Test results area
            const resultsContent = document.getElementById('quickTestResultsContent');

            resultsContent.innerHTML = '<div class="quick-test-loading">🔍 Running Color Explorer Quick Test...</div>';

            // Execute the actual tool with quick test dataset
            executeQuickTest('color-explorer', resultsContent);
        }

        function quickTestHistogramAnalysis() {
            // Show results in the dedicated Quick Test results area
            const resultsContent = document.getElementById('quickTestResultsContent');

            resultsContent.innerHTML = '<div class="quick-test-loading">📈 Running Histogram Analysis Quick Test...</div>';

            // Execute the actual tool with quick test dataset
            executeQuickTest('histogram-analysis', resultsContent);
        }

        function quickTestQueryVisualizer() {
            // Show results in the dedicated Quick Test results area
            const resultsContent = document.getElementById('quickTestResultsContent');

            resultsContent.innerHTML = '<div class="quick-test-loading">🎭 Running Query Visualizer Quick Test...</div>';

            // Execute the actual tool with quick test dataset
            executeQuickTest('query-visualizer', resultsContent);
        }

        function quickTestDistanceDebugger() {
            // Show results in the dedicated Quick Test results area
            const resultsContent = document.getElementById('quickTestResultsContent');

            resultsContent.innerHTML = '<div class="quick-test-loading">🎯 Running Distance Debugger Quick Test...</div>';

            // Execute the actual tool with quick test dataset
            executeQuickTest('distance-debugger', resultsContent);
        }

        // Tool Panel Functions
        function toggleToolPanel(panelId) {
            const panel = document.getElementById(panelId);
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }

        // Execute Quick Test with actual tool execution
        function executeQuickTest(toolType, resultsContent) {
            // Tool configuration for each type
            const toolConfigs = {
                'color-palette': {
                    command: 'python',
                    args: ['tools/visualize_color_palettes.py', '--image', 'datasets/test-dataset-20/a1.png'],
                    dataset: 'datasets/quick-test/color-palette/',
                    description: 'Color palette analysis with sample image'
                },
                'search-results': {
                    command: 'python',
                    args: ['tools/visualize_search_results.py', '--results', 'datasets/quick-test/search-results/sample-query-1.json'],
                    dataset: 'datasets/quick-test/search-results/',
                    description: 'Search results analysis with sample dataset'
                },
                'color-explorer': {
                    command: 'python',
                    args: ['tools/color_explorer.py'],
                    dataset: 'datasets/quick-test/color-explorer/',
                    description: 'Interactive color exploration tool'
                },
                'histogram-analysis': {
                    command: 'python',
                    args: ['tools/test_histogram_generation.py', '--directory', 'datasets/test-dataset-20'],
                    dataset: 'datasets/quick-test/histogram-analysis/',
                    description: 'Histogram generation testing and visualization'
                },
                'distance-debugger': {
                    command: 'python',
                    args: ['tools/debug_distances.py'],
                    dataset: 'datasets/quick-test/distance-debugger/',
                    description: 'Distance calculation debugging and analysis'
                },
                'query-visualizer': {
                    command: 'python',
                    args: ['tools/demo_visualization.py'],
                    dataset: 'datasets/quick-test/query-visualizer/',
                    description: 'Query visualization generation and demo'
                }
            };

            const config = toolConfigs[toolType];
            if (!config) {
                resultsContent.innerHTML = '<div class="error">❌ Unknown tool type: ' + toolType + '</div>';
                return;
            }

            // Execute the actual command via API call
            executeQuickTestCommand(toolType, config, resultsContent);
        }

        // Execute Quick Test command via API
        function executeQuickTestCommand(toolType, config, resultsContent) {
            const fullCommand = `${config.command} ${config.args.join(' ')}`;

            // Show the command being executed
            resultsContent.innerHTML = `
                <div class="quick-test-results">
                    <h4>🔬 ${config.description} - Quick Test Execution</h4>
                    <div class="quick-test-command">
                        <strong>Executing:</strong> ${fullCommand}
                    </div>
                    <div class="quick-test-loading">
                        🚀 Running command... Please wait...
                    </div>
                </div>
            `;

            // Make API call to execute the command
            fetch('/api/execute-command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    command: config.command,
                    args: config.args,
                    tool_type: toolType,
                    dataset: config.dataset
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayQuickTestResults(toolType, config, data.output, resultsContent);
                    } else {
                        resultsContent.innerHTML = `
                        <div class="quick-test-results">
                            <h4>🔬 ${config.description} - Quick Test Results</h4>
                            <div class="quick-test-command">
                                <strong>Command:</strong> ${fullCommand}
                            </div>
                            <div class="quick-test-error">
                                ❌ Command execution failed: ${data.error}
                            </div>
                            <div class="quick-test-output">
                                <pre>${data.output || 'No output available'}</pre>
                            </div>
                        </div>
                    `;
                    }
                })
                .catch(error => {
                    resultsContent.innerHTML = `
                    <div class="quick-test-results">
                        <h4>🔬 ${config.description} - Quick Test Results</h4>
                        <div class="quick-test-command">
                            <strong>Command:</strong> ${fullCommand}
                        </div>
                        <div class="quick-test-error">
                            ❌ Network error: ${error.message}
                        </div>
                        <div class="quick-test-output">
                            <pre>Error: ${error.message}</pre>
                        </div>
                    </div>
                `;
                });
        }

        // Display Quick Test results
        function displayQuickTestResults(toolType, config, output, resultsContent) {
            const fullCommand = `${config.command} ${config.args.join(' ')}`;

            resultsContent.innerHTML = `
                <div class="quick-test-results">
                    <h4>🔬 ${config.description} - Quick Test Results</h4>
                    <div class="quick-test-command">
                        <strong>Command:</strong> ${fullCommand}
                    </div>
                    <div class="quick-test-success">
                        ✅ Command executed successfully!
                    </div>
                    <div class="quick-test-output">
                        <h5>Command Output:</h5>
                        <pre>${output}</pre>
                    </div>
                    <div class="result-actions">
                        <button class="action-btn primary-btn" onclick="runFullTool('${toolType}')">Run Full Tool</button>
                        <button class="action-btn secondary-btn" onclick="clearQuickTestResults()">Clear Results</button>
                    </div>
                </div>
            `;
        }

        // Clear Quick Test results
        function clearQuickTestResults() {
            const resultsContent = document.getElementById('quickTestResultsContent');
            resultsContent.innerHTML = `
                <div class="quick-test-placeholder">
                    <p>🎯 Click any "Quick Test" button to see results here</p>
                    <p>Results will be displayed in this dedicated area and will execute actual commands</p>
                </div>
            `;
        }

        // Run full tool (placeholder for future implementation)
        function runFullTool(toolType) {
            showSuccess('Tool Launch', `Launching full ${toolType} tool...`);
            // This would open the tool panel and populate with the quick test parameters
        }

        // Generate actual quick test results based on tool type
        function generateQuickTestResults(toolType, config) {
            const baseResults = `
                <div class="analysis-results">
                    <div class="result-section">
                        <h4>🔬 ${config.description} - Quick Test Results</h4>
                        <p><strong>Dataset:</strong> ${config.dataset}</p>
                        <p><strong>Command:</strong> ${config.command} ${config.args.join(' ')}</p>
                        <p><strong>Execution Time:</strong> ${(Math.random() * 2 + 1).toFixed(2)} seconds</p>
                        
                        <h5>Generated Outputs:</h5>
                        <ul>
                            <li><strong>Tool Execution:</strong> Successfully completed with sample dataset</li>
                            <li><strong>Data Processing:</strong> Processed ${Math.floor(Math.random() * 10) + 5} data points</li>
                            <li><strong>Output Generation:</strong> Created ${Math.floor(Math.random() * 3) + 2} output files</li>
                            <li><strong>Validation:</strong> All checks passed successfully</li>
                        </ul>
                        
                        <h5>Sample Dataset Contents:</h5>
                        <ul>
                            <li><strong>Dataset Location:</strong> ${config.dataset}</li>
                            <li><strong>Data Type:</strong> ${getDatasetType(toolType)}</li>
                            <li><strong>Sample Count:</strong> ${getSampleCount(toolType)}</li>
                            <li><strong>Expected Results:</strong> ${getExpectedResults(toolType)}</li>
                        </ul>
                    </div>
                    
                    <div class="result-actions">
                        <button class="action-btn primary-btn" onclick="run${getToolFunctionName(toolType)}()">Run Full Tool</button>
                        <button class="action-btn secondary-btn" onclick="document.getElementById('${getResultsId(toolType)}').style.display='none'">Close</button>
                    </div>
                </div>
            `;

            return baseResults;
        }

        // Helper functions for quick test results
        function getDatasetType(toolType) {
            const types = {
                'color-palette': 'Image files with known color characteristics',
                'search-results': 'JSON files with sample search queries and results',
                'color-explorer': 'JSON files with color harmonies and palette templates',
                'histogram-analysis': 'NumPy files with sample histogram data',
                'distance-debugger': 'JSON files with histogram pairs for testing',
                'query-visualizer': 'JSON files with sample color queries'
            };
            return types[toolType] || 'Sample data files';
        }

        function getSampleCount(toolType) {
            const counts = {
                'color-palette': '5 test images',
                'search-results': '5 sample queries',
                'color-explorer': '5 harmony types + 3 palette templates',
                'histogram-analysis': '5 histogram samples',
                'distance-debugger': '5 test pairs',
                'query-visualizer': '5 query types'
            };
            return counts[toolType] || 'Multiple samples';
        }

        function getExpectedResults(toolType) {
            const results = {
                'color-palette': 'Red-dominated, blue-dominated, and balanced color palettes',
                'search-results': '5 red-dominated search results with distances from 0.15 to 0.68',
                'color-explorer': '5 harmony types with 15+ color combinations',
                'histogram-analysis': '5 different histogram types for validation',
                'distance-debugger': 'Numerical stability analysis with fallback behavior',
                'query-visualizer': 'Multiple visualization styles with different layouts'
            };
            return results[toolType] || 'Tool-specific analysis results';
        }

        function getToolFunctionName(toolType) {
            const names = {
                'color-palette': 'ColorPaletteTool',
                'search-results': 'SearchResultsTool',
                'color-explorer': 'ColorExplorer',
                'histogram-analysis': 'HistogramAnalysis',
                'distance-debugger': 'DistanceDebugger',
                'query-visualizer': 'QueryVisualizer'
            };
            return names[toolType] || 'Tool';
        }

        function getResultsId(toolType) {
            const ids = {
                'color-palette': 'colorPaletteResults',
                'search-results': 'searchResultsResults',
                'color-explorer': 'colorExplorerResults',
                'histogram-analysis': 'histogramAnalysisResults',
                'distance-debugger': 'distanceDebuggerResults',
                'query-visualizer': 'queryVisualizerResults'
            };
            return ids[toolType] || 'results';
        }

        function runColorPaletteTool() {
            toggleToolPanel('colorPalettePanel');
        }

        function runSearchResultsTool() {
            toggleToolPanel('searchResultsPanel');
        }

        function runColorExplorer() {
            toggleToolPanel('colorExplorerPanel');
        }

        function runHistogramAnalysis() {
            toggleToolPanel('histogramAnalysisPanel');
        }

        function runDistanceDebugger() {
            toggleToolPanel('distanceDebuggerPanel');
        }

        function runQueryVisualizer() {
            toggleToolPanel('queryVisualizerPanel');
        }

        // Color Palette Analysis Functions
        function executeColorPaletteAnalysis() {
            const imageFile = document.getElementById('colorPaletteImage').files[0];
            const directory = document.getElementById('colorPaletteDirectory').value;
            const numColors = document.getElementById('colorPaletteNumColors').value;
            const colorSpace = document.getElementById('colorPaletteColorSpace').value;
            const clustering = document.getElementById('colorPaletteClustering').value;
            const outputFormat = document.getElementById('colorPaletteOutputFormat').value;
            const resolution = document.getElementById('colorPaletteResolution').value;

            // Show loading state
            const resultsArea = document.getElementById('colorPaletteResults');
            const resultsContent = document.getElementById('colorPaletteResultsContent');

            resultsArea.style.display = 'block';
            resultsContent.innerHTML = '<div class="loading">🔄 Running Color Palette Analysis...</div>';

            // Simulate tool execution (replace with actual API call)
            setTimeout(() => {
                const mockResults = generateMockColorPaletteResults();
                resultsContent.innerHTML = mockResults;
            }, 2000);
        }

        function generateMockColorPaletteResults() {
            // Get actual form values
            const imageFile = document.getElementById('colorPaletteImage').files[0];
            const directory = document.getElementById('colorPaletteDirectory').value;
            const numColors = document.getElementById('colorPaletteNumColors').value;
            const colorSpace = document.getElementById('colorPaletteColorSpace').value;
            const clustering = document.getElementById('colorPaletteClustering').value;
            const outputFormat = document.getElementById('colorPaletteOutputFormat').value;
            const resolution = document.getElementById('colorPaletteResolution').value;

            // Generate color swatches based on actual number of colors
            let colorSwatches = '';
            const sampleColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFE66D', '#FF8E8E', '#A8E6CF', '#DCEDC8', '#FFD3B6', '#FFAAA5'];
            const sampleNames = ['Red', 'Teal', 'Blue', 'Green', 'Yellow', 'Coral', 'Mint', 'Sage', 'Peach', 'Salmon'];

            for (let i = 0; i < Math.min(numColors, 10); i++) {
                const percentage = Math.round((100 / numColors) * (i + 1));
                colorSwatches += `<div class="color-swatch" style="background: ${sampleColors[i]}; color: white;">${sampleColors[i]}<br><small>${sampleNames[i]} (${percentage}%)</small></div>`;
            }

            // Generate analysis based on actual settings
            const source = imageFile ? `Uploaded image: ${imageFile.name}` : (directory ? `Directory: ${directory}` : 'Sample dataset');
            const processingTime = (0.5 + (numColors * 0.1)).toFixed(1);

            return `
                <div class="analysis-results">
                    <div class="result-section">
                        <h4>🎨 Dominant Colors Extracted</h4>
                        <p><strong>Source:</strong> ${source}</p>
                        <div class="color-swatches">${colorSwatches}</div>
                    </div>
                    
                    <div class="result-section">
                        <h4>📊 Analysis Summary</h4>
                        <ul>
                            <li><strong>Total Colors:</strong> ${numColors} dominant colors extracted</li>
                            <li><strong>Color Space:</strong> ${colorSpace.toUpperCase()} (${colorSpace === 'lab' ? 'D65 illuminant' : 'Standard'})</li>
                            <li><strong>Clustering Method:</strong> ${clustering.charAt(0).toUpperCase() + clustering.slice(1)} (k=${numColors})</li>
                            <li><strong>Processing Time:</strong> ${processingTime} seconds</li>
                            <li><strong>Output Format:</strong> ${outputFormat.toUpperCase()}</li>
                            <li><strong>Resolution:</strong> ${resolution.charAt(0).toUpperCase() + resolution.slice(1)}</li>
                        </ul>
                    </div>
                    
                    <div class="result-section">
                        <h4>📈 Distribution Analysis</h4>
                        <p>Color distribution analysis completed using ${clustering} clustering in ${colorSpace.toUpperCase()} color space. Extracted ${numColors} dominant colors with balanced representation across the color spectrum.</p>
                    </div>
                    
                    <div class="result-actions">
                        <button class="action-btn primary-btn" onclick="downloadColorPaletteResults()">Download Results</button>
                        <button class="action-btn secondary-btn" onclick="exportColorPaletteData()">Export Data</button>
                    </div>
                </div>
            `;
        }

        function resetColorPaletteForm() {
            document.getElementById('colorPaletteImage').value = '';
            document.getElementById('colorPaletteDirectory').value = '';
            document.getElementById('colorPaletteNumColors').value = '5';
            document.getElementById('colorPaletteColorSpace').value = 'lab';
            document.getElementById('colorPaletteClustering').value = 'kmeans';
            document.getElementById('colorPaletteOutputFormat').value = 'png';
            document.getElementById('colorPaletteResolution').value = 'medium';

            // Reset checkboxes
            document.getElementById('colorPaletteStats').checked = true;
            document.getElementById('colorPaletteCharts').checked = true;
            document.getElementById('colorPaletteComparison').checked = true;
            document.getElementById('colorPaletteExport').checked = true;

            // Hide results
            document.getElementById('colorPaletteResults').style.display = 'none';
        }

        function showColorPaletteHelp() {
            showSuccess('🎨 Color Palette Analyzer Help',
                'This tool analyzes images to extract dominant color palettes.\n\n' +
                '• <strong>Image Input:</strong> Upload a single image or specify a directory\n' +
                '• <strong>Analysis Parameters:</strong> Configure color extraction settings\n' +
                '• <strong>Output Options:</strong> Choose format and resolution\n' +
                '• <strong>Results:</strong> View extracted colors, statistics, and visualizations\n\n' +
                'For best results, use high-quality images and L*a*b* color space.'
            );
        }

        function browseDirectory(inputId) {
            // This would typically open a directory picker
            // For now, show a message
            showSuccess('📁 Directory Browser', 'Directory browser functionality would be implemented here. For now, manually enter the path to your image directory.');
        }

        function downloadColorPaletteResults() {
            showSuccess('📥 Download', 'Download functionality would save the analysis results as a PNG image or PDF report.');
        }

        function exportColorPaletteData() {
            showSuccess('📊 Export', 'Export functionality would save the color data as JSON or CSV for further analysis.');
        }

        // Search Results Analysis Functions
        function executeSearchResultsAnalysis() {
            const query = document.getElementById('searchResultsQuery').value;
            const weights = document.getElementById('searchResultsWeights').value;
            const k = document.getElementById('searchResultsK').value;
            const analysisType = document.getElementById('searchResultsAnalysisType').value;
            const visualization = document.getElementById('searchResultsVisualization').value;
            const outputFormat = document.getElementById('searchResultsOutputFormat').value;
            const resolution = document.getElementById('searchResultsResolution').value;

            // Show loading state
            const resultsArea = document.getElementById('searchResultsResults');
            const resultsContent = document.getElementById('searchResultsResultsContent');

            resultsArea.style.display = 'block';
            resultsContent.innerHTML = '<div class="loading">🔄 Running Search Results Analysis...</div>';

            // Simulate tool execution (replace with actual API call)
            setTimeout(() => {
                const mockResults = generateMockSearchResultsResults();
                resultsContent.innerHTML = mockResults;
            }, 2000);
        }

        function generateMockSearchResultsResults() {
            // Get actual form values
            const query = document.getElementById('searchResultsQuery').value || 'FF0000,00FF00';
            const weights = document.getElementById('searchResultsWeights').value || '0.7,0.3';
            const k = document.getElementById('searchResultsK').value || '10';
            const analysisType = document.getElementById('searchResultsAnalysisType').value;
            const visualization = document.getElementById('searchResultsVisualization').value;
            const outputFormat = document.getElementById('searchResultsOutputFormat').value;
            const resolution = document.getElementById('searchResultsResolution').value;

            // Parse colors and weights for display
            const colors = query.split(',').map(c => c.trim());
            const weightValues = weights ? weights.split(',').map(w => parseFloat(w.trim())) : [1.0];

            // Generate color swatches based on actual query
            let colorSwatches = '';
            colors.forEach((color, index) => {
                const weight = weightValues[index] || 1.0;
                const percentage = Math.round(weight * 100);
                colorSwatches += `<div class="color-swatch" style="background: #${color}; color: white;">#${color}<br><small>${percentage}%</small></div>`;
            });

            // Generate analysis based on selected type
            let analysisContent = '';
            switch (analysisType) {
                case 'ranking':
                    analysisContent = `
                        <h4>🏆 Ranking Analysis</h4>
                        <p>Top ${k} results analyzed with ${visualization} visualization. Results show color similarity patterns based on your query: ${query}.</p>
                        <div class="color-swatches">${colorSwatches}</div>
                    `;
                    break;
                case 'distance':
                    analysisContent = `
                        <h4>📏 Distance Distribution</h4>
                        <p>Distance analysis for ${k} results using ${visualization} style. Query colors: ${query} with weights: ${weights}.</p>
                        <div class="color-swatches">${colorSwatches}</div>
                    `;
                    break;
                case 'similarity':
                    analysisContent = `
                        <h4>🎨 Color Similarity Mapping</h4>
                        <p>Similarity analysis for ${k} results with ${visualization} visualization. Focus on color relationships in query: ${query}.</p>
                        <div class="color-swatches">${colorSwatches}</div>
                    `;
                    break;
                case 'performance':
                    analysisContent = `
                        <h4>⚡ Performance Metrics</h4>
                        <p>Performance analysis for ${k} results. Query: ${query}, Output: ${outputFormat} at ${resolution} resolution.</p>
                        <div class="color-swatches">${colorSwatches}</div>
                    `;
                    break;
                case 'comprehensive':
                    analysisContent = `
                        <h4>🔍 Comprehensive Analysis</h4>
                        <p>Full analysis of ${k} results using ${visualization} style. Query: ${query}, Weights: ${weights}, Format: ${outputFormat}.</p>
                        <div class="color-swatches">${colorSwatches}</div>
                    `;
                    break;
                default:
                    analysisContent = `
                        <h4>📊 Analysis Results</h4>
                        <p>Analysis completed for ${k} results. Query: ${query}.</p>
                        <div class="color-swatches">${colorSwatches}</div>
                    `;
            }

            // Generate timing based on K value
            const baseTime = 0.5; // base time in seconds
            const timePerResult = 0.1; // additional time per result
            const totalTime = (baseTime + (parseInt(k) * timePerResult)).toFixed(1);

            return `
                <div class="analysis-results">
                    <div class="result-section">
                        <h4>📊 Search Results Analysis</h4>
                        <ul>
                            <li><strong>Query:</strong> ${query}</li>
                            <li><strong>Weights:</strong> ${weights || 'Equal (1.0)'}</li>
                            <li><strong>Results Count:</strong> ${k} images analyzed</li>
                            <li><strong>Analysis Type:</strong> ${analysisType}</li>
                            <li><strong>Visualization:</strong> ${visualization}</li>
                            <li><strong>Output Format:</strong> ${outputFormat}</li>
                            <li><strong>Resolution:</strong> ${resolution}</li>
                            <li><strong>Processing Time:</strong> ${totalTime} seconds</li>
                        </ul>
                    </div>
                    
                    <div class="result-section">
                        ${analysisContent}
                    </div>
                    
                    <div class="result-section">
                        <h4>📈 Performance Metrics</h4>
                        <ul>
                            <li><strong>ANN Search Time:</strong> ${Math.round(totalTime * 0.6 * 1000)}ms</li>
                            <li><strong>Reranking Time:</strong> ${Math.round(totalTime * 0.3 * 1000)}ms</li>
                            <li><strong>Analysis Time:</strong> ${Math.round(totalTime * 0.1 * 1000)}ms</li>
                            <li><strong>Total Time:</strong> ${Math.round(totalTime * 1000)}ms</li>
                            <li><strong>Results Processed:</strong> ${k}</li>
                            <li><strong>Output Format:</strong> ${outputFormat.toUpperCase()}</li>
                        </ul>
                    </div>
                    
                    <div class="result-actions">
                        <button class="action-btn primary-btn" onclick="downloadSearchResults()">Download Report</button>
                        <button class="action-btn secondary-btn" onclick="exportSearchResultsData()">Export Data</button>
                    </div>
                </div>
            `;
        }

        function resetSearchResultsForm() {
            document.getElementById('searchResultsQuery').value = '';
            document.getElementById('searchResultsWeights').value = '';
            document.getElementById('searchResultsK').value = '10';
            document.getElementById('searchResultsAnalysisType').value = 'ranking';
            document.getElementById('searchResultsVisualization').value = 'charts';
            document.getElementById('searchResultsOutputFormat').value = 'png';
            document.getElementById('searchResultsResolution').value = 'medium';

            // Reset checkboxes
            document.getElementById('searchResultsMetadata').checked = true;
            document.getElementById('searchResultsTiming').checked = true;
            document.getElementById('searchResultsIndex').checked = true;
            document.getElementById('searchResultsExport').checked = true;

            // Hide results
            document.getElementById('searchResultsResults').style.display = 'none';
        }

        function showSearchResultsHelp() {
            showSuccess('📊 Search Results Analyzer Help',
                'This tool analyzes and visualizes search results from the Chromatica API.\n\n' +
                '• <strong>Search Query:</strong> Enter hex colors and optional weights\n' +
                '• <strong>Analysis Options:</strong> Choose analysis type and visualization style\n' +
                '• <strong>Output Configuration:</strong> Select format and resolution\n' +
                '• <strong>Results:</strong> View rankings, distances, and performance metrics\n\n' +
                'For best results, use the same query format as the main search interface.'
            );
        }

        function downloadSearchResults() {
            showSuccess('📥 Download', 'Download functionality would save the analysis report as a PNG image or PDF document.');
        }

        function exportSearchResultsData() {
            showSuccess('📊 Export', 'Export functionality would save the analysis data as JSON or CSV for further processing.');
        }

        // Interactive Color Explorer Functions
        function executeColorExplorer() {
            const baseColor = document.getElementById('colorExplorerBaseColor').value;
            const colorCount = document.getElementById('colorExplorerColorCount').value;
            const colorSpace = document.getElementById('colorExplorerColorSpace').value;
            const harmonyType = document.getElementById('colorExplorerHarmonyType').value;
            const saturation = document.getElementById('colorExplorerSaturation').value;
            const brightness = document.getElementById('colorExplorerBrightness').value;
            const outputFormat = document.getElementById('colorExplorerOutputFormat').value;

            // Show loading state
            const resultsArea = document.getElementById('colorExplorerResults');
            const resultsContent = document.getElementById('colorExplorerResultsContent');

            resultsArea.style.display = 'block';
            resultsContent.innerHTML = '<div class="loading">🔄 Running Color Explorer...</div>';

            // Simulate tool execution (replace with actual API call)
            setTimeout(() => {
                const mockResults = generateMockColorExplorerResults();
                resultsContent.innerHTML = mockResults;
            }, 2000);
        }

        function generateMockColorExplorerResults() {
            // Get actual form values
            const baseColor = document.getElementById('colorExplorerBaseColor').value;
            const colorCount = document.getElementById('colorExplorerColorCount').value;
            const colorSpace = document.getElementById('colorExplorerColorSpace').value;
            const harmonyType = document.getElementById('colorExplorerHarmonyType').value;
            const saturation = document.getElementById('colorExplorerSaturation').value;
            const brightness = document.getElementById('colorExplorerBrightness').value;
            const outputFormat = document.getElementById('colorExplorerOutputFormat').value;

            // Generate harmony colors based on actual settings
            let harmonyColors = [];
            let harmonyDescription = '';

            switch (harmonyType) {
                case 'complementary':
                    harmonyColors = [baseColor, getComplementaryColor(baseColor)];
                    harmonyDescription = `Complementary harmony: ${baseColor} and its opposite color`;
                    break;
                case 'analogous':
                    harmonyColors = generateAnalogousColors(baseColor, parseInt(colorCount));
                    harmonyDescription = `Analogous harmony: ${colorCount} colors adjacent on the color wheel`;
                    break;
                case 'triadic':
                    harmonyColors = generateTriadicColors(baseColor);
                    harmonyDescription = `Triadic harmony: three colors equally spaced on the color wheel`;
                    break;
                case 'split_complementary':
                    harmonyColors = generateSplitComplementaryColors(baseColor);
                    harmonyDescription = `Split complementary: ${baseColor} with two colors adjacent to its complement`;
                    break;
                case 'tetradic':
                    harmonyColors = generateTetradicColors(baseColor);
                    harmonyDescription = `Tetradic harmony: four colors forming a rectangle on the color wheel`;
                    break;
                case 'monochromatic':
                    harmonyColors = generateMonochromaticColors(baseColor, parseInt(colorCount));
                    harmonyDescription = `Monochromatic harmony: ${colorCount} variations of ${baseColor}`;
                    break;
                default:
                    harmonyColors = [baseColor];
                    harmonyDescription = `Single color exploration`;
            }

            // Generate color swatches
            let colorSwatches = '';
            harmonyColors.forEach((color, index) => {
                colorSwatches += `<div class="color-swatch" style="background: ${color}; color: white;">${color}<br><small>Color ${index + 1}</small></div>`;
            });

            // Generate analysis based on settings
            const processingTime = (0.3 + (parseInt(colorCount) * 0.1)).toFixed(1);

            return `
                <div class="analysis-results">
                    <div class="result-section">
                        <h4>🎨 Color Harmony Generated</h4>
                        <ul>
                            <li><strong>Base Color:</strong> ${baseColor}</li>
                            <li><strong>Harmony Type:</strong> ${harmonyType.charAt(0).toUpperCase() + harmonyType.slice(1)}</li>
                            <li><strong>Color Count:</strong> ${harmonyColors.length} colors</li>
                            <li><strong>Color Space:</strong> ${colorSpace.toUpperCase()}</li>
                            <li><strong>Saturation:</strong> ${saturation.charAt(0).toUpperCase() + saturation.slice(1)}</li>
                            <li><strong>Brightness:</strong> ${brightness.charAt(0).toUpperCase() + brightness.slice(1)}</li>
                            <li><strong>Output Format:</strong> ${outputFormat.toUpperCase()}</li>
                            <li><strong>Processing Time:</strong> ${processingTime} seconds</li>
                        </ul>
                    </div>
                    
                    <div class="result-section">
                        <h4>🔍 Harmony Analysis</h4>
                        <p>${harmonyDescription}</p>
                        <div class="color-swatches">${colorSwatches}</div>
                    </div>
                    
                    <div class="result-section">
                        <h4>⚙️ Technical Details</h4>
                        <ul>
                            <li><strong>Color Space:</strong> ${colorSpace.toUpperCase()} color space used for calculations</li>
                            <li><strong>Harmony Algorithm:</strong> ${harmonyType} harmony generation algorithm</li>
                            <li><strong>Color Variations:</strong> Generated ${harmonyColors.length} harmonious colors</li>
                            <li><strong>Export Format:</strong> Ready for ${outputFormat.toUpperCase()} export</li>
                        </ul>
                    </div>
                    
                    <div class="result-actions">
                        <button class="action-btn primary-btn" onclick="downloadColorExplorerResults()">Download Palette</button>
                        <button class="action-btn secondary-btn" onclick="exportColorExplorerData()">Export Data</button>
                    </div>
                </div>
            `;
        }

        // Color generation helper functions
        function getComplementaryColor(hexColor) {
            // Simple complementary color calculation
            const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF'];
            const complementary = {
                '#FF0000': '#00FFFF', '#00FF00': '#FF00FF', '#0000FF': '#FFFF00',
                '#FFFF00': '#0000FF', '#FF00FF': '#00FF00', '#00FFFF': '#FF0000'
            };
            return complementary[hexColor] || '#000000';
        }

        function generateAnalogousColors(baseColor, count) {
            const colors = [baseColor];
            for (let i = 1; i < count; i++) {
                colors.push(`#${Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0')}`);
            }
            return colors;
        }

        function generateTriadicColors(baseColor) {
            return [baseColor, '#00FF00', '#0000FF'];
        }

        function generateSplitComplementaryColors(baseColor) {
            return [baseColor, '#00FF00', '#0000FF'];
        }

        function generateTetradicColors(baseColor) {
            return [baseColor, '#00FF00', '#0000FF', '#FFFF00'];
        }

        function generateMonochromaticColors(baseColor, count) {
            const colors = [baseColor];
            for (let i = 1; i < count; i++) {
                colors.push(`#${Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0')}`);
            }
            return colors;
        }

        function resetColorExplorerForm() {
            document.getElementById('colorExplorerBaseColor').value = '#FF0000';
            document.getElementById('colorExplorerColorCount').value = '5';
            document.getElementById('colorExplorerColorSpace').value = 'hsv';
            document.getElementById('colorExplorerHarmonyType').value = 'complementary';
            document.getElementById('colorExplorerSaturation').value = 'medium';
            document.getElementById('colorExplorerBrightness').value = 'medium';
            document.getElementById('colorExplorerOutputFormat').value = 'png';

            // Reset checkboxes
            document.getElementById('colorExplorerLiveSearch').checked = true;
            document.getElementById('colorExplorerPaletteSearch').checked = true;
            document.getElementById('colorExplorerExportPalette').checked = true;
            document.getElementById('colorExplorerSaveSchemes').checked = true;

            // Hide results
            document.getElementById('colorExplorerResults').style.display = 'none';
        }

        function showColorExplorerHelp() {
            showSuccess('🔍 Interactive Color Explorer Help',
                'This tool explores color harmonies and generates palettes.\n\n' +
                '• <strong>Color Input:</strong> Select base color and specify color count\n' +
                '• <strong>Harmony Analysis:</strong> Choose harmony type and color properties\n' +
                '• <strong>Integration Options:</strong> Configure API integration and export\n' +
                '• <strong>Results:</strong> View generated harmonies and color palettes\n\n' +
                'For best results, use HSV color space and experiment with different harmony types.'
            );
        }

        function downloadColorExplorerResults() {
            showSuccess('📥 Download', 'Download functionality would save the generated color palette as a PNG image or SVG vector.');
        }

        function exportColorExplorerData() {
            showSuccess('📊 Export', 'Export functionality would save the color harmony data as JSON or CSS variables.');
        }

        // Histogram Analysis Functions
        function executeHistogramAnalysis() {
            const inputSource = document.getElementById('histogramAnalysisInput').value;
            const path = document.getElementById('histogramAnalysisPath').value;
            const maxFiles = document.getElementById('histogramAnalysisMaxFiles').value;
            const validation = document.getElementById('histogramAnalysisValidation').value;
            const outputFormat = document.getElementById('histogramAnalysisOutputFormat').value;
            const resolution = document.getElementById('histogramAnalysisResolution').value;

            // Show loading state
            const resultsArea = document.getElementById('histogramAnalysisResults');
            const resultsContent = document.getElementById('histogramAnalysisResultsContent');

            resultsArea.style.display = 'block';
            resultsContent.innerHTML = '<div class="loading">🔄 Running Histogram Analysis...</div>';

            // Simulate tool execution (replace with actual API call)
            setTimeout(() => {
                const mockResults = generateMockHistogramAnalysisResults();
                resultsContent.innerHTML = mockResults;
            }, 2500);
        }

        function generateMockHistogramAnalysisResults() {
            // Get actual form values
            const inputSource = document.getElementById('histogramAnalysisInput').value;
            const path = document.getElementById('histogramAnalysisPath').value || 'datasets/test-dataset-20';
            const maxFiles = document.getElementById('histogramAnalysisMaxFiles').value;
            const validation = document.getElementById('histogramAnalysisValidation').value;
            const outputFormat = document.getElementById('histogramAnalysisOutputFormat').value;
            const resolution = document.getElementById('histogramAnalysisResolution').value;

            // Get checkbox states
            const timing = document.getElementById('histogramAnalysisTiming').checked;
            const memory = document.getElementById('histogramAnalysisMemory').checked;
            const throughput = document.getElementById('histogramAnalysisThroughput').checked;
            const benchmarks = document.getElementById('histogramAnalysisBenchmarks').checked;
            const charts = document.getElementById('histogramAnalysisCharts').checked;
            const heatmaps = document.getElementById('histogramAnalysisHeatmaps').checked;
            const threeD = document.getElementById('histogramAnalysis3D').checked;
            const comparison = document.getElementById('histogramAnalysisComparison').checked;
            const rawData = document.getElementById('histogramAnalysisRawData').checked;
            const metadata = document.getElementById('histogramAnalysisMetadata').checked;
            const statistics = document.getElementById('histogramAnalysisStatistics').checked;
            const quality = document.getElementById('histogramAnalysisQuality').checked;

            // Generate analysis based on actual settings
            const processingTime = (0.8 + (parseInt(maxFiles) * 0.02)).toFixed(1);
            const successRate = Math.min(100, Math.max(95, 100 - (parseInt(maxFiles) * 0.1))).toFixed(1);
            const avgHistogramTime = (0.15 + (validation === 'expert' ? 0.1 : 0)).toFixed(2);

            // Generate validation results based on level
            let validationResults = '';
            switch (validation) {
                case 'basic':
                    validationResults = `
                        <h4>✅ Basic Validation Results</h4>
                        <ul>
                            <li><strong>Dimension Check:</strong> All histograms have 1,152 dimensions ✓</li>
                            <li><strong>Normalization:</strong> L1 normalization verified ✓</li>
                            <li><strong>Range Check:</strong> Values within [0, 1] bounds ✓</li>
                        </ul>
                    `;
                    break;
                case 'standard':
                    validationResults = `
                        <h4>✅ Standard Validation Results</h4>
                        <ul>
                            <li><strong>Dimension Check:</strong> All histograms have 1,152 dimensions ✓</li>
                            <li><strong>Normalization:</strong> L1 normalization verified ✓</li>
                            <li><strong>Range Check:</strong> Values within [0, 1] bounds ✓</li>
                            <li><strong>Consistency:</strong> Color space conversion verified ✓</li>
                            <li><strong>Quality:</strong> Histogram smoothness analysis ✓</li>
                        </ul>
                    `;
                    break;
                case 'comprehensive':
                    validationResults = `
                        <h4>✅ Comprehensive Validation Results</h4>
                        <ul>
                            <li><strong>Dimension Check:</strong> All histograms have 1,152 dimensions ✓</li>
                            <li><strong>Normalization:</strong> L1 normalization verified ✓</li>
                            <li><strong>Range Check:</strong> Values within [0, 1] bounds ✓</li>
                            <li><strong>Consistency:</strong> Color space conversion verified ✓</li>
                            <li><strong>Quality:</strong> Histogram smoothness analysis ✓</li>
                            <li><strong>Distribution:</strong> Color distribution analysis ✓</li>
                            <li><strong>Outliers:</strong> Anomaly detection ✓</li>
                        </ul>
                    `;
                    break;
                case 'expert':
                    validationResults = `
                        <h4>✅ Expert Validation Results</h4>
                        <ul>
                            <li><strong>Dimension Check:</strong> All histograms have 1,152 dimensions ✓</li>
                            <li><strong>Normalization:</strong> L1 normalization verified ✓</li>
                            <li><strong>Range Check:</strong> Values within [0, 1] bounds ✓</li>
                            <li><strong>Consistency:</strong> Color space conversion verified ✓</li>
                            <li><strong>Quality:</strong> Histogram smoothness analysis ✓</li>
                            <li><strong>Distribution:</strong> Color distribution analysis ✓</li>
                            <li><strong>Outliers:</strong> Anomaly detection ✓</li>
                            <li><strong>Numerical:</strong> Precision and stability analysis ✓</li>
                            <li><strong>Performance:</strong> Memory and CPU optimization ✓</li>
                            <li><strong>Compliance:</strong> CIE Lab D65 standard verification ✓</li>
                        </ul>
                    `;
                    break;
            }

            // Generate performance metrics based on checkboxes
            let performanceMetrics = '';
            if (timing || memory || throughput || benchmarks) {
                performanceMetrics = `
                    <h4>⚡ Performance Metrics</h4>
                    <ul>
                        ${timing ? `<li><strong>Average Processing Time:</strong> ${avgHistogramTime} seconds per image</li>` : ''}
                        ${timing ? `<li><strong>Total Processing Time:</strong> ${processingTime} seconds for ${maxFiles} images</li>` : ''}
                        ${memory ? `<li><strong>Memory Usage:</strong> ~${(parseInt(maxFiles) * 0.5).toFixed(1)} MB for batch processing</li>` : ''}
                        ${throughput ? `<li><strong>Throughput:</strong> ${(parseInt(maxFiles) / parseFloat(processingTime)).toFixed(1)} images/second</li>` : ''}
                        ${benchmarks ? `<li><strong>Performance Rating:</strong> ${validation === 'expert' ? 'Excellent' : validation === 'comprehensive' ? 'Very Good' : validation === 'standard' ? 'Good' : 'Basic'}</li>` : ''}
                    </ul>
                `;
            }

            // Generate visualization summary based on checkboxes
            let visualizationSummary = '';
            if (charts || heatmaps || threeD || comparison) {
                const enabledViz = [];
                if (charts) enabledViz.push('Distribution Charts');
                if (heatmaps) enabledViz.push('Color Heatmaps');
                if (threeD) enabledViz.push('3D Projections');
                if (comparison) enabledViz.push('Comparison Plots');

                visualizationSummary = `
                    <h4>📊 Visualization Summary</h4>
                    <ul>
                        <li><strong>Generated Visualizations:</strong> ${enabledViz.join(', ')}</li>
                        <li><strong>Output Format:</strong> ${outputFormat.toUpperCase()}</li>
                        <li><strong>Resolution:</strong> ${resolution.charAt(0).toUpperCase() + resolution.slice(1)}</li>
                        <li><strong>Total Charts:</strong> ${enabledViz.length} visualization types</li>
                    </ul>
                `;
            }

            return `
                <div class="analysis-results">
                    <div class="result-section">
                        <h4>📈 Histogram Analysis Summary</h4>
                        <ul>
                            <li><strong>Input Source:</strong> ${inputSource.charAt(0).toUpperCase() + inputSource.slice(1)}</li>
                            <li><strong>Path/File:</strong> ${path}</li>
                            <li><strong>Max Files:</strong> ${maxFiles} images</li>
                            <li><strong>Validation Level:</strong> ${validation.charAt(0).toUpperCase() + validation.slice(1)}</li>
                            <li><strong>Output Format:</strong> ${outputFormat.toUpperCase()}</li>
                            <li><strong>Resolution:</strong> ${resolution.charAt(0).toUpperCase() + resolution.slice(1)}</li>
                            <li><strong>Processing Time:</strong> ${processingTime} seconds</li>
                            <li><strong>Success Rate:</strong> ${successRate}%</li>
                        </ul>
                    </div>
                    
                    <div class="result-section">
                        ${validationResults}
                    </div>
                    
                    ${performanceMetrics}
                    
                    ${visualizationSummary}
                    
                    <div class="result-section">
                        <h4>📁 Data Export Summary</h4>
                        <ul>
                            ${rawData ? '<li><strong>Raw Histogram Data:</strong> Included ✓</li>' : ''}
                            ${metadata ? '<li><strong>Image Metadata:</strong> Included ✓</li>' : ''}
                            ${statistics ? '<li><strong>Statistical Summaries:</strong> Included ✓</li>' : ''}
                            ${quality ? '<li><strong>Quality Metrics:</strong> Included ✓</li>' : ''}
                            <li><strong>Export Format:</strong> ${outputFormat.toUpperCase()} ready for download</li>
                        </ul>
                    </div>
                    
                    <div class="result-actions">
                        <button class="action-btn primary-btn" onclick="downloadHistogramAnalysisResults()">Download Report</button>
                        <button class="action-btn secondary-btn" onclick="exportHistogramAnalysisData()">Export Data</button>
                    </div>
                </div>
            `;
        }

        function resetHistogramAnalysisForm() {
            document.getElementById('histogramAnalysisInput').value = 'directory';
            document.getElementById('histogramAnalysisPath').value = '';
            document.getElementById('histogramAnalysisMaxFiles').value = '50';
            document.getElementById('histogramAnalysisValidation').value = 'standard';
            document.getElementById('histogramAnalysisOutputFormat').value = 'png';
            document.getElementById('histogramAnalysisResolution').value = 'medium';

            // Reset checkboxes
            document.getElementById('histogramAnalysisTiming').checked = true;
            document.getElementById('histogramAnalysisMemory').checked = true;
            document.getElementById('histogramAnalysisThroughput').checked = true;
            document.getElementById('histogramAnalysisBenchmarks').checked = true;
            document.getElementById('histogramAnalysisCharts').checked = true;
            document.getElementById('histogramAnalysisHeatmaps').checked = true;
            document.getElementById('histogramAnalysis3D').checked = true;
            document.getElementById('histogramAnalysisComparison').checked = true;
            document.getElementById('histogramAnalysisRawData').checked = true;
            document.getElementById('histogramAnalysisMetadata').checked = true;
            document.getElementById('histogramAnalysisStatistics').checked = true;
            document.getElementById('histogramAnalysisQuality').checked = true;

            // Hide results
            document.getElementById('histogramAnalysisResults').style.display = 'none';
        }

        function showHistogramAnalysisHelp() {
            showSuccess('📈 Histogram Analysis Help',
                'This tool provides comprehensive histogram generation testing and analysis.\n\n' +
                '• <strong>Input Configuration:</strong> Choose input source and specify paths\n' +
                '• <strong>Analysis Parameters:</strong> Configure validation level and performance testing\n' +
                '• <strong>Visualization Options:</strong> Select chart types and analysis depth\n' +
                '• <strong>Output Configuration:</strong> Choose format, resolution, and data inclusion\n\n' +
                'For best results, use the test datasets in datasets/ directory and start with Standard validation.'
            );
        }

        function downloadHistogramAnalysisResults() {
            showSuccess('📥 Download', 'Download functionality would save the analysis report as a PDF document or PNG images.');
        }

        function exportHistogramAnalysisData() {
            showSuccess('📊 Export', 'Export functionality would save the histogram data as JSON, CSV, or other formats for further analysis.');
        }

        // Distance Debugger Functions
        function executeDistanceDebugger() {
            const testType = document.getElementById('distanceDebuggerTestType').value;
            const dataset = document.getElementById('distanceDebuggerDataset').value;
            const customPath = document.getElementById('distanceDebuggerCustomPath').value;
            const epsilon = document.getElementById('distanceDebuggerEpsilon').value;
            const maxIterations = document.getElementById('distanceDebuggerMaxIterations').value;
            const fallback = document.getElementById('distanceDebuggerFallback').value;

            // Show loading state
            const resultsArea = document.getElementById('distanceDebuggerResults');
            const resultsContent = document.getElementById('distanceDebuggerResultsContent');

            resultsArea.style.display = 'block';
            resultsContent.innerHTML = '<div class="loading">🔄 Running Distance Debugger...</div>';

            // Simulate tool execution (replace with actual API call)
            setTimeout(() => {
                const mockResults = generateMockDistanceDebuggerResults();
                resultsContent.innerHTML = mockResults;
            }, 3000);
        }

        function generateMockDistanceDebuggerResults() {
            // Get actual form values
            const testType = document.getElementById('distanceDebuggerTestType').value;
            const dataset = document.getElementById('distanceDebuggerDataset').value;
            const customPath = document.getElementById('distanceDebuggerCustomPath').value;
            const epsilon = parseFloat(document.getElementById('distanceDebuggerEpsilon').value);
            const maxIterations = parseInt(document.getElementById('distanceDebuggerMaxIterations').value);
            const fallback = document.getElementById('distanceDebuggerFallback').value;

            // Get checkbox states
            const numerical = document.getElementById('distanceDebuggerNumerical').checked;
            const convergence = document.getElementById('distanceDebuggerConvergence').checked;
            const error = document.getElementById('distanceDebuggerError').checked;
            const comparison = document.getElementById('distanceDebuggerComparison').checked;
            const detailed = document.getElementById('distanceDebuggerDetailed').checked;
            const summary = document.getElementById('distanceDebuggerSummary').checked;
            const visualization = document.getElementById('distanceDebuggerVisualization').checked;
            const exportData = document.getElementById('distanceDebuggerExport').checked;
            const outputFormat = document.getElementById('distanceDebuggerOutputFormat').value;

            // Calculate dataset size based on selection
            let datasetSize = 50;
            let datasetPath = 'datasets/test-dataset-50';
            switch (dataset) {
                case 'test-dataset-20':
                    datasetSize = 20;
                    datasetPath = 'datasets/test-dataset-20';
                    break;
                case 'test-dataset-200':
                    datasetSize = 200;
                    datasetPath = 'datasets/test-dataset-200';
                    break;
                case 'custom':
                    datasetSize = customPath ? 100 : 0;
                    datasetPath = customPath || 'Custom path not specified';
                    break;
            }

            // Generate test results based on test type
            let testResults = '';
            let processingTime = 0;
            let successRate = 0;
            let fallbackCount = 0;

            switch (testType) {
                case 'pairwise':
                    testResults = `
                        <h4>🔍 Pairwise Distance Analysis</h4>
                        <ul>
                            <li><strong>Total Comparisons:</strong> ${Math.floor(datasetSize * (datasetSize - 1) / 2)} pairs</li>
                            <li><strong>Sinkhorn-EMD Success:</strong> ${Math.floor(datasetSize * 0.85)} calculations</li>
                            <li><strong>Fallback Usage:</strong> ${Math.floor(datasetSize * 0.15)} calculations</li>
                            <li><strong>Average Distance:</strong> ${(0.3 + Math.random() * 0.4).toFixed(3)}</li>
                        </ul>
                    `;
                    processingTime = (datasetSize * 0.1).toFixed(1);
                    successRate = 85;
                    fallbackCount = Math.floor(datasetSize * 0.15);
                    break;

                case 'batch':
                    testResults = `
                        <h4>📦 Batch Distance Analysis</h4>
                        <ul>
                            <li><strong>Batch Size:</strong> ${datasetSize} images</li>
                            <li><strong>Processing Method:</strong> Parallel batch processing</li>
                            <li><strong>Memory Usage:</strong> ~${(datasetSize * 0.8).toFixed(1)} MB</li>
                            <li><strong>Throughput:</strong> ${(datasetSize / 2.5).toFixed(1)} images/second</li>
                        </ul>
                    `;
                    processingTime = (datasetSize * 0.05).toFixed(1);
                    successRate = 92;
                    fallbackCount = Math.floor(datasetSize * 0.08);
                    break;

                case 'stability':
                    testResults = `
                        <h4>⚖️ Numerical Stability Analysis</h4>
                        <ul>
                            <li><strong>Epsilon Value:</strong> ${epsilon} (${epsilon < 1 ? 'Aggressive' : epsilon < 2 ? 'Balanced' : 'Conservative'})</li>
                            <li><strong>Convergence Rate:</strong> ${epsilon < 1 ? '85%' : epsilon < 2 ? '95%' : '98%'}</li>
                            <li><strong>Numerical Issues:</strong> ${epsilon < 1 ? '15%' : epsilon < 2 ? '5%' : '2%'} of calculations</li>
                            <li><strong>Stability Score:</strong> ${epsilon < 1 ? '7/10' : epsilon < 2 ? '9/10' : '10/10'}</li>
                        </ul>
                    `;
                    processingTime = (datasetSize * 0.08).toFixed(1);
                    successRate = epsilon < 1 ? 85 : epsilon < 2 ? 95 : 98;
                    fallbackCount = Math.floor(datasetSize * (1 - successRate / 100));
                    break;

                case 'performance':
                    testResults = `
                        <h4>⚡ Performance Benchmarking</h4>
                        <ul>
                            <li><strong>Algorithm:</strong> Sinkhorn-EMD with ${maxIterations} max iterations</li>
                            <li><strong>Average Time:</strong> ${(0.15 + Math.random() * 0.1).toFixed(3)} seconds per calculation</li>
                            <li><strong>Memory Efficiency:</strong> ${(85 + Math.random() * 10).toFixed(1)}%</li>
                            <li><strong>CPU Utilization:</strong> ${(70 + Math.random() * 20).toFixed(1)}%</li>
                        </ul>
                    `;
                    processingTime = (datasetSize * 0.12).toFixed(1);
                    successRate = 90;
                    fallbackCount = Math.floor(datasetSize * 0.1);
                    break;

                case 'fallback':
                    testResults = `
                        <h4>🔄 Fallback Strategy Analysis</h4>
                        <ul>
                            <li><strong>Primary Method:</strong> Sinkhorn-EMD (ε=${epsilon})</li>
                            <li><strong>Fallback Method:</strong> ${fallback.charAt(0).toUpperCase() + fallback.slice(1)} Distance</li>
                            <li><strong>Fallback Trigger:</strong> Convergence failure or numerical instability</li>
                            <li><strong>Fallback Performance:</strong> ${fallback === 'l2' ? 'Fast' : fallback === 'cosine' ? 'Balanced' : fallback === 'manhattan' ? 'Robust' : 'Conservative'}</li>
                        </ul>
                    `;
                    processingTime = (datasetSize * 0.15).toFixed(1);
                    successRate = 88;
                    fallbackCount = Math.floor(datasetSize * 0.12);
                    break;
            }

            // Generate analysis results based on checkboxes
            let analysisResults = '';
            if (numerical || convergence || error || comparison) {
                const enabledAnalysis = [];
                if (numerical) enabledAnalysis.push('Numerical Stability');
                if (convergence) enabledAnalysis.push('Convergence Tracking');
                if (error) enabledAnalysis.push('Error Pattern Analysis');
                if (comparison) enabledAnalysis.push('Metric Comparison');

                analysisResults = `
                    <h4>🔬 Analysis Results</h4>
                    <ul>
                        <li><strong>Analysis Types:</strong> ${enabledAnalysis.join(', ')}</li>
                        <li><strong>Dataset Path:</strong> ${datasetPath}</li>
                        <li><strong>Test Type:</strong> ${testType.charAt(0).toUpperCase() + testType.slice(1)}</li>
                        <li><strong>Processing Time:</strong> ${processingTime} seconds</li>
                        <li><strong>Success Rate:</strong> ${successRate}%</li>
                        <li><strong>Fallback Count:</strong> ${fallbackCount} calculations</li>
                    </ul>
                `;
            }

            // Generate output summary based on checkboxes
            let outputSummary = '';
            if (detailed || summary || visualization || exportData) {
                const enabledOutput = [];
                if (detailed) enabledOutput.push('Detailed Debug Logs');
                if (summary) enabledOutput.push('Summary Report');
                if (visualization) enabledOutput.push('Debug Visualizations');
                if (exportData) enabledOutput.push('Export Debug Data');

                outputSummary = `
                    <h4>📤 Output Summary</h4>
                    <ul>
                        <li><strong>Generated Outputs:</strong> ${enabledOutput.join(', ')}</li>
                        <li><strong>Output Format:</strong> ${outputFormat.toUpperCase()}</li>
                        <li><strong>Report Size:</strong> ~${(enabledOutput.length * 0.5).toFixed(1)} MB</li>
                        <li><strong>Export Ready:</strong> ${exportData ? 'Yes' : 'No'}</li>
                    </ul>
                `;
            }

            return `
                <div class="analysis-results">
                    <div class="result-section">
                        <h4>🐛 Distance Debugger Summary</h4>
                        <ul>
                            <li><strong>Test Type:</strong> ${testType.charAt(0).toUpperCase() + testType.slice(1)}</li>
                            <li><strong>Dataset:</strong> ${datasetPath} (${datasetSize} images)</li>
                            <li><strong>Sinkhorn Epsilon:</strong> ${epsilon}</li>
                            <li><strong>Max Iterations:</strong> ${maxIterations}</li>
                            <li><strong>Fallback Strategy:</strong> ${fallback.charAt(0).toUpperCase() + fallback.slice(1)} Distance</li>
                            <li><strong>Output Format:</strong> ${outputFormat.toUpperCase()}</li>
                        </ul>
                    </div>
                    
                    <div class="result-section">
                        ${testResults}
                    </div>
                    
                    ${analysisResults}
                    
                    ${outputSummary}
                    
                    <div class="result-section">
                        <h4>⚠️ Issues Identified</h4>
                        <ul>
                            <li><strong>Numerical Stability:</strong> ${epsilon < 1 ? 'Low epsilon may cause convergence issues' : 'Stable configuration'}</li>
                            <li><strong>Fallback Usage:</strong> ${fallbackCount > 0 ? `${fallbackCount} calculations used fallback method` : 'No fallbacks needed'}</li>
                            <li><strong>Performance:</strong> ${processingTime > 10 ? 'Processing time may be slow for large datasets' : 'Performance is acceptable'}</li>
                            <li><strong>Recommendations:</strong> ${epsilon < 1 ? 'Consider increasing epsilon for better stability' : 'Current settings are optimal'}</li>
                        </ul>
                    </div>
                    
                    <div class="result-actions">
                        <button class="action-btn primary-btn" onclick="downloadDistanceDebuggerResults()">Download Report</button>
                        <button class="action-btn secondary-btn" onclick="exportDistanceDebuggerData()">Export Data</button>
                    </div>
                </div>
            `;
        }

        function resetDistanceDebuggerForm() {
            document.getElementById('distanceDebuggerTestType').value = 'batch';
            document.getElementById('distanceDebuggerDataset').value = 'test-dataset-50';
            document.getElementById('distanceDebuggerCustomPath').value = '';
            document.getElementById('distanceDebuggerEpsilon').value = '1.0';
            document.getElementById('distanceDebuggerMaxIterations').value = '1000';
            document.getElementById('distanceDebuggerFallback').value = 'manhattan';

            // Reset checkboxes
            document.getElementById('distanceDebuggerNumerical').checked = true;
            document.getElementById('distanceDebuggerConvergence').checked = true;
            document.getElementById('distanceDebuggerError').checked = true;
            document.getElementById('distanceDebuggerComparison').checked = true;
            document.getElementById('distanceDebuggerDetailed').checked = true;
            document.getElementById('distanceDebuggerSummary').checked = true;
            document.getElementById('distanceDebuggerVisualization').checked = true;
            document.getElementById('distanceDebuggerExport').checked = true;
            document.getElementById('distanceDebuggerOutputFormat').value = 'html';

            // Hide results
            document.getElementById('distanceDebuggerResults').style.display = 'none';
        }

        function showDistanceDebuggerHelp() {
            showSuccess('🐛 Distance Debugger Help',
                'This tool helps debug Sinkhorn-EMD distance calculations and identify numerical stability issues.\n\n' +
                '• <strong>Test Configuration:</strong> Choose test type and dataset\n' +
                '• <strong>Distance Calculation:</strong> Configure epsilon, iterations, and fallback strategy\n' +
                '• <strong>Debugging Options:</strong> Select analysis depth and output options\n\n' +
                'For best results, start with Standard settings and adjust epsilon based on stability needs.'
            );
        }

        function downloadDistanceDebuggerResults() {
            showSuccess('📥 Download', 'Download functionality would save the debug report as an HTML, PDF, or JSON document.');
        }

        function exportDistanceDebuggerData() {
            showSuccess('📊 Export', 'Export functionality would save the debug data as CSV, JSON, or other formats for further analysis.');
        }

        // Add event listener for custom path input
        document.addEventListener('DOMContentLoaded', function () {
            const datasetSelect = document.getElementById('distanceDebuggerDataset');
            const customPathInput = document.getElementById('distanceDebuggerCustomPath');

            if (datasetSelect && customPathInput) {
                datasetSelect.addEventListener('change', function () {
                    if (this.value === 'custom') {
                        customPathInput.disabled = false;
                        customPathInput.placeholder = 'Enter custom dataset path';
                    } else {
                        customPathInput.disabled = true;
                        customPathInput.value = '';
                        customPathInput.placeholder = 'datasets/custom-path';
                    }
                });
            }

            // Add event listeners for Query Visualizer custom dimensions
            const sizeSelect = document.getElementById('queryVisualizerSize');
            const customWidth = document.getElementById('queryVisualizerCustomWidth');
            const customHeight = document.getElementById('queryVisualizerCustomHeight');

            if (sizeSelect && customWidth && customHeight) {
                sizeSelect.addEventListener('change', function () {
                    if (this.value === 'custom') {
                        customWidth.disabled = false;
                        customHeight.disabled = false;
                        customWidth.placeholder = '800';
                        customHeight.placeholder = '600';
                    } else {
                        customWidth.disabled = true;
                        customHeight.disabled = true;
                        customWidth.value = '';
                        customHeight.value = '';
                        customWidth.placeholder = '800';
                        customHeight.placeholder = '600';
                    }
                });
            }

            // Add event listener for Query Visualizer custom background
            const backgroundSelect = document.getElementById('queryVisualizerBackground');
            const customBackground = document.getElementById('queryVisualizerCustomBackground');

            if (backgroundSelect && customBackground) {
                backgroundSelect.addEventListener('change', function () {
                    if (this.value === 'custom') {
                        customBackground.disabled = false;
                    } else {
                        customBackground.disabled = true;
                    }
                });
            }
        });

        // Query Visualizer Functions
        function executeQueryVisualizer() {
            const colors = document.getElementById('queryVisualizerColors').value;
            const weights = document.getElementById('queryVisualizerWeights').value;
            const queryType = document.getElementById('queryVisualizerQueryType').value;
            const style = document.getElementById('queryVisualizerStyle').value;
            const layout = document.getElementById('queryVisualizerLayout').value;
            const size = document.getElementById('queryVisualizerSize').value;
            const outputFormat = document.getElementById('queryVisualizerOutputFormat').value;
            const quality = document.getElementById('queryVisualizerQuality').value;

            // Show loading state
            const resultsArea = document.getElementById('queryVisualizerResults');
            const resultsContent = document.getElementById('queryVisualizerResultsContent');

            resultsArea.style.display = 'block';
            resultsContent.innerHTML = '<div class="loading">🎨 Generating Query Visualization...</div>';

            // Simulate tool execution (replace with actual API call)
            setTimeout(() => {
                const mockResults = generateMockQueryVisualizerResults();
                resultsContent.innerHTML = mockResults;
            }, 2500);
        }

        function generateMockQueryVisualizerResults() {
            // Get actual form values
            const colors = document.getElementById('queryVisualizerColors').value || 'FF0000,00FF00';
            const weights = document.getElementById('queryVisualizerWeights').value || '0.6,0.4';
            const queryType = document.getElementById('queryVisualizerQueryType').value;
            const style = document.getElementById('queryVisualizerStyle').value;
            const layout = document.getElementById('queryVisualizerLayout').value;
            const size = document.getElementById('queryVisualizerSize').value;
            const outputFormat = document.getElementById('queryVisualizerOutputFormat').value;
            const quality = document.getElementById('queryVisualizerQuality').value;

            // Get checkbox states
            const labels = document.getElementById('queryVisualizerLabels').checked;
            const weightDisplay = document.getElementById('queryVisualizerWeights').checked;
            const colorNames = document.getElementById('queryVisualizerColorNames').checked;
            const harmony = document.getElementById('queryVisualizerHarmony').checked;
            const accessibility = document.getElementById('queryVisualizerAccessibility').checked;
            const background = document.getElementById('queryVisualizerBackground').value;
            const customBackground = document.getElementById('queryVisualizerCustomBackground').value;

            // Parse colors and weights
            const colorArray = colors.split(',').map(c => c.trim());
            const weightArray = weights.split(',').map(w => parseFloat(w.trim()));
            const totalWeight = weightArray.reduce((sum, w) => sum + w, 0);
            const normalizedWeights = weightArray.map(w => (w / totalWeight).toFixed(3));

            // Calculate dimensions based on size selection
            let width = 600, height = 450;
            if (size === 'small') { width = 400; height = 300; }
            else if (size === 'large') { width = 800; height = 600; }
            else if (size === 'custom') {
                const customWidth = document.getElementById('queryVisualizerCustomWidth').value;
                const customHeight = document.getElementById('queryVisualizerCustomHeight').value;
                width = customWidth ? parseInt(customWidth) : 600;
                height = customHeight ? parseInt(customHeight) : 450;
            }

            // Generate color swatches based on actual colors
            let colorSwatches = '';
            colorArray.forEach((color, index) => {
                const weight = normalizedWeights[index] || '0.500';
                const percentage = Math.round(parseFloat(weight) * 100);
                const colorName = getColorName(color);

                colorSwatches += `
                    <div class="color-swatch" style="background: #${color}; color: white; width: 100px; height: 80px;">
                        ${labels ? `#${color}<br>` : ''}
                        ${colorNames ? `<small>${colorName}</small><br>` : ''}
                        ${weightDisplay ? `<small>${percentage}%</small>` : ''}
                    </div>
                `;
            });

            // Generate visualization description based on style and layout
            let visualizationDescription = '';
            switch (style) {
                case 'bars':
                    visualizationDescription = `Weighted color bars in ${layout} layout, showing proportional representation of each color`;
                    break;
                case 'circles':
                    visualizationDescription = `Color circles arranged in ${layout} pattern, with sizes proportional to weights`;
                    break;
                case 'squares':
                    visualizationDescription = `Color squares in ${layout} arrangement, representing color distribution`;
                    break;
                case 'hexagons':
                    visualizationDescription = `Hexagonal color tiles in ${layout} layout, creating a modern geometric pattern`;
                    break;
                case 'gradient':
                    visualizationDescription = `Smooth gradient bar in ${layout} orientation, blending colors based on weights`;
                    break;
            }

            // Generate harmony analysis if enabled
            let harmonyAnalysis = '';
            if (harmony && colorArray.length >= 2) {
                const harmonyType = getHarmonyType(colorArray);
                harmonyAnalysis = `
                    <h4>🎨 Color Harmony Analysis</h4>
                    <ul>
                        <li><strong>Harmony Type:</strong> ${harmonyType}</li>
                        <li><strong>Color Count:</strong> ${colorArray.length} colors</li>
                        <li><strong>Balance:</strong> ${colorArray.length === 2 ? 'Dual color balance' : 'Multi-color harmony'}</li>
                        <li><strong>Recommendation:</strong> ${getHarmonyRecommendation(harmonyType)}</li>
                    </ul>
                `;
            }

            // Generate accessibility information if enabled
            let accessibilityInfo = '';
            if (accessibility) {
                const contrastRatios = colorArray.map(color => getContrastRatio(color));
                const avgContrast = (contrastRatios.reduce((sum, r) => sum + r, 0) / contrastRatios.length).toFixed(2);

                accessibilityInfo = `
                    <h4>♿ Accessibility Information</h4>
                    <ul>
                        <li><strong>Average Contrast Ratio:</strong> ${avgContrast}:1</li>
                        <li><strong>WCAG Compliance:</strong> ${avgContrast >= 4.5 ? 'AA Standard' : avgContrast >= 3 ? 'A Standard' : 'Below Standard'}</li>
                        <li><strong>Color Blindness:</strong> ${colorArray.length <= 3 ? 'Good distinction' : 'May need verification'}</li>
                        <li><strong>Recommendations:</strong> ${getAccessibilityRecommendations(avgContrast)}</li>
                    </ul>
                `;
            }

            // Calculate generation time based on quality and complexity
            const baseTime = 0.5;
            const qualityMultiplier = quality === 'low' ? 0.5 : quality === 'medium' ? 1.0 : quality === 'high' ? 1.5 : 2.0;
            const complexityMultiplier = colorArray.length * 0.2;
            const generationTime = (baseTime * qualityMultiplier * (1 + complexityMultiplier)).toFixed(2);

            return `
                <div class="analysis-results">
                    <div class="result-section">
                        <h4>🎭 Query Visualization Generated</h4>
                        <ul>
                            <li><strong>Query Type:</strong> ${queryType.charAt(0).toUpperCase() + queryType.slice(1)}</li>
                            <li><strong>Colors:</strong> ${colorArray.length} colors (${colors})</li>
                            <li><strong>Weights:</strong> ${weights} (normalized: ${normalizedWeights.join(', ')})</li>
                            <li><strong>Visualization Style:</strong> ${style.charAt(0).toUpperCase() + style.slice(1)}</li>
                            <li><strong>Layout:</strong> ${layout.charAt(0).toUpperCase() + layout.slice(1)}</li>
                            <li><strong>Dimensions:</strong> ${width} × ${height} pixels</li>
                            <li><strong>Output Format:</strong> ${outputFormat.toUpperCase()}</li>
                            <li><strong>Quality:</strong> ${quality.charAt(0).toUpperCase() + quality.slice(1)}</li>
                            <li><strong>Generation Time:</strong> ${generationTime} seconds</li>
                        </ul>
                    </div>
                    
                    <div class="result-section">
                        <h4>🎨 Color Representation</h4>
                        <p>${visualizationDescription}</p>
                        <div class="color-swatches">${colorSwatches}</div>
                    </div>
                    
                    ${harmonyAnalysis}
                    
                    ${accessibilityInfo}
                    
                    <div class="result-section">
                        <h4>⚙️ Technical Details</h4>
                        <ul>
                            <li><strong>Background Style:</strong> ${background.charAt(0).toUpperCase() + background.slice(1)}${background === 'custom' ? ` (${customBackground})` : ''}</li>
                            <li><strong>File Size Estimate:</strong> ~${(width * height * 0.0001 * (quality === 'low' ? 0.5 : quality === 'medium' ? 1.0 : quality === 'high' ? 1.5 : 2.0)).toFixed(1)} MB</li>
                            <li><strong>Export Ready:</strong> ${outputFormat.toUpperCase()} format ready for download</li>
                            <li><strong>Features Enabled:</strong> ${[labels, weightDisplay, colorNames, harmony, accessibility].filter(Boolean).length} of 5 features</li>
                        </ul>
                    </div>
                    
                    <div class="result-actions">
                        <button class="action-btn primary-btn" onclick="downloadQueryVisualization()">Download Visualization</button>
                        <button class="action-btn secondary-btn" onclick="exportQueryVisualizationData()">Export Data</button>
                    </div>
                </div>
            `;
        }

        // Helper functions for Query Visualizer
        function getColorName(hexColor) {
            const colorNames = {
                'FF0000': 'Red', '00FF00': 'Green', '0000FF': 'Blue', 'FFFF00': 'Yellow',
                'FF00FF': 'Magenta', '00FFFF': 'Cyan', 'FF8000': 'Orange', '8000FF': 'Purple',
                'FF0080': 'Pink', '80FF00': 'Lime', '0080FF': 'Sky Blue', 'FF8000': 'Orange'
            };
            return colorNames[hexColor.toUpperCase()] || 'Custom Color';
        }

        function getHarmonyType(colors) {
            if (colors.length === 1) return 'Monochromatic';
            if (colors.length === 2) return 'Complementary';
            if (colors.length === 3) return 'Triadic';
            if (colors.length === 4) return 'Tetradic';
            return 'Multi-Color';
        }

        function getHarmonyRecommendation(harmonyType) {
            const recommendations = {
                'Monochromatic': 'Excellent for creating depth and variation',
                'Complementary': 'Great for high contrast and visual impact',
                'Triadic': 'Perfect for balanced and vibrant designs',
                'Tetradic': 'Good for complex and rich color schemes',
                'Multi-Color': 'Consider reducing to 3-4 colors for better harmony'
            };
            return recommendations[harmonyType] || 'Good color combination';
        }

        function getContrastRatio(hexColor) {
            // Simple contrast ratio estimation
            const r = parseInt(hexColor.substr(0, 2), 16);
            const g = parseInt(hexColor.substr(2, 2), 16);
            const b = parseInt(hexColor.substr(4, 2), 16);
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;
            return brightness > 128 ? 4.5 : 2.5; // Simplified calculation
        }

        function getAccessibilityRecommendations(contrastRatio) {
            if (contrastRatio >= 4.5) return 'Excellent contrast, meets all accessibility standards';
            if (contrastRatio >= 3.0) return 'Good contrast, meets basic accessibility requirements';
            return 'Consider increasing contrast for better accessibility';
        }

        function resetQueryVisualizerForm() {
            document.getElementById('queryVisualizerColors').value = 'FF0000,00FF00';
            document.getElementById('queryVisualizerWeights').value = '0.6,0.4';
            document.getElementById('queryVisualizerQueryType').value = 'dual';
            document.getElementById('queryVisualizerStyle').value = 'circles';
            document.getElementById('queryVisualizerLayout').value = 'vertical';
            document.getElementById('queryVisualizerSize').value = 'medium';
            document.getElementById('queryVisualizerOutputFormat').value = 'svg';
            document.getElementById('queryVisualizerQuality').value = 'medium';
            document.getElementById('queryVisualizerBackground').value = 'white';

            // Reset checkboxes
            document.getElementById('queryVisualizerLabels').checked = true;
            document.getElementById('queryVisualizerWeights').checked = true;
            document.getElementById('queryVisualizerColorNames').checked = true;
            document.getElementById('queryVisualizerHarmony').checked = true;
            document.getElementById('queryVisualizerAccessibility').checked = true;
            document.getElementById('queryVisualizerQueryInfo').checked = true;
            document.getElementById('queryVisualizerGenerationInfo').checked = true;
            document.getElementById('queryVisualizerColorInfo').checked = true;
            document.getElementById('queryVisualizerExportInfo').checked = true;

            // Reset custom inputs
            document.getElementById('queryVisualizerCustomWidth').value = '';
            document.getElementById('queryVisualizerCustomHeight').value = '';
            document.getElementById('queryVisualizerCustomBackground').value = '#F5F5F5';

            // Hide results
            document.getElementById('queryVisualizerResults').style.display = 'none';
        }

        function showQueryVisualizerHelp() {
            showSuccess('🎭 Query Visualizer Help',
                'This tool creates visual representations of color queries with various styles and layouts.\n\n' +
                '• <strong>Query Configuration:</strong> Enter colors and weights for your query\n' +
                '• <strong>Visualization Settings:</strong> Choose style, layout, and dimensions\n' +
                '• <strong>Advanced Options:</strong> Configure features, background, and accessibility\n' +
                '• <strong>Output Configuration:</strong> Select format, quality, and metadata\n\n' +
                'For best results, use 2-4 colors with balanced weights and experiment with different styles.'
            );
        }

        function downloadQueryVisualization() {
            showSuccess('📥 Download', 'Download functionality would save the generated visualization in your selected format.');
        }

        function exportQueryVisualizationData() {
            showSuccess('📊 Export', 'Export functionality would save the visualization data and metadata for further use.');
        }
    </script>
</body>

</html>